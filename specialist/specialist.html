<div id="specialist-component-wrapper" class="specialist-component-scope">
    <style>
        /* --- CSS Scoping & Isolation --- */
        
        /* Container chính để cô lập style, tránh reset global của index */
        .specialist-component-scope {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f9f9f9;
            width: 100%;
            /* QUAN TRỌNG: Fix lỗi hiển thị với Hero */
            position: relative; 
            z-index: 20; /* Đảm bảo nằm trên các element background của Hero */
            display: block;
            overflow: hidden; /* Tránh margin collapse */
        }

        .specialist-component-scope * {
            box-sizing: border-box;
        }

        .specialist-component-scope .specialist-section {
            max-width: 1200px;
            margin: 0 auto;
            padding: 50px 20px; /* Tăng padding top để tách biệt rõ ràng */
        }

        .specialist-component-scope .section-title {
            text-align: center;
            color: #2c3e50;
            font-size: 2em;
            position: relative;
            margin-bottom: 30px;
            margin-top: 0;
        }

        .specialist-component-scope .section-title:after {
            content: '';
            display: block;
            width: 80px;
            height: 3px;
            background: #3498db;
            margin: 15px auto;
        }

        .specialist-component-scope .specialty {
            display: flex;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .specialist-component-scope .specialty-image {
            width: 180px;
            min-width: 180px;
            height: 180px;
            position: relative;
            overflow: hidden;
        }

        .specialist-component-scope .specialty-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.5s ease;
            position: absolute;
            top: 0;
            left: 0;
        }

        .specialist-component-scope .specialty-image img:not(.active) {
            opacity: 0;
        }

        .specialist-component-scope .specialty-content {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        .specialist-component-scope .specialty-title {
            color: #3498db;
            font-size: 1.4em;
            margin-bottom: 15px;
            position: relative;
            padding-bottom: 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-top: 0;
        }

        .specialist-component-scope .specialty-title:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 2px;
            background: #3498db;
        }

        .specialist-component-scope .content-wrapper {
            position: relative;
            flex: 1;
        }

        .specialist-component-scope .specialty-text {
            font-size: 1em;
            color: #555;
            line-height: 1.6;
            overflow: hidden;
            position: relative;
            max-height: 96px;
            transition: max-height 0.3s ease;
            margin-bottom: 0;
        }

        .specialist-component-scope .specialty-text.expanded {
            max-height: none;
        }

        .specialist-component-scope .text-gradient {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40px;
            background: linear-gradient(transparent, #fff);
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .specialist-component-scope .specialty-text.expanded + .text-gradient {
            opacity: 0;
        }

        /* Doctors Slider */
        .specialist-component-scope .doctors-slider {
            display: none;
            margin-top: 20px;
            overflow: hidden;
        }

        .specialist-component-scope .doctors-slider.visible {
            display: block;
        }

        .specialist-component-scope .doctors-slider h3 {
            color: #2c3e50;
            font-size: 1.1em;
            margin-bottom: 15px;
        }

        .specialist-component-scope .doctors-wrapper {
            position: relative;
            padding: 0 30px;
            overflow: hidden;
        }

        .specialist-component-scope .doctors-container {
            overflow: hidden;
            margin: 0 -10px;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
        }

        .specialist-component-scope .doctors-track {
            display: flex;
            transition: transform 0.3s ease;
            width: 100%;
        }

        .specialist-component-scope .doctor-card {
            flex-shrink: 0;
            width: calc(33.333% - 20px);
            margin: 0 10px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            display: flex;
            align-items: flex-start;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .specialist-component-scope .doctor-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .specialist-component-scope .doctor-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .specialist-component-scope .doctor-info {
            flex: 1;
            min-width: 0;
        }

        .specialist-component-scope .doctor-name {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 4px;
            line-height: 1.3;
            word-wrap: break-word;
        }

        .specialist-component-scope .doctor-title {
            font-size: 0.9em;
            color: #666;
            line-height: 1.3;
            word-wrap: break-word;
        }

        /* Slider Controls */
        .specialist-component-scope .slider-button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 30px;
            height: 30px;
            background: #3498db;
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease;
            z-index: 1;
        }

        .specialist-component-scope .slider-button:hover {
            background: #2980b9;
        }

        .specialist-component-scope .slider-button.prev {
            left: 0;
        }

        .specialist-component-scope .slider-button.next {
            right: 0;
        }

        .specialist-component-scope .slider-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .specialist-component-scope .dots-container {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
            padding: 10px 0;
        }

        .specialist-component-scope .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ddd;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .specialist-component-scope .dot.active {
            background: #3498db;
        }

        /* Expand Button */
        .specialist-component-scope .expand-button {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: #3498db;
            background: transparent;
            border: none;
            padding: 5px 0;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 15px;
        }

        .specialist-component-scope .expand-icon {
            width: 16px;
            height: 16px;
            position: relative;
        }

        .specialist-component-scope .expand-icon::before,
        .specialist-component-scope .expand-icon::after {
            content: '';
            position: absolute;
            background: currentColor;
            border-radius: 1px;
        }

        .specialist-component-scope .expand-icon::before {
            width: 2px;
            height: 10px;
            left: 7px;
            top: 3px;
            opacity: 1;
            transition: opacity 0.3s;
        }

        .specialist-component-scope .expand-icon::after {
            width: 10px;
            height: 2px;
            left: 3px;
            top: 7px;
        }

        .specialist-component-scope .expanded .expand-icon::before {
            opacity: 0;
        }

        /* Tablet Responsive */
        @media (max-width: 768px) and (min-width: 481px) {
            .specialist-component-scope .specialty {
                flex-direction: row;
            }

            .specialist-component-scope .specialty-image {
                width: 150px;
                min-width: 150px;
                height: 150px;
            }

            .specialist-component-scope .doctor-card {
                width: calc(50% - 20px);
            }

            .specialist-component-scope .doctors-track {
                width: 200%;
            }
        }

        /* Mobile Responsive */
        @media (max-width: 480px) {
            .specialist-component-scope .section-title {
                font-size: 1.8em;
            }

            .specialist-component-scope .specialty {
                flex-direction: column;
            }

            .specialist-component-scope .specialty-image {
                width: 100%;
                max-width: 200px;
                height: 200px;
                margin: 0 auto;
            }

            .specialist-component-scope .specialty-content {
                padding: 15px;
            }

            .specialist-component-scope .specialty-title {
                font-size: 1.2em;
                white-space: normal;
                line-height: 1.3;
            }

            .specialist-component-scope .specialty-text {
                font-size: 0.95em;
                max-height: 80px;
            }

            /* Doctor Slider optimized for mobile */
            .specialist-component-scope .doctors-wrapper {
                padding: 0;
                overflow: visible;
            }

            .specialist-component-scope .doctors-container {
                overflow-x: auto;
                scroll-snap-type: x mandatory;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }

            .specialist-component-scope .doctors-container::-webkit-scrollbar {
                display: none;
            }

            .specialist-component-scope .doctors-track {
                display: flex;
                width: fit-content;
                gap: 0;
                transform: none !important;
            }

            .specialist-component-scope .doctor-card {
                width: 100vw;
                max-width: calc(100vw - 30px);
                margin: 0 15px;
                padding: 15px;
                scroll-snap-align: center;
                min-height: 90px;
            }

            .specialist-component-scope .doctor-avatar {
                width: 60px;
                height: 60px;
                margin-right: 15px;
            }

            .specialist-component-scope .doctor-info {
                display: flex;
                flex-direction: column;
            }

            .specialist-component-scope .doctor-name {
                font-size: 1.1em;
                margin-bottom: 4px;
                word-wrap: break-word;
                white-space: normal;
            }

            .specialist-component-scope .doctor-title {
                font-size: 0.9em;
                white-space: normal;
            }

            .specialist-component-scope .slider-button {
                display: none;
            }

            .specialist-component-scope .dots-container {
                margin-top: 20px;
                gap: 12px;
            }

            .specialist-component-scope .dot {
                width: 10px;
                height: 10px;
            }

            .specialist-component-scope .dot.active {
                transform: scale(1.2);
            }

            .specialist-component-scope .text-gradient {
                height: 50px;
            }

            .specialist-component-scope .expand-button {
                padding: 8px 0;
                margin-top: 10px;
            }
        }
    </style>

    <section class="specialist-section">
        <h1 class="section-title">Đội Ngũ Bác Sĩ Chuyên Khoa Giàu Kinh Nghiệm</h1>

        <div class="specialty">
            <div class="specialty-image">
                <img src="specialist/image/specialist1-1.jpg" alt="Chuyên Khoa Sản Phụ Khoa" class="active" loading="lazy">
                <img src="specialist/image/specialist1-2.jpg" alt="Chuyên Khoa Sản Phụ Khoa" loading="lazy">
                <img src="specialist/image/specialist1-3.jpg" alt="Chuyên Khoa Sản Phụ Khoa" loading="lazy">
                <img src="specialist/image/specialist1-4.jpg" alt="Chuyên Khoa Sản Phụ Khoa" loading="lazy">
            </div>
            <div class="specialty-content">
                <h2 class="specialty-title">Chuyên Khoa Sản Phụ Khoa</h2>
                <div class="content-wrapper">
                    <div class="specialty-text">
                        <p>
                            Phòng khám tự hào với đội ngũ bác sĩ giàu kinh nghiệm đến từ Bệnh viện Từ Dũ - một trong những trung tâm sản khoa hàng đầu khu vực phía Nam. Các bác sĩ chuyên về điều trị các bệnh lý phụ khoa phức tạp như u xơ tử cung, u nang buồng trứng, và tầm soát ung thư cổ tử cung. Đồng thời, chúng tôi cung cấp dịch vụ chăm sóc thai sản toàn diện, từ khám thai định kỳ, sàng lọc trước sinh đến hỗ trợ sinh tại Bệnh viện Từ Dũ.
                        </p>
                    </div>
                    <div class="text-gradient"></div>
                    <div class="doctors-slider">
                        <h3>Đội ngũ bác sĩ:</h3>
                        <div class="doctors-wrapper">
                            <button class="slider-button prev" disabled>&lt;</button>
                            <div class="doctors-container">
                                <div class="doctors-track">
                                    <div class="doctor-card">
                                        <div class="doctor-avatar">
                                            <img src="specialist/image/doctor1.jpg" alt="BS. Nguyễn Hoàng Lam" loading="lazy">
                                        </div>
                                        <div class="doctor-info">
                                            <div class="doctor-name">BS. Nguyễn Hoàng Lam</div>
                                            <div class="doctor-title">Chuyên khoa 1 - Phó Khoa</div>
                                        </div>
                                    </div>
                                    <div class="doctor-card">
                                        <div class="doctor-avatar">
                                            <img src="specialist/image/doctor2.jpg" alt="BS. Đào Hoàng Hoa Hà Hải Âu" loading="lazy">
                                        </div>
                                        <div class="doctor-info">
                                            <div class="doctor-name">BS. Đào Hoàng Hoa Hà Hải Âu</div>
                                            <div class="doctor-title">Chuyên khoa I</div>
                                        </div>
                                    </div>

                                    <div class="doctor-card">
                                        <div class="doctor-avatar">
                                            <img src="specialist/image/doctor3.jpg" alt="BS. Nguyễn Thị Việt Linh" loading="lazy">
                                        </div>
                                        <div class="doctor-info">
                                            <div class="doctor-name">BS. Nguyễn Thị Việt Linh</div>
                                            <div class="doctor-title">Chuyên khoa I</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button class="slider-button next">&gt;</button>
                            <div class="dots-container"></div>
                        </div>
                    </div>
                </div>
                <button class="expand-button">
                    <span class="expand-icon"></span>
                    <span class="button-text">Xem thêm thông tin</span>
                </button>
            </div>
        </div>

        <div class="specialty">
            <div class="specialty-image">
                <img src="specialist/image/specialist2-3.jpg" alt="Chuyên Khoa Tai Mũi Họng" class="active" loading="lazy">
                <img src="specialist/image/specialist2-3.jpg" alt="Chuyên Khoa Tai Mũi Họng" loading="lazy">
            </div>
            <div class="specialty-content">
                <h2 class="specialty-title">Chuyên Khoa Tai Mũi Họng</h2>
                <div class="content-wrapper">
                    <div class="specialty-text">
                        <p>
                            Phòng khám mang đến dịch vụ khám và điều trị các bệnh lý tai mũi họng chất lượng cao. Các bác sĩ có nhiều năm kinh nghiệm trong điều trị các bệnh lý như viêm xoang mãn tính, viêm amidan, viêm mũi dị ứng và đặc biệt là tầm soát ung thư vòm họng. Phòng khám được trang bị hệ thống nội soi hiện đại, giúp chẩn đoán chính xác và điều trị hiệu quả.
                        </p>
                    </div>
                    <div class="text-gradient"></div>
                    <div class="doctors-slider">
                        <h3>Đội ngũ bác sĩ:</h3>
                        <div class="doctors-wrapper">
                            <button class="slider-button prev" disabled>&lt;</button>
                            <div class="doctors-container">
                                <div class="doctors-track">
                                    <div class="doctor-card">
                                        <div class="doctor-avatar">
                                            <img src="specialist/image/doctor7.jpg" alt="BS. Sử Ngọc Kiều Chinh" loading="lazy">
                                        </div>
                                        <div class="doctor-info">
                                            <div class="doctor-name">BS. Sử Ngọc Kiều Chinh</div>
                                            <div class="doctor-title">Bác sĩ -Chuyên khoa 1</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button class="slider-button next">&gt;</button>
                            <div class="dots-container"></div>
                        </div>
                    </div>
                </div>
                <button class="expand-button">
                    <span class="expand-icon"></span>
                    <span class="button-text">Xem thêm thông tin</span>
                </button>
            </div>
        </div>

        <div class="specialty">
            <div class="specialty-image">
                <img src="specialist/image/specialist3-1.jpg" alt="Chuyên Khoa Nội" class="active" loading="lazy">
                <img src="specialist/image/specialist3-2.jpg" alt="Chuyên Khoa Nội" loading="lazy">
                <img src="specialist/image/specialist3-3.jpg" alt="Chuyên Khoa Nội" loading="lazy">
            </div>
            <div class="specialty-content">
                <h2 class="specialty-title">Chuyên Khoa Nội</h2>
                <div class="content-wrapper">
                    <div class="specialty-text">
                        <p>
                            Phòng khám quy tụ đội ngũ chuyên gia giàu kinh nghiệm đến từ các bệnh viện lớn như Bệnh viện FV, với đa dạng chuyên môn sâu. Các lĩnh vực chuyên sâu bao gồm: Nội tổng quát – khám và điều trị các bệnh lý thông thường; Tim mạch – chẩn đoán và quản lý toàn diện các bệnh về tim; Tim mạch can thiệp – tư vấn và theo dõi các trường hợp tim mạch phức tạp sau can thiệp; cùng Nội tiết – chuyển hóa, chuyên sâu trong chẩn đoán và điều trị đái tháo đường, rối loạn tuyến giáp, và các bệnh lý chuyển hóa khác
                        </p>
                    </div>
                    <div class="text-gradient"></div>
                    <div class="doctors-slider">
                        <h3>Đội ngũ bác sĩ:</h3>
                        <div class="doctors-wrapper">
                            <button class="slider-button prev" disabled>&lt;</button>
                            <div class="doctors-container">
                                <div class="doctors-track">
                                    <div class="doctor-card">
                                        <div class="doctor-avatar">
                                            <img src="specialist/image/doctor9.jpg" alt="BS. Đỗ Thành Long" loading="lazy">
                                        </div>
                                        <div class="doctor-info">
                                            <div class="doctor-name">BS. Đỗ Thành Long</div>
                                            <div class="doctor-title">Chuyên khoa 1</div>
                                        </div>
                                    </div>
                                    <div class="doctor-card">
                                        <div class="doctor-avatar">
                                            <img src="specialist/image/doctor10.jpg" alt="BS. Nguyễn Anh Hoàng" loading="lazy">
                                        </div>
                                        <div class="doctor-info">
                                            <div class="doctor-name">BS. Nguyễn Anh Hoàng</div>
                                            <div class="doctor-title">Chuyên khoa 1</div>
                                        </div>
                                    </div>
                                    <div class="doctor-card">
                                        <div class="doctor-avatar">
                                            <img src="specialist/image/doctor11.jpg" alt="BS. Đỗ Thành Long" loading="lazy">
                                        </div>
                                        <div class="doctor-info">
                                            <div class="doctor-name">BS. Đỗ Thành Long</div>
                                            <div class="doctor-title">Chuyên khoa 1</div>
                                        </div>
                                    </div>
                                    <div class="doctor-card">
                                        <div class="doctor-avatar">
                                            <img src="specialist/image/doctor12.jpg" alt="BS. Nguyễn Anh Hoàng" loading="lazy">
                                        </div>
                                        <div class="doctor-info">
                                            <div class="doctor-name">BS. Nguyễn Anh Hoàng</div>
                                            <div class="doctor-title">Chuyên khoa 1</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button class="slider-button next">&gt;</button>
                            <div class="dots-container"></div>
                        </div>
                    </div>
                </div>
                <button class="expand-button">
                    <span class="expand-icon"></span>
                    <span class="button-text">Xem thêm thông tin</span>
                </button>
            </div>
        </div>
    </section>

    <script>
        (function() {
            // IIFE để đóng gói code, tránh xung đột biến toàn cục
            console.log("Initializing Specialist Component...");

            const COMPONENT_SELECTOR = '#specialist-component-wrapper';
            
            // Helper: Debounce function
            function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }

            // --- Logic Image Slider (Giữ nguyên) ---
            function initializeImageSlider(specialtyImage) {
                const images = Array.from(specialtyImage.querySelectorAll('img'));
                if (!images.length) return null;

                let currentIndex = 0;
                let interval = null;

                const showImage = (index) => {
                    images.forEach(img => img.classList.remove('active'));
                    if(images[index]) images[index].classList.add('active');
                };

                const startSlideshow = () => {
                    if (interval) clearInterval(interval);
                    interval = setInterval(() => {
                        currentIndex = (currentIndex + 1) % images.length;
                        showImage(currentIndex);
                    }, 3000);
                };

                const stopSlideshow = () => {
                    if (interval) {
                        clearInterval(interval);
                        interval = null;
                    }
                };

                const cleanup = () => {
                    stopSlideshow();
                    specialtyImage.removeEventListener('mouseenter', stopSlideshow);
                    specialtyImage.removeEventListener('mouseleave', startSlideshow);
                };

                specialtyImage.addEventListener('mouseenter', stopSlideshow);
                specialtyImage.addEventListener('mouseleave', startSlideshow);

                startSlideshow();

                return cleanup;
            }

            // --- Logic Doctor Slider (Giữ nguyên & Fix responsive logic) ---
            function initializeDoctorSlider(slider) {
                const container = slider.querySelector('.doctors-container');
                const track = slider.querySelector('.doctors-track');
                const cards = Array.from(track.querySelectorAll('.doctor-card'));
                const prevButton = slider.querySelector('.slider-button.prev');
                const nextButton = slider.querySelector('.slider-button.next');
                const dotsContainer = slider.querySelector('.dots-container');

                if (!container || !track || cards.length === 0) return null;

                let currentSlide = 0;
                let startX = 0;
                let scrollLeft = 0;
                let isDown = false;
                let touchTimeout = null;

                const getCardsPerView = () => {
                    if (window.innerWidth <= 480) return 1;  // Mobile: 1 card
                    if (window.innerWidth <= 768) return 2;  // Tablet: 2 cards
                    return 3;  // Desktop: 3 cards
                };

                // Touch Events Logic
                const handleTouchStart = (e) => {
                    isDown = true;
                    container.classList.add('grabbing');
                    startX = e.touches[0].pageX - container.offsetLeft;
                    scrollLeft = container.scrollLeft;
                };

                const handleTouchEnd = () => {
                    if (!isDown) return;
                    isDown = false;
                    container.classList.remove('grabbing');

                    const slideWidth = container.clientWidth;
                    const targetSlide = Math.round(container.scrollLeft / slideWidth);

                    requestAnimationFrame(() => {
                        container.scrollTo({
                            left: targetSlide * slideWidth,
                            behavior: 'smooth'
                        });
                        updateDots(targetSlide);
                    });
                };

                const handleTouchMove = (e) => {
                    if (!isDown) return;

                    if (touchTimeout) return;
                    touchTimeout = setTimeout(() => touchTimeout = null, 16);

                    const x = e.touches[0].pageX - container.offsetLeft;
                    const walk = (x - startX) * 1.5;
                    container.scrollLeft = scrollLeft - walk;
                };

                const updateDots = (index) => {
                    if(!dotsContainer) return;
                    const dots = Array.from(dotsContainer.querySelectorAll('.dot'));
                    dots.forEach((dot, i) => dot.classList.toggle('active', i === index));
                    currentSlide = index;

                    if (prevButton && nextButton) {
                        prevButton.disabled = index === 0;
                        const totalSlides = Math.ceil(cards.length / getCardsPerView());
                        nextButton.disabled = index >= totalSlides - 1;
                    }
                };

                const createDots = () => {
                    if(!dotsContainer) return;
                    dotsContainer.innerHTML = '';
                    const totalSlides = Math.ceil(cards.length / getCardsPerView());

                    const fragment = document.createDocumentFragment();
                    for (let i = 0; i < totalSlides; i++) {
                        const dot = document.createElement('div');
                        dot.classList.add('dot');
                        if (i === 0) dot.classList.add('active');

                        dot.addEventListener('click', () => {
                            const slideWidth = container.clientWidth;
                            requestAnimationFrame(() => {
                                container.scrollTo({
                                    left: i * slideWidth,
                                    behavior: 'smooth'
                                });
                                updateDots(i);
                            });
                        });

                        fragment.appendChild(dot);
                    }
                    dotsContainer.appendChild(fragment);
                };

                if (prevButton && nextButton) {
                    const handleButtonClick = (direction) => {
                        const maxSlide = Math.ceil(cards.length / getCardsPerView()) - 1;
                        const newSlide = direction === 'prev' ? 
                            Math.max(0, currentSlide - 1) : 
                            Math.min(maxSlide, currentSlide + 1);

                        requestAnimationFrame(() => {
                            container.scrollTo({
                                left: newSlide * container.clientWidth,
                                behavior: 'smooth'
                            });
                            updateDots(newSlide);
                        });
                    };

                    prevButton.addEventListener('click', () => handleButtonClick('prev'));
                    nextButton.addEventListener('click', () => handleButtonClick('next'));
                }

                let scrollTimeout;
                const handleScroll = () => {
                    if (scrollTimeout) return;
                    scrollTimeout = setTimeout(() => {
                        const slideWidth = container.clientWidth;
                        const targetSlide = Math.round(container.scrollLeft / slideWidth);
                        updateDots(targetSlide);
                        scrollTimeout = null;
                    }, 50);
                };

                container.addEventListener('touchstart', handleTouchStart, { passive: true });
                container.addEventListener('touchend', handleTouchEnd);
                container.addEventListener('touchmove', handleTouchMove, { passive: false });
                container.addEventListener('scroll', handleScroll, { passive: true });

                createDots();

                const handleResize = debounce(() => {
                    createDots();
                    updateDots(0);
                    container.scrollLeft = 0;
                }, 250);

                window.addEventListener('resize', handleResize);

                return () => {
                    container.removeEventListener('touchstart', handleTouchStart);
                    container.removeEventListener('touchend', handleTouchEnd);
                    container.removeEventListener('touchmove', handleTouchMove);
                    container.removeEventListener('scroll', handleScroll);
                    window.removeEventListener('resize', handleResize);
                };
            }

            // --- Logic Expand Button (Giữ nguyên) ---
            function initializeExpandButtons(wrapper) {
                const cleanupFunctions = [];
                const buttons = wrapper.querySelectorAll('.expand-button');

                buttons.forEach(button => {
                    const content = button.closest('.specialty-content');
                    if(!content) return;
                    
                    const text = content.querySelector('.specialty-text');
                    const doctorsSlider = content.querySelector('.doctors-slider');
                    const buttonText = button.querySelector('.button-text');
                    const expandIcon = button.querySelector('.expand-icon');

                    const handleClick = () => {
                        text.classList.toggle('expanded');
                        doctorsSlider.classList.toggle('visible');
                        if(expandIcon) expandIcon.classList.toggle('expanded');

                        if(buttonText) {
                            buttonText.textContent = text.classList.contains('expanded')
                                ? 'Thu gọn nội dung'
                                : 'Xem thêm thông tin';
                        }
                    };

                    button.addEventListener('click', handleClick);
                    cleanupFunctions.push(() => button.removeEventListener('click', handleClick));
                });

                return () => cleanupFunctions.forEach(cleanup => cleanup());
            }

            // --- MAIN INITIALIZATION ---
            function initSpecialistComponent() {
                const wrapper = document.querySelector(COMPONENT_SELECTOR);
                if (!wrapper) {
                    console.error("Specialist wrapper not found in DOM");
                    return;
                }

                const cleanupFunctions = [];

                // 1. Init Image Sliders
                const specialtyImages = wrapper.querySelectorAll('.specialty-image');
                specialtyImages.forEach(image => {
                    const cleanup = initializeImageSlider(image);
                    if (cleanup) cleanupFunctions.push(cleanup);
                });

                // 2. Init Doctor Sliders
                const doctorsSliders = wrapper.querySelectorAll('.doctors-slider');
                doctorsSliders.forEach(slider => {
                    const cleanup = initializeDoctorSlider(slider);
                    if (cleanup) cleanupFunctions.push(cleanup);
                });

                // 3. Init Expand Buttons
                const expandCleanup = initializeExpandButtons(wrapper);
                if (expandCleanup) cleanupFunctions.push(expandCleanup);

                // Cleanup khi component bị remove (nếu có cơ chế SPA router unmount)
                // Lưu hàm này vào property của element để có thể gọi từ bên ngoài nếu cần
                wrapper._cleanupSpecialist = () => {
                    cleanupFunctions.forEach(fn => fn());
                };
            }

            // Chạy ngay lập tức khi script được load (vì lúc này HTML đã được inject)
            initSpecialistComponent();

        })();
    </script>
</div>