<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THOÁI HÓA KHỚP GỐI: 3 YẾU TỐ GÂY BỆNH CƠ BẢN BẠN CÓ THỂ KIỂM SOÁT ĐƯỢC - Tin Tức Y Khoa</title>

    <meta name="description" content="Thoái hóa khớp gối (OA) là một bệnh mạn tính thoái hóa rất phổ biến trên toàn thế giới. Đây là loại viêm khớp thường gặp nhất, gây ra đau, sưng, cứ...">
    <meta name="keywords" content="Khoa Cơ Xương Khớp, y học, sức khỏe, tin tức y khoa">
    <meta name="author" content="Medical Team">

    <meta property="og:type" content="article" />
    <meta property="og:title" content="THOÁI HÓA KHỚP GỐI: 3 YẾU TỐ GÂY BỆNH CƠ BẢN BẠN CÓ THỂ KIỂM SOÁT ĐƯỢC" />
    <meta property="og:description" content="Thoái hóa khớp gối (OA) là một bệnh mạn tính thoái hóa rất phổ biến trên toàn thế giới. Đây là loại viêm khớp thường gặp nhất, gây ra đau, sưng, cứ..." />
    <meta property="og:image" content="https://raw.githubusercontent.com/fmcclinic/Medical_News/refs/heads/main/news/image/%C4%91au-kh%E1%BB%9Bp-g%E1%BB%91i.gif" />
    <meta property="og:site_name" content="Tin Tức Y Khoa" />
    <meta property="article:section" content="Khoa Cơ Xương Khớp" />
    <meta property="article:published_time" content="31/10/2025" />

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="THOÁI HÓA KHỚP GỐI: 3 YẾU TỐ GÂY BỆNH CƠ BẢN BẠN CÓ THỂ KIỂM SOÁT ĐƯỢC">
    <meta name="twitter:description" content="Thoái hóa khớp gối (OA) là một bệnh mạn tính thoái hóa rất phổ biến trên toàn thế giới. Đây là loại viêm khớp thường gặp nhất, gây ra đau, sưng, cứ...">
    <meta name="twitter:image" content="https://raw.githubusercontent.com/fmcclinic/Medical_News/refs/heads/main/news/image/%C4%91au-kh%E1%BB%9Bp-g%E1%BB%91i.gif">
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=30xj8le1"></script>
    
    <script>
    function waitForResponsiveVoice() {
        return new Promise((resolve, reject) => {
            let attempts = 0;
            const checkResponsiveVoice = setInterval(() => {
                attempts++;
                if (window.responsiveVoice && window.responsiveVoice.voiceSupport()) {
                    clearInterval(checkResponsiveVoice);
                    resolve();
                } else if (attempts > 50) { 
                    clearInterval(checkResponsiveVoice);
                    reject(new Error('ResponsiveVoice không load được'));
                }
            }, 100);
        });
    }
    </script>

    <style>
         
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }

         
        .article-category {
            display: inline-block;
            background: #0070c0;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .article-title {
            font-size: 2em;
            margin-bottom: 15px;
            line-height: 1.2;
            color: #333;
            padding: 10px;
        }

        .article-meta {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .reading-time {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 3px 8px;
            background: #f0f0f0;
            border-radius: 15px;
        }

         
        .article-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

         
        .article-content img {
            max-width: 100% !important;  
            height: auto !important;     
            display: block;              
            margin: 10px auto;           
            border-radius: 4px;          
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);  
        }

         
        .featured-image {
            display: block;
            width: auto;
            max-width: 100%;
            height: 500px;
            margin: 0 auto 20px auto;
            object-fit: contain;
            background-color: #f0f2f5;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            .featured-image {
                width: 100%;
                height: auto;
                max-height: 500px;
                object-fit: cover;
            }
        }

        .article-content p {
            margin-bottom: 15px;
            line-height: 1.8;
            padding: 10px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .article-content p.current,
        .article-title.current {
            background: #f0f9ff;
            border-left: 3px solid #0070c0;
            padding-left: 15px;
        }

         
        .speech-controls {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .speech-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .speech-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }

        .controls-container {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .control-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: #0070c0;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .control-button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .control-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            min-width: 120px;
        }

        .progress-container {
            margin-top: 15px;
            background: #e9ecef;
            height: 4px;
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: #0070c0;
            width: 0;
            transition: width 0.3s;
        }

        .status {
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 4px;
            display: none;
        }

        .status.active {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status.reading {
            background: #e3f2fd;
            color: #0070c0;
            border-left: 4px solid #0070c0;
        }

        .status.paused {
            background: #fff3e0;
            color: #ef6c00;
            border-left: 4px solid #ef6c00;
        }

        .status.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #c62828;
        }

         
        .related-section {
            margin-top: 40px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .related-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #333;
        }

        .related-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .related-article {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .related-article:hover {
            transform: translateY(-3px);
        }

        .related-article img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }

        .related-article h3 {
            padding: 15px;
            margin: 0;
            flex: 1;
        }

        .related-article a {
            color: #333;
            text-decoration: none;
        }

        .related-article a:hover {
            color: #0070c0;
        }

        .related-article .date {
            display: block;
            padding: 0 15px 15px;
            color: #666;
            font-size: 0.9em;
        }

         
        .share-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .share-buttons {
            display: flex;
            gap: 10px;
        }

        .share-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: opacity 0.3s;
        }

        .share-button:hover {
            opacity: 0.9;
        }

        .share-button.facebook {
            background: #1877f2;
        }

        .share-button.twitter {
            background: #1da1f2;
        }

         
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .article-title {
                font-size: 1.8em;
            }

            .article-meta {
                flex-direction: column;
                align-items: flex-start;
            }

            .controls-container {
                flex-direction: column;
                align-items: stretch;
            }

            .related-grid {
                grid-template-columns: 1fr;
            }
        }

         
        .article-content ul, 
        .article-content ol {
            padding-left: 40px !important;
            margin-bottom: 15px;
            list-style-type: disc !important;
        }

        .article-content li {
            display: list-item !important;
            list-style-type: disc !important;
        }

        .article-content ul ul,
        .article-content ol ol,
        .article-content ul ol,
        .article-content ol ul {
            list-style-type: circle !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <span class="article-category">Khoa Cơ Xương Khớp</span>
        
        <h1 class="article-title">THOÁI HÓA KHỚP GỐI: 3 YẾU TỐ GÂY BỆNH CƠ BẢN BẠN CÓ THỂ KIỂM SOÁT ĐƯỢC</h1>
        
        <div class="article-meta">
            <span>Đăng ngày 31/10/2025</span>
            <span class="reading-time">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                6 phút đọc
            </span>
        </div>

        <img src="https://raw.githubusercontent.com/fmcclinic/Medical_News/refs/heads/main/news/image/%C4%91au-kh%E1%BB%9Bp-g%E1%BB%91i.gif" alt="THOÁI HÓA KHỚP GỐI: 3 YẾU TỐ GÂY BỆNH CƠ BẢN BẠN CÓ THỂ KIỂM SOÁT ĐƯỢC" class="featured-image">

        <div class="article-content">
            <div class="speech-controls">
                <div class="speech-header">
                    <span class="speech-title">Nghe bài viết</span>
                </div>
                
                <div class="controls-container">
                    <button id="mp3Button" class="control-button" onclick="toggleMP3()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                        </svg>
                        <span>Audio đã thu</span>
                    </button>

                    <button id="playButton" class="control-button">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                        <span>Đọc bài viết</span>
                    </button>
                    
                    <div class="speed-control">
                        <select id="voiceSelect">
                            <option value="Vietnamese Female">Giọng Nữ</option>
                            <option value="Vietnamese Male">Giọng Nam</option>
                        </select>
                        <select id="rateSelect">
                            <option value="0.8">Chậm</option>
                            <option value="1" selected>Bình thường</option>
                            <option value="1.2">Nhanh</option>
                        </select>
                    </div>
                </div>

                <audio id="mp3Player" class="audio-player" controls style="width: 100%; margin-top: 10px; display: none;">
                    <source id="mp3Source" type="audio/mpeg">
                    Trình duyệt không hỗ trợ phát audio.
                </audio>

                <div class="progress-container">
                    <div id="progress" class="progress-bar"></div>
                </div>

                <div id="status" class="status">
                    <span id="statusText"></span>
                </div>
            </div>

            
        <style>
           .article-content ul, .article-content ol { list-style-type: disc !important; margin-left: 20px !important; }
           .article-content li { display: list-item !important; list-style-type: disc !important; }
        </style>
      <p>Thoái hóa khớp gối (OA) là một bệnh mạn tính thoái hóa rất phổ biến trên toàn thế giới. Đây là loại viêm khớp thường gặp nhất, gây ra đau, sưng, cứng khớp và làm giảm khả năng vận động của bạn. Khớp gối là khớp thường bị ảnh hưởng nhất.</p><p>Nhiều người lầm tưởng thoái hóa khớp là điều không thể tránh khỏi khi về già, nhưng các chuyên gia y tế khẳng định rằng thoái hóa khớp không phải là hệ quả tất yếu của quá trình lão hóa. Trên thực tế, có ba yếu tố nguy cơ chính gây ra và làm trầm trọng thêm thoái hóa khớp gối mà bạn hoàn toàn có thể thay đổi và phòng ngừa.</p><p>Dưới đây là 3 yếu tố cơ học quan trọng có thể gây ra và thúc đẩy sự tiến triển của thoái hóa khớp gối, cùng với những lời khuyên hữu ích để bạn bảo vệ đôi chân của mình.</p><p>-------------------------------------------------------------------------------- </p><p>1. Thừa Cân hoặc Béo Phì (Quá Tải Trọng Lượng Cơ Thể)</p><p>Thừa cân và béo phì (đặc biệt nếu Chỉ số Khối cơ thể - BMI ≥ 30) là một trong những yếu tố nguy cơ hàng đầu dẫn đến thoái hóa khớp gối.</p><p>Cơ chế gây bệnh</p><p>Trọng lượng dư thừa tạo ra gánh nặng cơ học lên khớp gối—khớp chịu lực chính của cơ thể.</p><p>Béo phì không chỉ là vấn đề cơ học đơn thuần; nó còn liên quan đến các vấn đề chuyển hóa và viêm nhiễm hệ thống. Mô mỡ sản xuất các chất gọi là adipokine (ví dụ: leptin) có thể ảnh hưởng đến quá trình trao đổi chất của tế bào sụn và gây ra phản ứng viêm mãn tính trong cơ thể, làm tăng nguy cơ phát triển thoái hóa khớp.</p><p>Giải pháp phòng ngừa và kiểm soát</p><p>Giảm cân là một trong những biện pháp không dùng thuốc quan trọng nhất và được khuyến nghị mạnh mẽ cho những người bị thừa cân hoặc béo phì để giảm căng thẳng lên khớp gối và ngăn ngừa tổn thương thêm.</p><p>• Mục tiêu giảm cân: Giảm chỉ từ 5% đến 10% trọng lượng cơ thể đã có thể giúp giảm đau đáng kể và cải thiện chức năng khớp ở những bệnh nhân thừa cân hoặc béo phì.</p><p>• Phương pháp: Cách tiếp cận hiệu quả nhất là kết hợp kiểm soát chế độ ăn uống (giảm calo) và thực hiện các bài tập aerobic tác động thấp.</p><p>-------------------------------------------------------------------------------- </p><p>2. Chấn Thương Khớp Gối Trước Đó</p><p>Chấn thương khớp gối trong quá khứ là một yếu tố nguy cơ quan trọng, có khả năng làm tăng nguy cơ phát triển thoái hóa khớp gối lên gấp khoảng 2,83 lần.</p><p>Cơ chế gây bệnh</p><p>Chấn thương đầu gối (như gãy xương, căng cơ, hoặc các vết thương cũ) có thể gây ra thoái hóa khớp thứ phát. Chấn thương khớp làm tăng áp lực lên sụn và có thể làm mòn sụn khớp sớm hơn, dẫn đến các thay đổi thoái hóa theo thời gian.</p><p>Giải pháp phòng ngừa và kiểm soát</p><p>Duy trì thói quen sống an toàn và tránh chấn thương khớp là rất quan trọng để giảm thiểu rủi ro.</p><p>• Quản lý chấn thương: Nếu bạn từng bị chấn thương khớp gối, việc điều trị và phục hồi chức năng kịp thời, triệt để là rất cần thiết để giảm thiểu rủi ro phát triển thoái hóa khớp thứ phát.</p><p>• Phòng ngừa trong hoạt động: Đảm bảo sử dụng kỹ thuật thích hợp và trang bị bảo hộ đầy đủ khi tham gia các hoạt động thể chất (ví dụ: các môn thể thao đòi hỏi xoay, nhảy hoặc tiếp đất mạnh) để bảo vệ khớp.</p><p>-------------------------------------------------------------------------------- </p><p>3. Quá Tải Cơ học và Thiếu Vận động Thích hợp</p><p>Yếu tố này bao gồm cả việc lạm dụng khớp gối do công việc hoặc thể thao, và tình trạng cơ bắp xung quanh khớp yếu kém.</p><p>Cơ chế gây bệnh</p><p>• Quá tải lặp lại: Các nghề nghiệp đòi hỏi sử dụng khớp gối lặp đi lặp lại như quỳ gối, cúi gập gối hoặc các hoạt động thể chất cường độ cao có thể gây quá tải và làm mòn sụn khớp nhanh hơn.</p><p>• Yếu cơ: Yếu cơ tứ đầu đùi (cơ đùi trước) là một yếu tố rủi ro đã được xác định. Cơ bắp khỏe mạnh đóng vai trò hỗ trợ và ổn định khớp gối. Khi cơ yếu, áp lực chịu tải sẽ dồn trực tiếp lên khớp và sụn, tăng tốc độ thoái hóa.</p><p>Giải pháp phòng ngừa và kiểm soát</p><p>Tập thể dục và Vật lý trị liệu là phương pháp quản lý đầu tiên (first-line) và được khuyến nghị cho tất cả bệnh nhân thoái hóa khớp gối.</p><p>• Tăng cường sức mạnh: Chương trình tập luyện, đặc biệt là các bài tập tăng cường cơ hông và cơ đùi (như cơ tứ đầu), giúp cải thiện sức mạnh cơ bắp xung quanh gối, duy trì khả năng vận động và giảm đau.</p><p>• Lựa chọn hoạt động thích hợp: Nên chọn các hoạt động tác động thấp (low-impact) như bơi lội, đạp xe, hoặc đi bộ để giữ cho khớp gối linh hoạt và khỏe mạnh.</p><p>• Tránh quá tải: Cần tránh các hoạt động tác động mạnh, gây tải trọng lớn lên khớp (ví dụ: chạy bộ hoặc nhảy) vì chúng có thể làm nặng thêm các triệu chứng. Nếu công việc gây căng thẳng cho đầu gối, hãy xem xét các cách để điều chỉnh cách làm việc.</p><p>-------------------------------------------------------------------------------- </p><p>Tóm Lược và Lời Khuyên Quan Trọng</p><p>Thoái hóa khớp gối là một bệnh lý kéo dài suốt đời, mang tính chất tiến triển. Tuy nhiên, bạn có thể kiểm soát tốc độ tiến triển của bệnh và cải thiện chất lượng cuộc sống bằng cách tập trung vào ba lĩnh vực có thể thay đổi được này.</p><p>Các phương pháp điều trị hàng đầu cho thoái hóa khớp gối luôn bao gồm sự kết hợp giữa tập thể dục, giảm cân (nếu cần), và giáo dục/tự quản lý bệnh.</p><p>Nếu bạn đang bị đau gối, hãy nhớ:</p><p>1. Vận động là chìa khóa: Các bài tập được giám sát và chương trình tập luyện tại nhà có thể mang lại kết quả tốt nhất.</p><p>2. Giáo dục bản thân: Hiểu rõ về bệnh giúp bạn quản lý các triệu chứng tốt hơn.</p><p>3. Tham khảo ý kiến chuyên gia: Luôn trao đổi với bác sĩ hoặc nhà vật lý trị liệu để xây dựng kế hoạch điều trị cá nhân hóa, phù hợp với tình trạng sức khỏe cụ thể của bạn.</p><p>Việc điều trị thoái hóa khớp gối không thể chữa khỏi hoàn toàn (vì sụn khớp không thể tái tạo lại được), nhưng mục tiêu là giảm thiểu triệu chứng đau, cải thiện khả năng vận động, và ngăn ngừa tổn thương thêm. Bằng cách kiểm soát trọng lượng và duy trì hoạt động thích hợp, bạn đang thực hiện bước quan trọng nhất để làm chậm quá trình thoái hóa khớp gối.</p><p><br></p>
            <div class="share-section">
                <div class="share-buttons">
                    <button onclick="shareOnFacebook()" class="share-button facebook">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
                        </svg>
                        Chia sẻ Facebook
                    </button>
                    <button onclick="shareOnTwitter()" class="share-button twitter">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
                        </svg>
                        Chia sẻ Twitter
                    </button>
                </div>
            </div>
        </div>

        <div class="related-section">
            <h2 class="related-title">Bài viết liên quan</h2>
            <div class="related-grid">
                
        <div class="related-article">
          <a href="../NEWS_20251125195606/NEWS_20251125195606.html"><img src="https://drive.google.com/thumbnail?id=1zYJJN-0x8Of3e5SawUIQ-IsSKcfrO67L&amp;sz=w4096" alt="Cơn Gout Cấp – Hiểu Rõ “Kẻ Thù” Giấu Mặt Trong Khớp Xương"></a>
          <h3><a href="../NEWS_20251125195606/NEWS_20251125195606.html">Cơn Gout Cấp – Hiểu Rõ “Kẻ Thù” Giấu Mặt Trong Khớp Xương</a></h3>
          <span class="date">29/11/2025</span>
        </div>
        <div class="related-article">
          <a href="../NEWS_20251031081906/NEWS_20251031081906.html"><img src="https://github.com/fmcclinic/Medical_News/blob/main/news/image/What%20will%20the%20doctor%20do%20to%20diagnose%20knee%20osteoarthritis.gif?raw=true" alt="Bác sĩ sẽ làm gì để Chẩn đoán Thoái hóa khớp gối "></a>
          <h3><a href="../NEWS_20251031081906/NEWS_20251031081906.html">Bác sĩ sẽ làm gì để Chẩn đoán Thoái hóa khớp gối </a></h3>
          <span class="date">31/10/2025</span>
        </div>
        <div class="related-article">
          <a href="../NEWS_20251030171907/NEWS_20251030171907.html"><img src="https://github.com/fmcclinic/Medical_News/blob/main/news/image/Tho%C3%A1i-h%C3%B3a-kh%E1%BB%9Bp-g%E1%BB%91i.gif?raw=true" alt=" Điều Trị  Thoái hóa khớp gối"></a>
          <h3><a href="../NEWS_20251030171907/NEWS_20251030171907.html"> Điều Trị  Thoái hóa khớp gối</a></h3>
          <span class="date">30/10/2025</span>
        </div>            </div>
        </div>
    </div>

<script>

let currentMP3File = null;
let audioPreviewUrl = null;
let isPlaying = false;
let isTTSPlaying = false;
let isMP3Playing = false;
let ttsInitialized = false;
let currentParagraphIndex = 0;
let paragraphs = [];


const TTS_CONFIG = {
    VOICE_OPTIONS: {
        'Vietnamese Female': { name: 'Vietnamese Female', lang: 'vi-VN', rate: 1, pitch: 1.1, volume: 1 },
        'Vietnamese Male': { name: 'Vietnamese Male', lang: 'vi-VN', rate: 1, pitch: 0.9, volume: 1 }
    },
    PAUSE_BETWEEN: 500 
};


document.addEventListener('DOMContentLoaded', function() {
    if (typeof responsiveVoice !== 'undefined') {
        responsiveVoice.OnVoiceReady = function() {
            console.log('ResponsiveVoice sẵn sàng');
            initTTS();
            setupMP3EventListeners();
        };
    }
    window.scrollTo(0, 0);
    updateParentHeight();
});


new ResizeObserver(updateParentHeight).observe(document.body);


function initTTS() {
    console.log('Đang khởi tạo TTS');
    try {
        if (!responsiveVoice.voiceSupport()) {
            throw new Error('Trình duyệt không hỗ trợ TTS');
        }
        setupElements();
        loadContentToRead();
        setupEventListeners();
        
        const playButton = document.getElementById('playButton');
        if (playButton) playButton.disabled = false;
        
        ttsInitialized = true;
        updateStatus('Sẵn sàng đọc');
    } catch (error) {
        console.error('Lỗi khởi tạo TTS:', error);
        showError(error.message);
    }
}


function setupElements() {
    const elements = ['playButton', 'voiceSelect', 'rateSelect', 'status', 'progress'];
    elements.forEach(id => {
        if (!document.getElementById(id)) throw new Error(`Thiếu element: ${id}`);
    });
}


function loadContentToRead() {
    const title = document.querySelector('.article-title');
    const contentElements = document.querySelectorAll('.article-content p, .article-content div > p, .article-content ul > li, .article-content ol > li');
    
    paragraphs = [];
    if (title) paragraphs.push({ element: title, text: title.textContent.trim() });

    contentElements.forEach(element => {
        const text = element.textContent.trim();
        if (text.length > 0) paragraphs.push({ element: element, text: text });
    });
}


function setupEventListeners() {
    const playButton = document.getElementById('playButton');
    const voiceSelect = document.getElementById('voiceSelect');
    const rateSelect = document.getElementById('rateSelect');
    const mp3Button = document.getElementById('mp3Button');

    if (playButton) {
        playButton.addEventListener('click', function(e) {
            e.preventDefault();
            toggleSpeech();
        });
    }
    if (voiceSelect) voiceSelect.addEventListener('change', handleVoiceChange);
    if (rateSelect) rateSelect.addEventListener('change', handleRateChange);
    if (mp3Button) mp3Button.addEventListener('click', toggleMP3);
}


function toggleMP3() {
    const mp3Player = document.getElementById('mp3Player');
    const mp3Button = document.getElementById('mp3Button');

    if (!mp3Player || !mp3Button) return;

    
    const pathParts = window.location.pathname.split('/');
    const newsId = pathParts[pathParts.length - 1].replace('.html', '');
    const mp3Path = `${newsId}.mp3`;

    const mp3Source = mp3Player.querySelector('source');
    if (!mp3Source?.src) mp3Source.src = mp3Path;

    mp3Player.style.display = 'block';

    if (mp3Player.paused) {
        mp3Player.load();
        mp3Player.addEventListener('loadeddata', function onLoad() {
            mp3Player.removeEventListener('loadeddata', onLoad);
            mp3Player.play()
                .then(() => {
                    isMP3Playing = true;
                    mp3Button.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg><span>Tạm dừng</span>`;
                })
                .catch(error => { isMP3Playing = false; });
        });
    } else {
        mp3Player.pause();
        isMP3Playing = false;
        mp3Button.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/>	</svg><span>Audio đã thu</span>`;
    }
}


function setupMP3EventListeners() {
    const mp3Player = document.getElementById('mp3Player');
    const mp3Button = document.getElementById('mp3Button');
    if (mp3Player && mp3Button) {
        mp3Player.addEventListener('ended', function() {
            isMP3Playing = false;
            mp3Button.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/></svg><span>Audio đã thu</span>`;
        });
    }
}


function toggleSpeech() {
    if (isMP3Playing) {
        const mp3Player = document.getElementById('mp3Player');
        const mp3Button = document.getElementById('mp3Button');
        mp3Player.pause();
        isMP3Playing = false;
        if (mp3Button) mp3Button.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/></svg><span>Audio đã thu</span>`;
    }

    if (!ttsInitialized) {
        showError('TTS chưa sẵn sàng');
        return;
    }

    if (!isPlaying) {
        startReading();
        isTTSPlaying = true;
    } else {
        stopReading();
        isTTSPlaying = false;
    }
}


function startReading() {
    isPlaying = true;
    currentParagraphIndex = 0;
    updateUI('reading');
    readNextParagraph();
}


function readNextParagraph() {
    if (currentParagraphIndex < paragraphs.length) {
        try {
            const voiceName = document.getElementById('voiceSelect').value;
            const rate = parseFloat(document.getElementById('rateSelect').value);
            const voiceConfig = TTS_CONFIG.VOICE_OPTIONS[voiceName];

            updateProgress(((currentParagraphIndex + 1) / paragraphs.length) * 100);
            highlightParagraph(currentParagraphIndex);

            responsiveVoice.speak(
                paragraphs[currentParagraphIndex].text,
                voiceName,
                {
                    pitch: voiceConfig.pitch,
                    rate: rate,
                    volume: voiceConfig.volume,
                    lang: voiceConfig.lang,
                    onstart: function() { updateStatus(`Đang đọc đoạn ${currentParagraphIndex + 1}/${paragraphs.length}`); },
                    onend: function() {
                        unhighlightParagraph(currentParagraphIndex);
                        currentParagraphIndex++;
                        if (isPlaying && currentParagraphIndex < paragraphs.length) {
                            setTimeout(readNextParagraph, TTS_CONFIG.PAUSE_BETWEEN);
                        } else if (currentParagraphIndex >= paragraphs.length) {
                            finishReading();
                        }
                    }
                }
            );
        } catch (error) {
            stopReading();
        }
    } else {
        finishReading();
    }
}

function stopReading() {
    responsiveVoice.cancel();
    isPlaying = false;
    isTTSPlaying = false;
    unhighlightAll();
    updateUI('paused');
}

function finishReading() {
    isPlaying = false;
    isTTSPlaying = false;
    updateProgress(100);
    updateUI('finished');
    unhighlightAll();
}

function highlightParagraph(index) {
    if (paragraphs[index]) {
        paragraphs[index].element.classList.add('current');
        scrollToParagraph(paragraphs[index].element);
    }
}

function unhighlightParagraph(index) {
    if (paragraphs[index]) paragraphs[index].element.classList.remove('current');
}

function unhighlightAll() {
    paragraphs.forEach(p => p.element.classList.remove('current'));
}

function scrollToParagraph(element) {
    element.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

function updateUI(state) {
    const button = document.getElementById('playButton');
    if (button) {
        button.innerHTML = isPlaying ? 
            `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg><span>Tạm dừng</span>` :
            `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg><span>Đọc bài viết</span>`;
    }
    updateStatus(state);
}

function updateStatus(state) {
    const status = document.getElementById('status');
    const statusText = document.getElementById('statusText');
    if (status && statusText) {
        status.className = 'status active ' + state;
        statusText.textContent = typeof state === 'string' ? state : 
            state === 'reading' ? 'Đang đọc...' :
            state === 'paused' ? 'Đã tạm dừng' :
            state === 'finished' ? 'Đã đọc xong' : '';
    }
}

function updateProgress(percent) {
    const progress = document.getElementById('progress');
    if (progress) progress.style.width = percent + '%';
}

function handleVoiceChange() { if (isPlaying) restartReading(); }
function handleRateChange() { if (isPlaying) restartReading(); }
function restartReading() { stopReading(); startReading(); }

function showError(message) {
    const statusText = document.getElementById('statusText');
    const status = document.getElementById('status');
    if (statusText && status) {
        statusText.textContent = message;
        status.className = 'status active error';
    }
}

function updateParentHeight() {
    const height = document.documentElement.scrollHeight;
    window.parent.postMessage({ height: height }, '*');
}

function shareOnFacebook() {
    const url = window.location.href;
    window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(url));
}

function shareOnTwitter() {
    const url = window.location.href;
    const title = document.title;
    window.open('https://twitter.com/intent/tweet?url=' + encodeURIComponent(url) + '&text=' + encodeURIComponent(title));
}
</script>
</body>
</html>