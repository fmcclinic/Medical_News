<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chuẩn bị sinh nở - Những điều mẹ bầu cần biết - Tin Tức Y Khoa</title>
    
<script src="https://code.responsivevoice.org/responsivevoice.js?key=30xj8le1"></script>
        
  <script>
function waitForResponsiveVoice() {
    return new Promise((resolve, reject) => {
        let attempts = 0;
        const checkResponsiveVoice = setInterval(() => {
            attempts++;
            if (window.responsiveVoice && window.responsiveVoice.voiceSupport()) {
                clearInterval(checkResponsiveVoice);
                resolve();
            } else if (attempts > 50) { 
                clearInterval(checkResponsiveVoice);
                reject(new Error('ResponsiveVoice không load được'));
            }
        }, 100);
    });
}
    </script>


        <style>
         
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }

         
        .article-category {
            display: inline-block;
            background: #0070c0;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .article-title {
            font-size: 2em;
            margin-bottom: 15px;
            line-height: 1.2;
            color: #333;
            padding: 10px;
        }

        .article-meta {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .reading-time {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 3px 8px;
            background: #f0f0f0;
            border-radius: 15px;
        }

         
        .article-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .featured-image {
            width: 100%;
            height: auto;
            max-height: 500px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .article-content p {
            margin-bottom: 15px;
            line-height: 1.8;
            padding: 10px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .article-content p.current,
        .article-title.current {
            background: #f0f9ff;
            border-left: 3px solid #0070c0;
            padding-left: 15px;
        }

         
        .speech-controls {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .speech-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .speech-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }

        .controls-container {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .control-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: #0070c0;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .control-button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .control-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            min-width: 120px;
        }

        .progress-container {
            margin-top: 15px;
            background: #e9ecef;
            height: 4px;
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: #0070c0;
            width: 0;
            transition: width 0.3s;
        }

        .status {
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 4px;
            display: none;
        }

        .status.active {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status.reading {
            background: #e3f2fd;
            color: #0070c0;
            border-left: 4px solid #0070c0;
        }

        .status.paused {
            background: #fff3e0;
            color: #ef6c00;
            border-left: 4px solid #ef6c00;
        }

        .status.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #c62828;
        }

         
        .related-section {
            margin-top: 40px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .related-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #333;
        }

        .related-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .related-article {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .related-article:hover {
            transform: translateY(-3px);
        }

        .related-article img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }

        .related-article h3 {
            padding: 15px;
            margin: 0;
            flex: 1;
        }

        .related-article a {
            color: #333;
            text-decoration: none;
        }

        .related-article a:hover {
            color: #0070c0;
        }

        .related-article .date {
            display: block;
            padding: 0 15px 15px;
            color: #666;
            font-size: 0.9em;
        }

         
        .share-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .share-buttons {
            display: flex;
            gap: 10px;
        }

        .share-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: opacity 0.3s;
        }

        .share-button:hover {
            opacity: 0.9;
        }

        .share-button.facebook {
            background: #1877f2;
        }

        .share-button.twitter {
            background: #1da1f2;
        }

         
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .article-title {
                font-size: 1.8em;
            }

            .article-meta {
                flex-direction: column;
                align-items: flex-start;
            }

            .controls-container {
                flex-direction: column;
                align-items: stretch;
            }

            .related-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <span class="article-category">Sản Phụ Khoa</span>
        
        <h1 class="article-title">Chuẩn bị sinh nở - Những điều mẹ bầu cần biết</h1>
        
        <div class="article-meta">
            <span>Đăng ngày 22/12/2024</span>
            <span class="reading-time">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                3 phút đọc
            </span>
        </div>

        <img src="https://github.com/fmcclinic/Medical_News/blob/main/news/image/Chu%E1%BA%A9n%20b%E1%BB%8B%20sinh%20n%E1%BB%9F%20Nh%E1%BB%AFng%20%C4%91i%E1%BB%81u%20m%E1%BA%B9%20b%E1%BA%A7u%20c%E1%BA%A7n%20bi%E1%BA%BFt.jpg?raw=true" alt="Chuẩn bị sinh nở - Những điều mẹ bầu cần biết" class="featured-image">

        <div class="article-content">



<div class="speech-controls">
    <div class="speech-header">
        <span class="speech-title">Nghe bài viết</span>
    </div>
    
    <div class="controls-container">
        
        <button id="mp3Button" class="control-button" onclick="toggleMP3()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
            </svg>
            <span>Audio đã thu</span>
        </button>

        
        <button id="playButton" class="control-button">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
            <span>Đọc bài viết</span>
        </button>
        
        
        <div class="speed-control">
            <select id="voiceSelect">
                <option value="Vietnamese Female">Giọng Nữ</option>
                <option value="Vietnamese Male">Giọng Nam</option>
            </select>
            <select id="rateSelect">
                <option value="0.8">Chậm</option>
                <option value="1" selected>Bình thường</option>
                <option value="1.2">Nhanh</option>
            </select>
        </div>
    </div>

    
    <audio id="mp3Player" class="audio-player" controls style="width: 100%; margin-top: 10px; display: none;">
        <source id="mp3Source" type="audio/mpeg">
        Trình duyệt không hỗ trợ phát audio.
    </audio>

    <div class="progress-container">
        <div id="progress" class="progress-bar"></div>
    </div>

    <div id="status" class="status">
        <span id="statusText"></span>
    </div>
</div>


            <h1>Chuẩn bị sinh nở - Những điều mẹ bầu cần biết</h1><h2>Giới thiệu</h2><p>Việc chuẩn bị chu đáo cho quá trình sinh nở không chỉ giúp thai phụ tự tin hơn mà còn đảm bảo mọi thứ diễn ra suôn sẻ. Bài viết này sẽ hướng dẫn chi tiết những điều cần chuẩn bị từ giai đoạn cuối thai kỳ đến khi chuyển dạ.</p><h2>I. Nhận biết dấu hiệu chuyển dạ</h2><h3>1. Dấu hiệu chuyển dạ thật</h3><ul><li>Ra nhầy hồng hoặc có máu</li><li>Cơn co tử cung đều đặn, khoảng cách ngắn dần</li><li>Đau lưng dữ dội và liên tục</li><li>Vỡ ối (nước ối trong hoặc hơi vàng nhạt)</li><li>Cảm giác tăng áp lực vùng xương chậu</li></ul><h3>2. Dấu hiệu chuyển dạ giả</h3><ul><li>Co thắt không đều</li><li>Thay đổi vị trí có thể giảm đau</li><li>Không tăng cường độ theo thời gian</li><li>Không kèm theo các dấu hiệu khác</li></ul><h2>II. Chuẩn bị đồ dùng cần thiết</h2><h3>1. Cho mẹ</h3><ul><li>Quần áo rộng rãi, thoáng mát</li><li>Đồ lót và áo ngực cho con bú</li><li>Băng vệ sinh loại dày</li><li>Dép đi trong bệnh viện</li><li>Đồ dùng vệ sinh cá nhân</li><li>Khăn tắm, khăn mặt</li><li>Nước uống và đồ ăn nhẹ</li></ul><h3>2. Cho bé</h3><ul><li>Bỉm sơ sinh</li><li>Khăn quấn, khăn tắm</li><li>Quần áo sơ sinh (3-4 bộ)</li><li>Mũ, bao tay, bao chân</li><li>Gạc rốn</li><li>Khăn ướt không mùi</li></ul><h3>3. Giấy tờ quan trọng</h3><ul><li>Sổ khám thai</li><li>Các kết quả xét nghiệm</li><li>Giấy tờ tùy thân</li><li>Bảo hiểm y tế</li><li>Tiền mặt và thẻ ngân hàng</li></ul><h2>III. Các phương pháp sinh và lựa chọn</h2><h3>1. Sinh thường</h3><p><strong>Ưu điểm:</strong></p><ul><li>Phục hồi nhanh</li><li>Ít biến chứng</li><li>Tốt cho hệ miễn dịch của bé</li><li>Chi phí thấp hơn</li></ul><p><strong>Nhược điểm:</strong></p><ul><li>Thời gian chuyển dạ lâu</li><li>Đau đớn nhiều</li><li>Có thể gặp biến chứng khi sinh</li></ul><h3>2. Sinh mổ</h3><p><strong>Ưu điểm:</strong></p><ul><li>Chủ động thời gian</li><li>Ít đau đớn khi sinh</li><li>Phù hợp với một số trường hợp đặc biệt</li></ul><p><strong>Nhược điểm:</strong></p><ul><li>Thời gian phục hồi lâu</li><li>Chi phí cao hơn</li><li>Có thể có biến chứng sau mổ</li><li>Ảnh hưởng đến các lần sinh sau</li></ul><h2>IV. Chuẩn bị tâm lý</h2><h3>1. Trước khi sinh</h3><ul><li>Tham gia lớp tiền sản</li><li>Trao đổi với bác sĩ về kế hoạch sinh</li><li>Chia sẻ lo lắng với người thân</li><li>Tập các bài thở và thư giãn</li></ul><h3>2. Khi chuyển dạ</h3><ul><li>Giữ bình tĩnh</li><li>Thực hiện các bài thở đã học</li><li>Tuân theo hướng dẫn của nhân viên y tế</li><li>Có người thân hỗ trợ tinh thần</li></ul><h2>V. Những việc cần làm trước khi sinh</h2><h3>1. Khám thai định kỳ</h3><ul><li>Tuần 36-38: mỗi tuần một lần</li><li>Kiểm tra các chỉ số quan trọng</li><li>Siêu âm đánh giá thai nhi</li><li>Xét nghiệm cần thiết</li></ul><h3>2. Chuẩn bị môi trường</h3><ul><li>Sắp xếp nhà cửa gọn gàng</li><li>Chuẩn bị góc cho bé</li><li>Vệ sinh đồ dùng cho bé</li><li>Lên kế hoạch di chuyển đến bệnh viện</li></ul><h2>VI. Tình huống khẩn cấp cần đến viện ngay</h2><ol><li>Ra máu âm đạo nhiều</li><li>Đau bụng dữ dội liên tục</li><li>Vỡ ối sớm</li><li>Thai máy giảm hoặc không cử động</li><li>Sốt cao trên 38.5°C</li><li>Phù nề đột ngột</li><li>Đau đầu dữ dội kèm rối loạn thị giác</li></ol><h2>Lời khuyên</h2><ol><li>Lập danh sách đồ dùng cần thiết từ sớm</li><li>Chuẩn bị sẵn túi đồ từ tuần 35-36</li><li>Lưu số điện thoại bác sĩ và bệnh viện</li><li>Thảo luận kế hoạch sinh với người thân</li><li>Tìm hiểu về các phương pháp giảm đau</li><li>Chuẩn bị phương tiện di chuyển đến bệnh viện</li><li>Giữ tinh thần lạc quan và thoải mái</li></ol><p>Việc chuẩn bị chu đáo cho quá trình sinh nở sẽ giúp thai phụ tự tin và bình tĩnh hơn khi thời điểm quan trọng đến. Tuy nhiên, cần linh hoạt và sẵn sàng điều chỉnh kế hoạch nếu có thay đổi phát sinh. Điều quan trọng nhất là đảm bảo an toàn cho cả mẹ và bé.</p>
            <div class="share-section">
                <div class="share-buttons">
                    <button onclick="shareOnFacebook()" class="share-button facebook">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
                        </svg>
                        Chia sẻ Facebook
                    </button>
                    <button onclick="shareOnTwitter()" class="share-button twitter">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
                        </svg>
                        Chia sẻ Twitter
                    </button>
                </div>
            </div>
        </div>

        <div class="related-section">
            <h2 class="related-title">Bài viết liên quan</h2>
            <div class="related-grid">
                
      <div class="related-article">
        <img src="https://github.com/fmcclinic/Medical_News/blob/main/news/image/Chu%E1%BA%A9n%20b%E1%BB%8B%20sinh%20n%E1%BB%9F%20Nh%E1%BB%AFng%20%C4%91i%E1%BB%81u%20m%E1%BA%B9%20b%E1%BA%A7u%20c%E1%BA%A7n%20bi%E1%BA%BFt.jpg?raw=true" alt="Chuẩn bị sinh nở - Những điều mẹ bầu cần biết">
        <h3>
          <a href="../../articles/NEWS_20241222163936/NEWS_20241222163936.html">Chuẩn bị sinh nở - Những điều mẹ bầu cần biết</a>
        </h3>
        <span class="date">22/12/2024</span>
      </div>
    
      <div class="related-article">
        <img src="https://github.com/fmcclinic/Medical_News/blob/main/news/image/Chu%E1%BA%A9n%20b%E1%BB%8B%20sinh%20n%E1%BB%9F%20Nh%E1%BB%AFng%20%C4%91i%E1%BB%81u%20m%E1%BA%B9%20b%E1%BA%A7u%20c%E1%BA%A7n%20bi%E1%BA%BFt.jpg?raw=true" alt="Chuẩn bị sinh nở - Những điều mẹ bầu cần biết.">
        <h3>
          <a href="../../articles/NEWS_20241222163153/NEWS_20241222163153.html">Chuẩn bị sinh nở - Những điều mẹ bầu cần biết.</a>
        </h3>
        <span class="date">22/12/2024</span>
      </div>
    
      <div class="related-article">
        <img src="https://raw.githubusercontent.com/fmcclinic/Medical_News/refs/heads/main/news/image/A%20woman%20with%20a%20visible%20pregnancy.jpg" alt="Dinh dưỡng trong thai kỳ - Ăn gì để mẹ khỏe con thông minh?">
        <h3>
          <a href="../../articles/NEWS_20241221144428/NEWS_20241221144428.html">Dinh dưỡng trong thai kỳ - Ăn gì để mẹ khỏe con thông minh?</a>
        </h3>
        <span class="date">21/12/2024</span>
      </div>
                </div>
        </div>
    </div>

<script>

const TTS_CONFIG = {
   VOICE_OPTIONS: {
       'Vietnamese Female': {
           name: 'Vietnamese Female',
           lang: 'vi-VN',
           rate: 1,
           pitch: 1.1,
           volume: 1
       },
       'Vietnamese Male': {
           name: 'Vietnamese Male',
           lang: 'vi-VN',
           rate: 1,
           pitch: 0.9,
           volume: 1
       }
   },
   PAUSE_BETWEEN: 500 
};





document.addEventListener('DOMContentLoaded', async function() {
    try {
        
        await waitForResponsiveVoice();
        console.log('ResponsiveVoice đã load và sẵn sàng');

        
        initTTS();
        checkForMP3();

    } catch (error) {
        console.error('Không thể khởi tạo ResponsiveVoice:', error);
    }
});


function initTTS() {
    console.log('Đang khởi tạo TTS');
    try {
        if (!window.responsiveVoice) {
            throw new Error('ResponsiveVoice chưa load');
        }

        if (!window.responsiveVoice.voiceSupport()) {
            throw new Error('Trình duyệt không hỗ trợ TTS');
        }

        setupElements();
        loadContentToRead();
        setupEventListeners();
        
        const playButton = document.getElementById('playButton');
        if (playButton) {
            playButton.disabled = false;
        }
        
        ttsInitialized = true;
        console.log('TTS đã khởi tạo thành công');
        updateStatus('Sẵn sàng đọc');

    } catch (error) {
        console.error('Lỗi khởi tạo TTS:', error);
        showError(error.message);
    }
}


function showError(message) {
    console.error(message);
    const statusText = document.getElementById('statusText');
    const status = document.getElementById('status');
    if (statusText && status) {
        statusText.textContent = message;
        status.className = 'status active error';
    }
}


function checkForMP3() {
   const pathParts = window.location.pathname.split('/');
   const newsId = pathParts[pathParts.length - 1].replace('.html', '');
   const mp3Path = `${newsId}.mp3`;
   
   const audio = document.createElement('audio');
   audio.addEventListener('canplaythrough', function() {
       setupMP3Player(mp3Path);
   });

   audio.addEventListener('error', function() {
       console.log('Không tìm thấy file MP3');
       document.getElementById('mp3Button').disabled = true;
   });

   audio.src = mp3Path;
   audio.load();
}


function setupMP3Player(mp3Path) {
   const mp3Player = document.getElementById('mp3Player');
   document.getElementById('mp3Source').src = mp3Path;
   mp3Player.load();

   
   const mp3Button = document.getElementById('mp3Button');
   mp3Button.disabled = false;
   mp3Button.onclick = toggleMP3;

   
   mp3Player.addEventListener('ended', function() {
       isMP3Playing = false;
       resetMP3Button();
   });
}




function resetMP3Button() {
   const mp3Button = document.getElementById('mp3Button');
   mp3Button.innerHTML = `
       <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
           <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
           <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
           <line x1="12" y1="19" x2="12" y2="23"/>
           <line x1="8" y1="23" x2="16" y2="23"/>
       </svg>
       <span>Audio đã thu</span>`;
}




function setupElements() {
   const elements = ['playButton', 'voiceSelect', 'rateSelect', 'status', 'progress'];
   elements.forEach(id => {
       if (!document.getElementById(id)) {
           throw new Error(`Thiếu element: ${id}`);
       }
   });
}


function loadContentToRead() {
    const title = document.querySelector('.article-title');
    const paragraphElements = document.querySelectorAll('.article-content p');

    console.log('Title element:', title);
    console.log('Paragraph elements:', paragraphElements);

    paragraphs = [];

    
    if (title) {
        paragraphs.push({
            element: title,
            text: title.textContent.trim()
        });
    }

    
    const content = document.querySelector('.article-content');
    if (content) {
        
        const textElements = content.querySelectorAll('p, div > p, ul > li, ol > li');
        textElements.forEach((element) => {
            const text = element.textContent.trim();
            if (text.length > 0) {
                paragraphs.push({
                    element: element,
                    text: text
                });
            }
        });
    }

    console.log('Total paragraphs loaded:', paragraphs.length);
    console.log('Paragraphs content:', paragraphs.map(p => p.text));
}





function startReading() {
   isPlaying = true;
   currentParagraphIndex = 0;
   updateUI('reading');
   readNextParagraph();
}




function highlightParagraph(index) {
   if (paragraphs[index]) {
       paragraphs[index].element.classList.add('current');
       scrollToParagraph(paragraphs[index].element);
   }
}


function unhighlightParagraph(index) {
   if (paragraphs[index]) {
       paragraphs[index].element.classList.remove('current');
   }
}


function unhighlightAll() {
   paragraphs.forEach(p => p.element.classList.remove('current'));
}


function scrollToParagraph(element) {
   element.scrollIntoView({
       behavior: 'smooth',
       block: 'center'
   });
}


function updateUI(state) {
   const button = document.getElementById('playButton');
   if (button) {
       button.innerHTML = isPlaying ? 
           `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
               <rect x="6" y="4" width="4" height="16"></rect>
               <rect x="14" y="4" width="4" height="16"></rect>
           </svg>
           <span>Tạm dừng</span>` :
           `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
               <polygon points="5 3 19 12 5 21 5 3"></polygon>
           </svg>
           <span>Đọc bài viết</span>`;
   }
   updateStatus(state);
}

// Update status message
function updateStatus(state) {
   const status = document.getElementById('status');
   const statusText = document.getElementById('statusText');
   if (status && statusText) {
       status.className = 'status active ' + state;
       statusText.textContent = typeof state === 'string' ? state : 
           state === 'reading' ? 'Đang đọc...' :
           state === 'paused' ? 'Đã tạm dừng' :
           state === 'finished' ? 'Đã đọc xong' : '';
   }
}


function updateProgress(percent) {
   const progress = document.getElementById('progress');
   if (progress) {
       progress.style.width = percent + '%';
   }
}


function handleVoiceChange() {
   if (isPlaying) {
       restartReading();
   }
}


function handleRateChange() {
   if (isPlaying) {
       restartReading();
   }
}


function restartReading() {
   stopReading();
   startReading();
}


function showError(message) {
   console.error(message);
   updateStatus('error');
   const statusText = document.getElementById('statusText');
   if (statusText) {
       statusText.textContent = message;
   }
}












function toggleMP3() {
    const mp3Player = document.getElementById('mp3Player');
    const mp3Button = document.getElementById('mp3Button');

    
    mp3Player.style.display = 'block';
    
    if (mp3Player.paused) {
        
        mp3Player.play()
            .then(() => {
                mp3Button.innerHTML = `
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <rect x="6" y="4" width="4" height="16"></rect>
                        <rect x="14" y="4" width="4" height="16"></rect>
                    </svg>
                    <span>Tạm dừng</span>`;
            })
            .catch(error => {
                console.error('Error playing MP3:', error);
            });
    } else {
        
        mp3Player.pause();
        mp3Button.innerHTML = `
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
            </svg>
            <span>Audio đã thu</span>`;
    }
}


document.addEventListener('DOMContentLoaded', function() {
    const mp3Player = document.getElementById('mp3Player');
    const mp3Button = document.getElementById('mp3Button');

    if (mp3Player) {
        mp3Player.addEventListener('ended', function() {
            mp3Button.innerHTML = `
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                </svg>
                <span>Audio đã thu</span>`;
        });
    }
});

function setupMP3EventListeners() {
    const mp3Player = document.getElementById('mp3Preview');
    const mp3Button = document.getElementById('mp3Button');
    
    if (mp3Player) {
        mp3Player.addEventListener('ended', function() {
            
            if (mp3Button) {
                mp3Button.innerHTML = `
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                        <line x1="12" y1="19" x2="12" y2="23"/>
                        <line x1="8" y1="23" x2="16" y2="23"/>
                    </svg>
                    <span>Audio đã thu</span>`;
            }
        });
    }
}

function showMP3Preview(file) {
    const statusDiv = document.getElementById('currentMP3Status');
    const nameSpan = document.getElementById('currentMP3Name');
    const audio = document.getElementById('mp3Preview');
    const source = document.getElementById('mp3Source');

    if (statusDiv && nameSpan && audio && source) {
        statusDiv.style.display = 'block';
        nameSpan.textContent = file.name;
        
        if (audioPreviewUrl) {
            URL.revokeObjectURL(audioPreviewUrl);
        }
        audioPreviewUrl = URL.createObjectURL(file);
        source.src = audioPreviewUrl;
        audio.load();

        
        setupMP3EventListeners();
        
        showToast('Đã chọn file MP3: ' + file.name, 'success');
    }
}



function setupMP3Player(mp3Path) {
    console.log('Setting up MP3 player with path:', mp3Path);
    
    const mp3Player = document.getElementById('mp3Player');
    const mp3Button = document.getElementById('mp3Button');
    
    if (!mp3Player || !mp3Button) {
        console.error('Missing MP3 elements');
        return;
    }

    
    document.getElementById('mp3Source').src = mp3Path;
    mp3Player.load();

    
    mp3Button.addEventListener('click', function(e) {
        e.preventDefault();
        toggleMP3();
    });

    
    mp3Button.disabled = false;

    console.log('MP3 player setup complete');
}


function setupEventListeners() {
    console.log('Setting up event listeners');
    
    const playButton = document.getElementById('playButton');
    const voiceSelect = document.getElementById('voiceSelect');
    const rateSelect = document.getElementById('rateSelect');

    if (playButton) {
        playButton.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('TTS button clicked');
            toggleSpeech();
        });
    }

    if (voiceSelect) {
        voiceSelect.addEventListener('change', handleVoiceChange);
    }

    if (rateSelect) {
        rateSelect.addEventListener('change', handleRateChange);
    }

    console.log('Event listeners setup complete');
}


function toggleSpeech() {
    console.log('toggleSpeech called, ttsInitialized:', ttsInitialized);
    console.log('isPlaying:', isPlaying);

    if (!ttsInitialized) {
        console.error('TTS not initialized');
        showError('TTS chưa sẵn sàng');
        return;
    }

    if (isMP3Playing) {
        const mp3Player = document.getElementById('mp3Player');
        mp3Player.pause();
        isMP3Playing = false;
        resetMP3Button();
    }

    if (!isPlaying) {
        startReading();
    } else {
        stopReading();
    }
}









function toggleSpeech() {
    console.log('toggleSpeech called, ttsInitialized:', ttsInitialized);
    console.log('isPlaying:', isPlaying);

    
    if (!ttsInitialized && !initTTS()) {
        showError('TTS chưa sẵn sàng, vui lòng thử lại');
        return;
    }

    
    if (isMP3Playing) {
        const mp3Player = document.getElementById('mp3Player');
        mp3Player.pause();
        isMP3Playing = false;
        resetMP3Button();
    }

    if (!isPlaying) {
        startReading();
    } else {
        stopReading();
    }
}








function toggleSpeech() {
    console.log('toggleSpeech called, ttsInitialized:', ttsInitialized);
    console.log('isPlaying before toggle:', isPlaying);

    if (!ttsInitialized) {
        showError('TTS chưa sẵn sàng');
        return;
    }

    if (isMP3Playing) {
        const mp3Player = document.getElementById('mp3Player');
        mp3Player.pause();
        isMP3Playing = false;
        resetMP3Button();
    }

    isPlaying = !isPlaying; 
    console.log('isPlaying after toggle:', isPlaying);

    if (isPlaying) {
        startReading();
    } else {
        stopReading();
    }
}



function setupEventListeners() {
    console.log('Setting up event listeners');
    
    
    const playButton = document.getElementById('playButton');
    if (playButton) {
        playButton.removeEventListener('click', toggleSpeech); 
        playButton.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation(); 
            console.log('TTS button clicked');
            
            if (!isPlaying) {
                isPlaying = true;
                startReading();
            } else {
                isPlaying = false;
                stopReading();
            }
        });
    }

    
    const voiceSelect = document.getElementById('voiceSelect');
    const rateSelect = document.getElementById('rateSelect');

    if (voiceSelect) {
        voiceSelect.addEventListener('change', handleVoiceChange);
    }

    if (rateSelect) {
        rateSelect.addEventListener('change', handleRateChange);
    }

    console.log('Event listeners setup complete');
}

function readNextParagraph() {
    console.log('Reading paragraph:', currentParagraphIndex + 1, 'of', paragraphs.length);
    console.log('isPlaying status:', isPlaying);

    if (currentParagraphIndex < paragraphs.length) {
        try {
            const voiceName = document.getElementById('voiceSelect').value;
            const rate = parseFloat(document.getElementById('rateSelect').value);

            console.log('Current text:', paragraphs[currentParagraphIndex].text);
            console.log('Voice:', voiceName, 'Rate:', rate);

            responsiveVoice.speak(
                paragraphs[currentParagraphIndex].text,
                voiceName,
                {
                    rate: rate,
                    onstart: () => {
                        console.log(`Bắt đầu đọc đoạn ${currentParagraphIndex + 1}/${paragraphs.length}`);
                        updateStatus(`Đang đọc đoạn ${currentParagraphIndex + 1}/${paragraphs.length}`);
                        highlightParagraph(currentParagraphIndex);
                        updateProgress(((currentParagraphIndex + 1) / paragraphs.length) * 100);
                    },
                    onend: () => {
                        console.log(`Kết thúc đọc đoạn ${currentParagraphIndex + 1}`);
                        unhighlightParagraph(currentParagraphIndex);
                        
                        
                        currentParagraphIndex++;
                        if (isPlaying && currentParagraphIndex < paragraphs.length) {
                            console.log('Proceeding to next paragraph');
                            readNextParagraph(); 
                        } else if (currentParagraphIndex >= paragraphs.length) {
                            console.log('Reached end of content');
                            finishReading();
                        }
                    }
                }
            );
        } catch (error) {
            console.error('Error in readNextParagraph:', error);
            stopReading();
        }
    } else {
        finishReading();
    }
}


function setupPlayButton() {
    const playButton = document.getElementById('playButton');
    if (playButton) {
        playButton.onclick = function(e) {
            e.preventDefault();
            console.log('Play button clicked');
            if (!isPlaying) {
                isPlaying = true;
                currentParagraphIndex = 0; 
                startReading();
            } else {
                isPlaying = false;
                stopReading();
            }
            updateUI(isPlaying ? 'reading' : 'paused');
        };
    }
}






let isPlaying = false;
let isMP3Playing = false;
let currentParagraphIndex = 0;
let paragraphs = [];
let ttsInitialized = false;



function stopReading() {
    console.log('Stopping reading');
    isPlaying = false;
    if (responsiveVoice) {
        responsiveVoice.cancel(); 
    }
    unhighlightAll();
    updateUI('paused');
}


function startReading() {
    console.log('Starting reading');
    isPlaying = true;
    currentParagraphIndex = 0;
    updateUI('reading');
    readNextParagraph();
}


function handlePlayButtonClick() {
    console.log('Play button clicked, current state:', isPlaying);
    if (!isPlaying) {
        startReading();
    } else {
        stopReading();
    }
}


function setupPlayButton() {
    const playButton = document.getElementById('playButton');
    if (playButton) {
        playButton.onclick = handlePlayButtonClick;
    }
}


function readNextParagraph() {
    console.log('Reading paragraph:', currentParagraphIndex + 1, 'of', paragraphs.length);
    console.log('isPlaying status:', isPlaying);

    if (!isPlaying) {
        console.log('Reading stopped');
        return;
    }

    if (currentParagraphIndex < paragraphs.length) {
        try {
            const voiceName = document.getElementById('voiceSelect').value;
            const rate = parseFloat(document.getElementById('rateSelect').value);

            console.log('Current text:', paragraphs[currentParagraphIndex].text);
            console.log('Voice:', voiceName, 'Rate:', rate);

            responsiveVoice.speak(
                paragraphs[currentParagraphIndex].text,
                voiceName,
                {
                    rate: rate,
                    onstart: () => {
                        console.log(`Bắt đầu đọc đoạn ${currentParagraphIndex + 1}/${paragraphs.length}`);
                        updateStatus(`Đang đọc đoạn ${currentParagraphIndex + 1}/${paragraphs.length}`);
                        highlightParagraph(currentParagraphIndex);
                        updateProgress(((currentParagraphIndex + 1) / paragraphs.length) * 100);
                    },
                    onend: () => {
                        console.log(`Kết thúc đọc đoạn ${currentParagraphIndex + 1}`);
                        unhighlightParagraph(currentParagraphIndex);
                        
                        if (isPlaying) {
                            currentParagraphIndex++;
                            if (currentParagraphIndex < paragraphs.length) {
                                console.log('Moving to next paragraph');
                                readNextParagraph();
                            } else {
                                console.log('Reached end of content');
                                finishReading();
                            }
                        }
                    }
                }
            );
        } catch (error) {
            console.error('Error in readNextParagraph:', error);
            stopReading();
        }
    } else {
        finishReading();
    }
}


function setupEventListeners() {
    console.log('Setting up event listeners');
    setupPlayButton();
    
    
    const voiceSelect = document.getElementById('voiceSelect');
    const rateSelect = document.getElementById('rateSelect');

    if (voiceSelect) {
        voiceSelect.onchange = handleVoiceChange;
    }

    if (rateSelect) {
        rateSelect.onchange = handleRateChange;
    }

    console.log('Event listeners setup complete');
}



















window.onload = function() {
   window.scrollTo(0, 0);
   updateParentHeight();
}


function updateParentHeight() {
   const height = document.documentElement.scrollHeight;
   window.parent.postMessage({ height: height }, '*');
}


new ResizeObserver(updateParentHeight).observe(document.body);


function shareOnFacebook() {
   const url = window.location.href;
   window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(url));
}

function shareOnTwitter() {
   const url = window.location.href;
   const title = document.title;
   window.open('https://twitter.com/intent/tweet?url=' + encodeURIComponent(url) + '&text=' + encodeURIComponent(title));
}
</script>
</body>
</html>