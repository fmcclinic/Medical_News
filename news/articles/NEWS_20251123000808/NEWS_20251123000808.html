<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nỗi đau sau zona – câu chuyện tôi muốn kể cùng bạn đọc - Tin Tức Y Khoa</title>
    
<script src="https://code.responsivevoice.org/responsivevoice.js?key=30xj8le1"></script>
        
  <script>
function waitForResponsiveVoice() {
    return new Promise((resolve, reject) => {
        let attempts = 0;
        const checkResponsiveVoice = setInterval(() => {
            attempts++;
            if (window.responsiveVoice && window.responsiveVoice.voiceSupport()) {
                clearInterval(checkResponsiveVoice);
                resolve();
            } else if (attempts > 50) { 
                clearInterval(checkResponsiveVoice);
                reject(new Error('ResponsiveVoice không load được'));
            }
        }, 100);
    });
}
    </script>


        <style>
         
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }

         
        .article-category {
            display: inline-block;
            background: #0070c0;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .article-title {
            font-size: 2em;
            margin-bottom: 15px;
            line-height: 1.2;
            color: #333;
            padding: 10px;
        }

        .article-meta {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .reading-time {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 3px 8px;
            background: #f0f0f0;
            border-radius: 15px;
        }

         
        .article-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

 
        
        .featured-image {
            display: block;          
            
             
            width: auto;             
            max-width: 100%;         
            height: 500px;           
            
            margin: 0 auto 20px auto;  
            
            object-fit: contain;     
            
            background-color: #f0f2f5;  
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

         
        @media (max-width: 768px) {
            .featured-image {
                width: 100%;         
                height: auto;        
                max-height: 500px;   
                
                object-fit: cover;   
            }
        }

        .article-content p {
            margin-bottom: 15px;
            line-height: 1.8;
            padding: 10px;
            border-radius: 4px;<img src="https\3a\2f\2fgithub.com\2f fmcclinic\2fMedical_News\2f blob\2fmain\2fnews\2fimage\2fzona_%E1%BB%8Bnury.jpg?raw=true" alt
            transition: all 0.3s ease;
        }

        .article-content p.current,
        .article-title.current {
            background: #f0f9ff;
            border-left: 3px solid #0070c0;
            padding-left: 15px;
        }

         
        .speech-controls {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .speech-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .speech-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }

        .controls-container {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .control-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: #0070c0;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .control-button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .control-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            min-width: 120px;
        }

        .progress-container {
            margin-top: 15px;
            background: #e9ecef;
            height: 4px;
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: #0070c0;
            width: 0;
            transition: width 0.3s;
        }

        .status {
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 4px;
            display: none;
        }

        .status.active {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status.reading {
            background: #e3f2fd;
            color: #0070c0;
            border-left: 4px solid #0070c0;
        }

        .status.paused {
            background: #fff3e0;
            color: #ef6c00;
            border-left: 4px solid #ef6c00;
        }

        .status.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #c62828;
        }

         
        .related-section {
            margin-top: 40px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .related-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #333;
        }

        .related-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .related-article {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .related-article:hover {
            transform: translateY(-3px);
        }

        .related-article img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }

        .related-article h3 {
            padding: 15px;
            margin: 0;
            flex: 1;
        }

        .related-article a {
            color: #333;
            text-decoration: none;
        }

        .related-article a:hover {
            color: #0070c0;
        }

        .related-article .date {
            display: block;
            padding: 0 15px 15px;
            color: #666;
            font-size: 0.9em;
        }

         
        .share-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .share-buttons {
            display: flex;
            gap: 10px;
        }

        .share-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: opacity 0.3s;
        }

        .share-button:hover {
            opacity: 0.9;
        }

        .share-button.facebook {
            background: #1877f2;
        }

        .share-button.twitter {
            background: #1da1f2;
        }

         
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .article-title {
                font-size: 1.8em;
            }

            .article-meta {
                flex-direction: column;
                align-items: flex-start;
            }

            .controls-container {
                flex-direction: column;
                align-items: stretch;
            }

            .related-grid {
                grid-template-columns: 1fr;
            }
        }

        
 
        .article-content ul, 
        .article-content ol {
            padding-left: 40px !important;  
            margin-bottom: 15px;
            list-style-type: disc !important;  
        }

         
        .article-content li {
            display: list-item !important;
            list-style-type: disc !important;  
        }

         
        .article-content ul ul,
        .article-content ol ol,
        .article-content ul ol,
        .article-content ol ul {
            list-style-type: circle !important;
        }
</style>
</head>
<body>
    <div class="container">
        <span class="article-category">Nội Khoa</span>
        
        <h1 class="article-title">Nỗi đau sau zona – câu chuyện tôi muốn kể cùng bạn đọc</h1>
        
        <div class="article-meta">
            <span>Đăng ngày 27/11/2025</span>
            <span class="reading-time">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                5 phút đọc
            </span>
        </div>

        <img src="https://github.com/fmcclinic/Medical_News/blob/main/news/image/zona_%E1%BB%8Bnury.jpg?raw=true" alt="Nỗi đau sau zona – câu chuyện tôi muốn kể cùng bạn đọc" class="featured-image">

        <div class="article-content">



<div class="speech-controls">
    <div class="speech-header">
        <span class="speech-title">Nghe bài viết</span>
    </div>
    
    <div class="controls-container">
        
        <button id="mp3Button" class="control-button" onclick="toggleMP3()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
            </svg>
            <span>Audio đã thu</span>
        </button>

        
        <button id="playButton" class="control-button">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
            <span>Đọc bài viết</span>
        </button>
        
        
        <div class="speed-control">
            <select id="voiceSelect">
                <option value="Vietnamese Female">Giọng Nữ</option>
                <option value="Vietnamese Male">Giọng Nam</option>
            </select>
            <select id="rateSelect">
                <option value="0.8">Chậm</option>
                <option value="1" selected>Bình thường</option>
                <option value="1.2">Nhanh</option>
            </select>
        </div>
    </div>

    
    <audio id="mp3Player" class="audio-player" controls style="width: 100%; margin-top: 10px; display: none;">
        <source id="mp3Source" type="audio/mpeg">
        Trình duyệt không hỗ trợ phát audio.
    </audio>

    <div class="progress-container">
        <div id="progress" class="progress-bar"></div>
    </div>

    <div id="status" class="status">
        <span id="statusText"></span>
    </div>
</div>


            
        <style>
           .article-content ul, .article-content ol { list-style-type: disc !important; margin-left: 20px !important; }
           .article-content li { display: list-item !important; list-style-type: disc !important; }
        </style>
      <p>Hôm nay, trong lúc tư vấn cho một chị về một vấn đề y khoa khác, cuộc trò chuyện bất ngờ kéo dài hơn dự kiến. Không phải vì bệnh của chị, mà vì một câu chuyện khác mà gia đình chị đang phải trải qua.</p><p>Khi nhắc đến mẹ mình, giọng chị chùng xuống</p><p>“Bác sĩ ơi… mẹ em bị zona mấy tháng trước. Vết thương đã lành hết rồi mà giờ bà vẫn đau… đau dữ lắm. Nhà em đưa bà đi khắp nơi, tốn rất nhiều tiền xét nghiệm, chụp MRI, CT… nhưng cơn đau vẫn không chịu buông tha.”</p><p>Nghe câu ấy, tôi biết ngay rằng mình sắp bước vào câu chuyện quen thuộc — <strong>câu chuyện của bệnh nhân bị đau dây thần kinh hậu zona</strong>. Những bệnh nhân không còn tổn thương ngoài da, nhưng nỗi đau âm ỉ bên trong lại trở thành thử thách lớn nhất.</p><p class="ql-align-center"><br></p><p><strong>Khi da đã lành, nhưng thần kinh thì chưa</strong></p><p>Tôi giải thích với chị bằng sự nhẹ nhàng nhất có thể, vì tôi hiểu sự tuyệt vọng trong lòng người nhà:</p><p>“Vết zona bên ngoài chỉ là phần nổi.</p><p>Vấn đề nằm ở sâu hơn — <strong>dây thần kinh</strong>.”</p><p>Virus zona (varicella-zoster) khi tái hoạt động gây tổn thương các sợi thần kinh cảm giác. Dù vùng da đã khô và bong vảy, <strong>những dây thần kinh bị phá hủy cần nhiều tháng để tái tạo</strong>.</p><p>Nhưng điều đáng tiếc là:</p><ol><li data-list="bullet" class="ql-indent-1"><span class="ql-ui" contenteditable="false"></span>Chúng <strong>tái tạo không hoàn hảo</strong>, méo mó, đứt quãng.</li><li data-list="bullet" class="ql-indent-1"><span class="ql-ui" contenteditable="false"></span>Tín hiệu đau được truyền đi <strong>một cách hỗn loạn</strong>, dù không còn tổn thương thực thể.</li><li data-list="bullet" class="ql-indent-1"><span class="ql-ui" contenteditable="false"></span>Bộ não “đọc nhầm” các tín hiệu đó thành cảm giác đau dữ dội.</li></ol><p>Tôi nói với chị:</p><p>“Đó là lý do vì sao mẹ chị chỉ cần gió thổi qua cũng đau.</p><p>Chỉ cần chạm nhẹ vào áo cũng buốt.</p><p>Trời lạnh càng đau hơn.</p><p>Và nỗi đau này… có thể kéo dài nhiều tháng.”</p><p>Chị thở dài, như thể vừa hiểu được điều mà bấy lâu nay không ai giải thích rõ ràng.</p><p class="ql-align-center"><br></p><p><strong>Nỗi khổ của người mẹ và sự bất lực của người con</strong></p><p>Chị kể rằng mẹ chị vốn là người mạnh mẽ, làm lụng cả đời. Nhưng giờ đây:</p><ol><li data-list="bullet" class="ql-indent-1"><span class="ql-ui" contenteditable="false"></span>ban đêm bà không ngủ nổi</li><li data-list="bullet" class="ql-indent-1"><span class="ql-ui" contenteditable="false"></span>ban ngày luôn ôm ngực vì đau</li><li data-list="bullet" class="ql-indent-1"><span class="ql-ui" contenteditable="false"></span>đi đứng khó khăn</li><li data-list="bullet" class="ql-indent-1"><span class="ql-ui" contenteditable="false"></span>lúc nào cũng sợ cơn đau ập đến</li></ol><p>“Nhìn mẹ như vậy… đau lòng lắm bác sĩ. Mà tụi em đã đưa mẹ đi hết bệnh viện này đến bệnh viện kia, từ chuyên khoa thần kinh đến đau mạn tính. Tốn nhiều tiền lắm… nhưng bà vẫn đau.”</p><p>Tôi nghe và thấy hình bóng của rất nhiều bệnh nhân khác trong câu chuyện của chị.</p><p><strong>Đau hậu zona không giết người, nhưng khiến họ suy sụp. Và làm cả gia đình kiệt quệ theo.</strong></p><p class="ql-align-center"><br></p><p><strong>Điều trị – khó nhưng không phải không có hy vọng</strong></p><p>Tôi trấn an chị:</p><p>“Có thể giảm đau. Không phải vô vọng. Chỉ là phải đúng hướng — vì đây là đau thần kinh, không còn là vấn đề da liễu.”</p><p>Các phương pháp điều trị bao gồm:</p><p><strong>1. Thuốc điều chỉnh dẫn truyền thần kinh</strong></p><p>Giảm tín hiệu đau từ dây thần kinh bị tổn thương:</p><ol><li data-list="bullet" class="ql-indent-1"><span class="ql-ui" contenteditable="false"></span>Pregabalin</li><li data-list="bullet" class="ql-indent-1"><span class="ql-ui" contenteditable="false"></span>Gabapentin</li></ol><p><strong>2. Thuốc giảm đau thần kinh – chống trầm cảm liều thấp</strong></p><p>Giúp giảm đau và cải thiện giấc ngủ:</p><ol><li data-list="bullet" class="ql-indent-1"><span class="ql-ui" contenteditable="false"></span>Amitriptyline</li><li data-list="bullet" class="ql-indent-1"><span class="ql-ui" contenteditable="false"></span>Duloxetine</li></ol><p><strong>3. Các biện pháp tại chỗ</strong></p><ol><li data-list="bullet" class="ql-indent-1"><span class="ql-ui" contenteditable="false"></span>Dán Lidocain 5%</li><li data-list="bullet" class="ql-indent-1"><span class="ql-ui" contenteditable="false"></span>Capsaicin patch</li></ol><p><strong>4. Các phương pháp hỗ trợ</strong></p><ol><li data-list="bullet" class="ql-indent-1"><span class="ql-ui" contenteditable="false"></span>Phong bế thần kinh</li><li data-list="bullet" class="ql-indent-1"><span class="ql-ui" contenteditable="false"></span>Vật lý trị liệu</li><li data-list="bullet" class="ql-indent-1"><span class="ql-ui" contenteditable="false"></span>Liệu pháp laser hoặc xung điện TENS</li></ol><p>Tôi giải thích thật lòng:</p><p>“Không có thuốc nào hết đau ngay. Điều trị kéo dài vài tuần đến vài tháng. Nhưng nhiều bệnh nhân của tôi đã cải thiện rõ rệt khi đi đúng hướng và kiên trì.”</p><p>Tôi thấy ánh mắt chị sáng lên một chút. Chỉ một chút hy vọng thôi cũng đã giúp người nhà bớt gánh nặng tinh thần.</p><p class="ql-align-center"><br></p><p><strong>Tại sao đã từng bị zona vẫn cần tiêm vaccine?</strong></p><p>Lúc ra về, chị quay lại hỏi tôi:</p><p>“Giờ mẹ em bị rồi… có cần tiêm phòng không bác sĩ?”</p><p>Tôi nói ngay:</p><p>“<strong>Càng nên tiêm.</strong></p><p>Vì khuẩn varicella-zoster không biến mất sau đợt zona. Nó vẫn nằm trong các hạch thần kinh — chỉ ngủ yên mà thôi.”</p><p>Ở người trên 50 tuổi, nó có thể tái hoạt:</p><ol><li data-list="bullet" class="ql-indent-1"><span class="ql-ui" contenteditable="false"></span>khi miễn dịch suy giảm</li><li data-list="bullet" class="ql-indent-1"><span class="ql-ui" contenteditable="false"></span>khi stress kéo dài</li><li data-list="bullet" class="ql-indent-1"><span class="ql-ui" contenteditable="false"></span>khi mắc bệnh khác</li><li data-list="bullet" class="ql-indent-1"><span class="ql-ui" contenteditable="false"></span>hoặc không vì lý do gì cả</li></ol><p><strong>Vaccine giúp hệ miễn dịch nhận diện virus tốt hơn</strong>, từ đó giảm nguy cơ tái phát và đặc biệt là giảm nguy cơ đau hậu zona — điều đang khiến mẹ chị khổ sở.</p><p class="ql-align-center"><br></p><p><strong>Lời nhắn cuối dành cho bạn đọc</strong></p><p>Tôi viết những dòng này vì: </p><p class="ql-indent-1">Mỗi bác sĩ đều có những bệnh nhân khiến mình day dứt nhất</p><p class="ql-indent-1">và với tôi, đó thường là những người chịu đựng nỗi đau hậu zona dai dẳng</p><p>Nếu bạn hoặc người thân đã trên 50 tuổi, hãy cân nhắc tiêm ngừa zona.</p><p>Đừng đợi đến khi mắc rồi mới nghĩ đến phòng ngừa.</p><p>Bởi <strong>zona không đáng sợ bằng nỗi đau kéo dài sau đó</strong> — thứ đã làm biết bao người già suy sụp, và làm bao gia đình mệt mỏi chạy chữa.</p><p>Và hy vọng rằng, người mẹ của chị hôm nay rồi sẽ sớm tìm được những ngày bớt đau, bớt mệt, và ngủ được một giấc trọn vẹn.</p>
            <div class="share-section">
                <div class="share-buttons">
                    <button onclick="shareOnFacebook()" class="share-button facebook">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
                        </svg>
                        Chia sẻ Facebook
                    </button>
                    <button onclick="shareOnTwitter()" class="share-button twitter">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
                        </svg>
                        Chia sẻ Twitter
                    </button>
                </div>
            </div>
        </div>

        <div class="related-section">
            <h2 class="related-title">Bài viết liên quan</h2>
            <div class="related-grid">
                
        <div class="related-article">
          <a href="../NEWS_20241220193600/NEWS_20241220193600.html"><img src="https://cdnintech.com/books/8700/1713442765-245554739/cover.jpg" alt="Sử dụng An toàn Thuốc Chống Đông Máu"></a>
          <h3><a href="../NEWS_20241220193600/NEWS_20241220193600.html">Sử dụng An toàn Thuốc Chống Đông Máu</a></h3>
          <span class="date">20/12/2024</span>
        </div>            </div>
        </div>
    </div>

<script>

let currentMP3File = null;
let audioPreviewUrl = null;
let isPlaying = false;
let isTTSPlaying = false;
let isMP3Playing = false;
let ttsInitialized = false;
let currentParagraphIndex = 0;
let paragraphs = [];


const TTS_CONFIG = {
    VOICE_OPTIONS: {
        'Vietnamese Female': {
            name: 'Vietnamese Female',
            lang: 'vi-VN',
            rate: 1,
            pitch: 1.1,
            volume: 1
        },
        'Vietnamese Male': {
            name: 'Vietnamese Male',
            lang: 'vi-VN',
            rate: 1,
            pitch: 0.9,
            volume: 1
        }
    },
    PAUSE_BETWEEN: 500 
};


document.addEventListener('DOMContentLoaded', function() {
    
    if (typeof responsiveVoice !== 'undefined') {
        responsiveVoice.OnVoiceReady = function() {
            console.log('ResponsiveVoice sẵn sàng');
            initTTS();
            setupMP3EventListeners();
        };
    }

    
    window.scrollTo(0, 0);
    updateParentHeight();
});


new ResizeObserver(updateParentHeight).observe(document.body);


function initTTS() {
    console.log('Đang khởi tạo TTS');
    try {
        if (!responsiveVoice.voiceSupport()) {
            throw new Error('Trình duyệt không hỗ trợ TTS');
        }

        setupElements();
        loadContentToRead();
        setupEventListeners();
        
        const playButton = document.getElementById('playButton');
        if (playButton) {
            playButton.disabled = false;
        }
        
        ttsInitialized = true;
        console.log('TTS đã khởi tạo thành công');
        updateStatus('Sẵn sàng đọc');

    } catch (error) {
        console.error('Lỗi khởi tạo TTS:', error);
        showError(error.message);
    }
}


function setupElements() {
    const elements = ['playButton', 'voiceSelect', 'rateSelect', 'status', 'progress'];
    elements.forEach(id => {
        if (!document.getElementById(id)) {
            throw new Error(`Thiếu element: ${id}`);
        }
    });
}


function loadContentToRead() {
    const title = document.querySelector('.article-title');
    const contentElements = document.querySelectorAll('.article-content p, .article-content div > p, .article-content ul > li, .article-content ol > li');
    
    console.log('Title element:', title);
    console.log('Content elements:', contentElements);

    paragraphs = [];

    
    if (title) {
        paragraphs.push({
            element: title,
            text: title.textContent.trim()
        });
    }

    
    contentElements.forEach(element => {
        const text = element.textContent.trim();
        if (text.length > 0) {
            paragraphs.push({
                element: element,
                text: text
            });
        }
    });

    console.log('Total paragraphs loaded:', paragraphs.length);
    console.log('Paragraphs content:', paragraphs.map(p => p.text));
}


function setupEventListeners() {
    console.log('Setting up event listeners');

    
    const playButton = document.getElementById('playButton');
    const voiceSelect = document.getElementById('voiceSelect');
    const rateSelect = document.getElementById('rateSelect');
    const mp3Button = document.getElementById('mp3Button');

    if (playButton) {
        playButton.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('TTS button clicked');
            toggleSpeech();
        });
    }

    if (voiceSelect) {
        voiceSelect.addEventListener('change', handleVoiceChange);
    }

    if (rateSelect) {
        rateSelect.addEventListener('change', handleRateChange);
    }

    if (mp3Button) {
        mp3Button.addEventListener('click', toggleMP3);
    }

    console.log('Event listeners setup complete');
}


function toggleMP3() {
    console.log('toggleMP3 called');

    const mp3Player = document.getElementById('mp3Player');
    const mp3Button = document.getElementById('mp3Button');

    console.log('MP3 Player:', mp3Player);
    console.log('MP3 Button:', mp3Button);
    console.log('Current MP3 state - paused:', mp3Player?.paused);

    if (!mp3Player || !mp3Button) {
        console.error('MP3 elements not found');
        return;
    }

    
    const pathParts = window.location.pathname.split('/');
    const newsId = pathParts[pathParts.length - 1].replace('.html', '');
    
    
    const mp3Path = `${newsId}.mp3`;

    console.log('MP3 Path:', mp3Path);

    
    const mp3Source = mp3Player.querySelector('source');
    if (!mp3Source?.src) {
        console.log('Setting MP3 source to:', mp3Path);
        mp3Source.src = mp3Path;
    }

    
    console.log('Current source:', mp3Source.src);

    
    mp3Player.style.display = 'block';

    if (mp3Player.paused) {
        console.log('Attempting to play MP3...');
        
        
        mp3Player.load();
        
        mp3Player.addEventListener('loadeddata', function onLoad() {
            console.log('MP3 loaded, attempting to play');
            mp3Player.removeEventListener('loadeddata', onLoad);
            
            
            mp3Player.play()
                .then(() => {
                    console.log('MP3 playing successfully');
                    isMP3Playing = true;
                    mp3Button.innerHTML = `
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <rect x="6" y="4" width="4" height="16"></rect>
                            <rect x="14" y="4" width="4" height="16"></rect>
                        </svg>
                        <span>Tạm dừng</span>`;
                })
                .catch(error => {
                    console.error('Error playing MP3:', error);
                    isMP3Playing = false;
                });
        });
    } else {
        console.log('Pausing MP3...');
        mp3Player.pause();
        isMP3Playing = false;
        mp3Button.innerHTML = `
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
            </svg>
            <span>Audio đã thu</span>`;
    }
}




function checkMP3Source() {
   const mp3Player = document.getElementById('mp3Player');
   const source = document.getElementById('mp3Source');
   const mp3Button = document.getElementById('mp3Button');
   
   console.log('Checking MP3 source elements:');
   console.log('Audio element:', mp3Player);
   console.log('Source element:', source);
   console.log('Button element:', mp3Button);
   
   if (mp3Player && source) {
       console.log('Current source:', source.src);
       console.log('Audio ready state:', mp3Player.readyState);
       console.log('Audio paused state:', mp3Player.paused);
       console.log('Audio current time:', mp3Player.currentTime);
       console.log('Audio duration:', mp3Player.duration);

       
       const isValidSource = source.src && source.src.length > 0;
       console.log('Is valid source:', isValidSource);

       
       if (isValidSource) {
           const testAudio = new Audio();
           testAudio.src = source.src;
           
           testAudio.addEventListener('loadedmetadata', () => {
               console.log('MP3 file is accessible');
               mp3Button.disabled = false;
           });

           testAudio.addEventListener('error', () => {
               console.error('Error loading MP3 file');
               mp3Button.disabled = true;
               showError('Không thể tải file MP3');
           });
       } else {
           console.log('No MP3 source set');
           mp3Button.disabled = true;
       }

       
       const events = mp3Player.eventNames?.() || [];
       console.log('Bound events:', events);

       return {
           hasSource: isValidSource,
           readyState: mp3Player.readyState,
           isPaused: mp3Player.paused,
           currentTime: mp3Player.currentTime,
           duration: mp3Player.duration
       };
   } else {
       console.error('Required MP3 elements not found');
       return null;
   }
}


function setupMP3EventListeners() {
    const mp3Player = document.getElementById('mp3Player');
    const mp3Button = document.getElementById('mp3Button');

    if (mp3Player && mp3Button) {
        mp3Player.addEventListener('ended', function() {
            isMP3Playing = false;
            mp3Button.innerHTML = `
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                </svg>
                <span>Audio đã thu</span>`;
        });
    }
}


function toggleSpeech() {
    console.log('toggleSpeech called, ttsInitialized:', ttsInitialized);
    console.log('isPlaying:', isPlaying);

    
    if (isMP3Playing) {
        const mp3Player = document.getElementById('mp3Player');
        const mp3Button = document.getElementById('mp3Button');
        
        mp3Player.pause();
        isMP3Playing = false;
        if (mp3Button) {
            mp3Button.innerHTML = `
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                </svg>
                <span>Audio đã thu</span>`;
        }
    }

    if (!ttsInitialized) {
        showError('TTS chưa sẵn sàng');
        return;
    }

    if (!isPlaying) {
        startReading();
        isTTSPlaying = true;
    } else {
        stopReading();
        isTTSPlaying = false;
    }
}

function startReading() {
    console.log('Starting reading');
    isPlaying = true;
    currentParagraphIndex = 0;
    updateUI('reading');
    readNextParagraph();
}


function readNextParagraph() {
    console.log('Reading paragraph:', currentParagraphIndex + 1, 'of', paragraphs.length);
    console.log('isPlaying status:', isPlaying);

    if (currentParagraphIndex < paragraphs.length) {
        try {
            const voiceName = document.getElementById('voiceSelect').value;
            const rate = parseFloat(document.getElementById('rateSelect').value);
            const voiceConfig = TTS_CONFIG.VOICE_OPTIONS[voiceName];

            updateProgress(((currentParagraphIndex + 1) / paragraphs.length) * 100);
            highlightParagraph(currentParagraphIndex);

            console.log('Current text:', paragraphs[currentParagraphIndex].text);

            responsiveVoice.speak(
                paragraphs[currentParagraphIndex].text,
                voiceName,
                {
                    pitch: voiceConfig.pitch,
                    rate: rate,
                    volume: voiceConfig.volume,
                    lang: voiceConfig.lang,
                    onstart: function() {
                        console.log(`Bắt đầu đọc đoạn ${currentParagraphIndex + 1}/${paragraphs.length}`);
                        updateStatus(`Đang đọc đoạn ${currentParagraphIndex + 1}/${paragraphs.length}`);
                    },
                    onend: function() {
                        console.log(`Kết thúc đọc đoạn ${currentParagraphIndex + 1}`);
                        unhighlightParagraph(currentParagraphIndex);
                        currentParagraphIndex++;

                        
                        if (isPlaying && currentParagraphIndex < paragraphs.length) {
                            console.log('Moving to next paragraph after delay');
                            setTimeout(readNextParagraph, TTS_CONFIG.PAUSE_BETWEEN);
                        } else if (currentParagraphIndex >= paragraphs.length) {
                            console.log('Reached end of content');
                            finishReading();
                        }
                    }
                }
            );
        } catch (error) {
            console.error('Error reading paragraph:', error);
            showError(error.message);
            stopReading();
        }
    } else {
        console.log('No more paragraphs to read');
        finishReading();
    }
}


function stopReading() {
    console.log('Stopping reading');
    responsiveVoice.cancel();
    isPlaying = false;
    isTTSPlaying = false;
    unhighlightAll();
    updateUI('paused');
}


function finishReading() {
    console.log('Finishing reading');
    isPlaying = false;
    isTTSPlaying = false;
    updateProgress(100);
    updateUI('finished');
    unhighlightAll();
}


function highlightParagraph(index) {
    if (paragraphs[index]) {
        paragraphs[index].element.classList.add('current');
        scrollToParagraph(paragraphs[index].element);
    }
}


function unhighlightParagraph(index) {
    if (paragraphs[index]) {
        paragraphs[index].element.classList.remove('current');
    }
}


function unhighlightAll() {
    paragraphs.forEach(p => p.element.classList.remove('current'));
}

function scrollToParagraph(element) {
    element.scrollIntoView({
        behavior: 'smooth',
        block: 'center'
    });
}


function updateUI(state) {
    const button = document.getElementById('playButton');
    if (button) {
        button.innerHTML = isPlaying ? 
            `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <rect x="6" y="4" width="4" height="16"></rect>
                <rect x="14" y="4" width="4" height="16"></rect>
            </svg>
            <span>Tạm dừng</span>` :
            `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
            <span>Đọc bài viết</span>`;
    }
    updateStatus(state);
}

// Update status
function updateStatus(state) {
    const status = document.getElementById('status');
    const statusText = document.getElementById('statusText');
    if (status && statusText) {
        status.className = 'status active ' + state;
        statusText.textContent = typeof state === 'string' ? state : 
            state === 'reading' ? 'Đang đọc...' :
            state === 'paused' ? 'Đã tạm dừng' :
            state === 'finished' ? 'Đã đọc xong' : '';
    }
}


function updateProgress(percent) {
    const progress = document.getElementById('progress');
    if (progress) {
        progress.style.width = percent + '%';
    }
}


function handleVoiceChange() {
    if (isPlaying) {
        restartReading();
    }
}


function handleRateChange() {
    if (isPlaying) {
        restartReading();
    }
}


function restartReading() {
    stopReading();
    startReading();
}


function showError(message) {
    console.error(message);
    const statusText = document.getElementById('statusText');
    const status = document.getElementById('status');
    if (statusText && status) {
        statusText.textContent = message;
        status.className = 'status active error';
    }
}


function updateParentHeight() {
    const height = document.documentElement.scrollHeight;
    window.parent.postMessage({ height: height }, '*');
}


function shareOnFacebook() {
    const url = window.location.href;
    window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(url));
}

function shareOnTwitter() {
    const url = window.location.href;
    const title = document.title;
    window.open('https://twitter.com/intent/tweet?url=' + encodeURIComponent(url) + '&text=' + encodeURIComponent(title));
}
</script>
</body>
</html>