<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dinh dưỡng trong điều trị ung thư: Hướng dẫn toàn diện cho bệnh nhân và người chăm sóc - Tin Tức Y Khoa</title>
    
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=YOUR_KEY"></script>
    <style>
         
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }

         
        .article-category {
            display: inline-block;
            background: #0070c0;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .article-title {
            font-size: 2em;
            margin-bottom: 15px;
            line-height: 1.2;
            color: #333;
            padding: 10px;
        }

        .article-meta {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .reading-time {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 3px 8px;
            background: #f0f0f0;
            border-radius: 15px;
        }

         
        .article-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .featured-image {
            width: 100%;
            height: auto;
            max-height: 500px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .article-content p {
            margin-bottom: 15px;
            line-height: 1.8;
            padding: 10px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .article-content p.current,
        .article-title.current {
            background: #f0f9ff;
            border-left: 3px solid #0070c0;
            padding-left: 15px;
        }

         
        .speech-controls {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .speech-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .speech-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }

        .controls-container {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .control-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: #0070c0;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .control-button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .control-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            min-width: 120px;
        }

        .progress-container {
            margin-top: 15px;
            background: #e9ecef;
            height: 4px;
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: #0070c0;
            width: 0;
            transition: width 0.3s;
        }

        .status {
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 4px;
            display: none;
        }

        .status.active {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status.reading {
            background: #e3f2fd;
            color: #0070c0;
            border-left: 4px solid #0070c0;
        }

        .status.paused {
            background: #fff3e0;
            color: #ef6c00;
            border-left: 4px solid #ef6c00;
        }

        .status.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #c62828;
        }

         
        .related-section {
            margin-top: 40px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .related-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #333;
        }

        .related-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .related-article {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .related-article:hover {
            transform: translateY(-3px);
        }

        .related-article img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }

        .related-article h3 {
            padding: 15px;
            margin: 0;
            flex: 1;
        }

        .related-article a {
            color: #333;
            text-decoration: none;
        }

        .related-article a:hover {
            color: #0070c0;
        }

        .related-article .date {
            display: block;
            padding: 0 15px 15px;
            color: #666;
            font-size: 0.9em;
        }

         
        .share-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .share-buttons {
            display: flex;
            gap: 10px;
        }

        .share-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: opacity 0.3s;
        }

        .share-button:hover {
            opacity: 0.9;
        }

        .share-button.facebook {
            background: #1877f2;
        }

        .share-button.twitter {
            background: #1da1f2;
        }

         
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .article-title {
                font-size: 1.8em;
            }

            .article-meta {
                flex-direction: column;
                align-items: flex-start;
            }

            .controls-container {
                flex-direction: column;
                align-items: stretch;
            }

            .related-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <span class="article-category">Sản Phụ Khoa</span>
        
        <h1 class="article-title">Dinh dưỡng trong điều trị ung thư: Hướng dẫn toàn diện cho bệnh nhân và người chăm sóc</h1>
        
        <div class="article-meta">
            <span>Đăng ngày 17/12/2024</span>
            <span class="reading-time">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                4 phút đọc
            </span>
        </div>

        <img src="https://marylandoncology.com/wp-content/uploads/2023/12/MOH-Feature-1.jpg" alt="Dinh dưỡng trong điều trị ung thư: Hướng dẫn toàn diện cho bệnh nhân và người chăm sóc" class="featured-image">

        <div class="article-content">
<div class="speech-controls">
    <div class="speech-header">
        <span class="speech-title">Nghe bài viết</span>
    </div>
    
    <div class="controls-container">
        
        <button type="button" id="mp3Button" class="control-button" onclick="toggleMP3()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                <line x1="12" y1="19" x2="12" y2="23"/>
                <line x1="8" y1="23" x2="16" y2="23"/>
            </svg>
            <span>Audio đã thu</span>
        </button>

        
        <button type="button" id="playButton" class="control-button" onclick="toggleSpeech()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
            <span>Đọc bài viết</span>
        </button>
        
        
        <div id="ttsControls" class="speed-control">
            <select id="voiceSelect" onchange="handleVoiceChange()">
                <option value="Vietnamese Female">Giọng Nữ</option>
                <option value="Vietnamese Male">Giọng Nam</option>
            </select>
            <select id="rateSelect" onchange="handleRateChange()">
                <option value="0.8">Chậm</option>
                <option value="1" selected>Bình thường</option>
                <option value="1.2">Nhanh</option>
            </select>
        </div>
    </div>

    
    <audio id="mp3Player" controls style="width: 100%; margin-top: 10px; display: none;">
        <source id="mp3Source" type="audio/mpeg">
        Trình duyệt không hỗ trợ phát audio.
    </audio>

    <div class="progress-container">
        <div id="progress" class="progress-bar"></div>
    </div>

    <div id="status" class="status">
        <span id="statusText"></span>
    </div>
</div>

            <h2>Giới thiệu về dinh dưỡng trong điều trị ung thư</h2><p>Dinh dưỡng đóng vai trò then chốt trong hành trình điều trị ung thư. Việc duy trì chế độ dinh dưỡng phù hợp không chỉ giúp cơ thể chống chọi với bệnh tật mà còn hỗ trợ quá trình phục hồi và nâng cao hiệu quả điều trị.</p><h3>Định nghĩa về dinh dưỡng trong điều trị ung thư</h3><p>Dinh dưỡng bao gồm tất cả những gì bạn ăn và uống, cùng cách cơ thể sử dụng chúng. Một chế độ dinh dưỡng lành mạnh cần có đầy đủ:</p><ul><li>Protein</li><li>Carbohydrate</li><li>Chất béo</li><li>Vitamin</li><li>Khoáng chất</li><li>Nước</li></ul><h2>Tác động của các phương pháp điều trị ung thư đến dinh dưỡng</h2><h3>1. Hóa trị</h3><h2>Tác động trực tiếp:</h2><ul><li>Tổn thương các tế bào phát triển nhanh trong miệng và đường tiêu hóa</li><li>Gây suy giảm hệ miễn dịch</li><li>Ảnh hưởng đến khả năng hấp thu dinh dưỡng</li></ul><h2>Tác dụng phụ thường gặp:</h2><ul><li>Buồn nôn và nôn (thường xuất hiện sau 2-6 giờ điều trị)</li><li>Viêm niêm mạc miệng (có thể xuất hiện sau 5-7 ngày)</li><li>Tiêu chảy hoặc táo bón</li><li>Thay đổi vị giác (thức ăn có thể có vị kim loại)</li><li>Mệt mỏi ảnh hưởng đến việc chuẩn bị và ăn uống</li></ul><h3>2. Xạ trị</h3><h2>Tác động theo vùng điều trị:</h2><ul><li>Vùng đầu và cổ:</li><li class="ql-indent-1">Khô miệng kéo dài</li><li class="ql-indent-1">Khó nuốt</li><li class="ql-indent-1">Mất vị giác</li><li class="ql-indent-1">Sâu răng</li><li>Vùng ngực:</li><li class="ql-indent-1">Khó nuốt</li><li class="ql-indent-1">Trào ngược dạ dày</li><li class="ql-indent-1">Viêm thực quản</li><li>Vùng bụng và tiểu khung:</li><li class="ql-indent-1">Buồn nôn</li><li class="ql-indent-1">Tiêu chảy</li><li class="ql-indent-1">Viêm ruột</li></ul><h3>3. Phẫu thuật</h3><h2>Tác động tùy theo vị trí phẫu thuật:</h2><ul><li>Phẫu thuật đầu cổ:</li><li class="ql-indent-1">Khó nhai</li><li class="ql-indent-1">Khó nuốt</li><li class="ql-indent-1">Thay đổi vị giác</li><li>Phẫu thuật dạ dày:</li><li class="ql-indent-1">Đầy bụng sớm</li><li class="ql-indent-1">Khó tiêu</li><li class="ql-indent-1">Hội chứng Dumping</li><li>Phẫu thuật ruột:</li><li class="ql-indent-1">Kém hấp thu</li><li class="ql-indent-1">Tiêu chảy</li><li class="ql-indent-1">Táo bón</li></ul><h2>Hướng dẫn chi tiết quản lý dinh dưỡng</h2><h3>1. Khi giảm cảm giác ngon miệng</h3><h2>Các biện pháp cụ thể:</h2><ul><li>Thời điểm ăn:</li><li class="ql-indent-1">Ăn khi cảm thấy đói nhất trong ngày</li><li class="ql-indent-1">Ăn sáng nhiều hơn vì thường cảm giác ngon miệng tốt nhất vào buổi sáng</li><li>Cách thức ăn:</li><li class="ql-indent-1">Chia thành 5-6 bữa nhỏ thay vì 3 bữa lớn</li><li class="ql-indent-1">Mang theo đồ ăn nhẹ để ăn bất cứ khi nào cảm thấy đói</li><li class="ql-indent-1">Tránh uống nhiều nước trong bữa ăn</li></ul><h2>Thực đơn gợi ý:</h2><ul><li>Bữa sáng:</li><li class="ql-indent-1">Bánh mì nướng với bơ đậu phộng</li><li class="ql-indent-1">Sữa chua với hạt và mật ong</li><li class="ql-indent-1">Sinh tố protein với trái cây</li><li>Bữa nhẹ:</li><li class="ql-indent-1">Các loại hạt</li><li class="ql-indent-1">Phô mai</li><li class="ql-indent-1">Trứng luộc</li><li class="ql-indent-1">Sữa chua</li></ul><h3>2. Khi bị buồn nôn và nôn</h3><h2>Biện pháp phòng ngừa:</h2><ul><li>Tránh mùi nấu nướng</li><li>Giữ không khí trong lành</li><li>Ăn từ từ và nhai kỹ</li><li>Không nằm ngay sau khi ăn</li></ul><h2>Thực phẩm phù hợp:</h2><ul><li>Bánh mì nướng</li><li>Bánh quy mặn</li><li>Cháo loãng</li><li>Súp trong</li><li>Nước gừng</li></ul><h3>3. Khi bị khó nuốt</h3><h2>Điều chỉnh độ đặc của thức ăn:</h2><ul><li>Thức ăn dạng lỏng:</li><li class="ql-indent-1">Sinh tố</li><li class="ql-indent-1">Súp xay nhuyễn</li><li class="ql-indent-1">Sữa làm đặc</li><li>Thức ăn dạng nhão:</li><li class="ql-indent-1">Cháo nhuyễn</li><li class="ql-indent-1">Khoai tây nghiền</li><li class="ql-indent-1">Trứng bác</li></ul><h2>Kỹ thuật ăn an toàn:</h2><ul><li>Ngồi thẳng khi ăn</li><li>Cúi đầu nhẹ về phía trước</li><li>Ăn chậm và từng miếng nhỏ</li><li>Không nói chuyện khi ăn</li></ul><h2>Hỗ trợ dinh dưỡng đặc biệt</h2><h3>1. Dinh dưỡng qua ống thông</h3><h2>Chỉ định:</h2><ul><li>Không thể ăn đường miệng</li><li>Khó nuốt nặng</li><li>Suy dinh dưỡng nghiêm trọng</li></ul><h2>Các loại ống thông:</h2><ul><li>Ống thông mũi-dạ dày (ngắn hạn)</li><li>Ống thông dạ dày (PEG - dài hạn)</li><li>Ống thông hỗng tràng</li></ul><h3>2. Dinh dưỡng tĩnh mạch</h3><h2>Chỉ định:</h2><ul><li>Không thể sử dụng đường tiêu hóa</li><li>Hấp thu kém nghiêm trọng</li><li>Tắc ruột</li></ul><h2>Theo dõi và quản lý:</h2><ul><li>Kiểm tra đường huyết</li><li>Cân bằng điện giải</li><li>Phòng ngừa nhiễm trùng</li></ul><h2>Kế hoạch dinh dưỡng theo giai đoạn</h2><h3>1. Trước điều trị:</h3><ul><li>Đánh giá tình trạng dinh dưỡng</li><li>Tư vấn với chuyên gia dinh dưỡng</li><li>Chuẩn bị thực phẩm và dụng cụ cần thiết</li></ul><h3>2. Trong điều trị:</h3><ul><li>Theo dõi cân nặng</li><li>Điều chỉnh chế độ ăn theo tác dụng phụ</li><li>Duy trì liên lạc với đội ngũ y tế</li></ul><h3>3. Sau điều trị:</h3><ul><li>Phục hồi thói quen ăn uống</li><li>Điều chỉnh cân nặng về mức khỏe mạnh</li><li>Xây dựng chế độ ăn lành mạnh lâu dài</li></ul><h2>An toàn thực phẩm</h2><h3>Nguyên tắc cơ bản:</h3><ul><li>Rửa tay thường xuyên</li><li>Rửa rau củ quả kỹ</li><li>Nấu chín kỹ thực phẩm</li><li>Bảo quản thực phẩm đúng cách</li></ul><h3>Thực phẩm cần tránh:</h3><ul><li>Thực phẩm sống hoặc tái</li><li>Trứng sống</li><li>Pho mát không thanh trùng</li><li>Nước ép không thanh trùng</li></ul><h2>Kết luận</h2><p>Dinh dưỡng đóng vai trò quan trọng trong điều trị ung thư, ảnh hưởng trực tiếp đến kết quả điều trị và chất lượng cuộc sống của người bệnh. Việc hiểu rõ và áp dụng các nguyên tắc dinh dưỡng phù hợp, kết hợp với sự theo dõi và điều chỉnh linh hoạt, sẽ giúp người bệnh vượt qua giai đoạn điều trị một cách tốt nhất.</p><p>Luôn nhớ rằng mỗi người bệnh có nhu cầu dinh dưỡng khác nhau, vì vậy cần tham khảo ý kiến của đội ngũ y tế và chuyên gia dinh dưỡng để có được phương pháp phù hợp nhất cho từng trường hợp cụ thể.</p>
            <div class="share-section">
                <div class="share-buttons">
                    <button onclick="shareOnFacebook()" class="share-button facebook">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
                        </svg>
                        Chia sẻ Facebook
                    </button>
                    <button onclick="shareOnTwitter()" class="share-button twitter">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
                        </svg>
                        Chia sẻ Twitter
                    </button>
                </div>
            </div>
        </div>

        <div class="related-section">
            <h2 class="related-title">Bài viết liên quan</h2>
            <div class="related-grid">
                
      <div class="related-article">
        <img src="https://www.breastsurgeryireland.com/3d-images/inflammatory-breast-cancer.jpg" alt="Ung thư vú viêm">
        <h3>
          <a href="../../articles/NEWS_20241217182729/NEWS_20241217182729.html">Ung thư vú viêm</a>
        </h3>
        <span class="date">17/12/2024</span>
      </div>
    
      <div class="related-article">
        <img src="https://magazine.medlineplus.gov/images/uploads/main_images/caervicalcancer-hpv.jpg" alt="HPV và ung thư cổ tử cung: Những điều bạn cần biết">
        <h3>
          <a href="../../articles/NEWS_20241217144754/NEWS_20241217144754.html">HPV và ung thư cổ tử cung: Những điều bạn cần biết</a>
        </h3>
        <span class="date">17/12/2024</span>
      </div>
    
      <div class="related-article">
        <img src="https://blog.lexmed.com/images/librariesprovider80/blog-post-featured-images/hpv-virus.tmb-xlarge.jpg?sfvrsn=b544950b_1" alt="HPV Can Lead to Head and Neck Cancers">
        <h3>
          <a href="../../articles/NEWS_20241217003534/NEWS_20241217003534.html">HPV Can Lead to Head and Neck Cancers</a>
        </h3>
        <span class="date">17/12/2024</span>
      </div>
                </div>
        </div>
    </div>

<script>

const TTS_CONFIG = {
   VOICE_OPTIONS: {
       'Vietnamese Female': {
           name: 'Vietnamese Female',
           lang: 'vi-VN',
           rate: 1,
           pitch: 1.1,
           volume: 1
       },
       'Vietnamese Male': {
           name: 'Vietnamese Male',
           lang: 'vi-VN',
           rate: 1,
           pitch: 0.9,
           volume: 1
       }
   },
   PAUSE_BETWEEN: 500 
};


let isPlaying = false;
let isMP3Playing = false;
let currentParagraphIndex = 0;
let paragraphs = [];
let ttsInitialized = false;


window.addEventListener('DOMContentLoaded', function() {
    if (typeof responsiveVoice !== 'undefined') {
        responsiveVoice.init().then(function() {
            console.log('ResponsiveVoice đã sẵn sàng');
            return new Promise(function(resolve) {
                responsiveVoice.OnVoiceReady = function() {
                    resolve();
                };
            });
        }).then(function() {
            initTTS();
            checkForMP3();
        }).catch(function(error) {
            console.error('Lỗi khởi tạo ResponsiveVoice:', error);
        });
    } else {
        console.error('ResponsiveVoice chưa được load');
    }
});


function checkForMP3() {
   const pathParts = window.location.pathname.split('/');
   const newsId = pathParts[pathParts.length - 1].replace('.html', '');
   const mp3Path = `${newsId}.mp3`;
   
   const audio = document.createElement('audio');
   audio.addEventListener('canplaythrough', function() {
       setupMP3Player(mp3Path);
   });

   audio.addEventListener('error', function() {
       console.log('Không tìm thấy file MP3');
       document.getElementById('mp3Button').disabled = true;
   });

   audio.src = mp3Path;
   audio.load();
}


function setupMP3Player(mp3Path) {
   const mp3Player = document.getElementById('mp3Player');
   document.getElementById('mp3Source').src = mp3Path;
   mp3Player.load();

   
   const mp3Button = document.getElementById('mp3Button');
   mp3Button.disabled = false;
   mp3Button.onclick = toggleMP3;

   
   mp3Player.addEventListener('ended', function() {
       isMP3Playing = false;
       resetMP3Button();
   });
}


function toggleMP3() {
   if (isPlaying) {
       stopReading(); 
   }

   const mp3Player = document.getElementById('mp3Player');
   const mp3Button = document.getElementById('mp3Button');

   if (!isMP3Playing) {
       mp3Player.style.display = 'block';
       mp3Player.play();
       isMP3Playing = true;
       mp3Button.innerHTML = `
           <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
               <rect x="6" y="4" width="4" height="16"></rect>
               <rect x="14" y="4" width="4" height="16"></rect>
           </svg>
           <span>Tạm dừng</span>`;
   } else {
       mp3Player.pause();
       isMP3Playing = false;
       resetMP3Button();
   }
}


function resetMP3Button() {
   const mp3Button = document.getElementById('mp3Button');
   mp3Button.innerHTML = `
       <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
           <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
           <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
           <line x1="12" y1="19" x2="12" y2="23"/>
           <line x1="8" y1="23" x2="16" y2="23"/>
       </svg>
       <span>Audio đã thu</span>`;
}


function initTTS() {
   try {
       if (!responsiveVoice.voiceSupport()) {
           throw new Error('Trình duyệt không hỗ trợ TTS');
       }

       setupElements();
       loadContentToRead();
       setupEventListeners();
       
       document.getElementById('playButton').disabled = false;
       ttsInitialized = true;
       
       console.log('TTS khởi tạo thành công');
       updateStatus('Sẵn sàng đọc');
   } catch (error) {
       console.error('Lỗi khởi tạo TTS:', error);
       showError(error.message);
   }
}


function setupElements() {
   const elements = ['playButton', 'voiceSelect', 'rateSelect', 'status', 'progress'];
   elements.forEach(id => {
       if (!document.getElementById(id)) {
           throw new Error(`Thiếu element: ${id}`);
       }
   });
}


function loadContentToRead() {
   const title = document.querySelector('.article-title');
   const paragraphElements = document.querySelectorAll('.article-content p');

   paragraphs = [];

   
   if (title) {
       paragraphs.push({
           element: title,
           text: title.textContent.trim()
       });
   }

   
   paragraphElements.forEach(p => {
       const text = p.textContent.trim();
       if (text.length > 0) {
           paragraphs.push({
               element: p,
               text: text
           });
       }
   });

   console.log(`Đã tải ${paragraphs.length} đoạn văn bản`);
}


function setupEventListeners() {
   document.getElementById('playButton').addEventListener('click', toggleSpeech);
   document.getElementById('voiceSelect').addEventListener('change', handleVoiceChange);
   document.getElementById('rateSelect').addEventListener('change', handleRateChange);
}


function toggleSpeech() {
   if (!ttsInitialized) {
       showError('TTS chưa sẵn sàng');
       return;
   }

   if (isMP3Playing) {
       const mp3Player = document.getElementById('mp3Player');
       mp3Player.pause();
       isMP3Playing = false;
       resetMP3Button();
   }

   if (!isPlaying) {
       startReading();
   } else {
       stopReading();
   }
}


function startReading() {
   isPlaying = true;
   currentParagraphIndex = 0;
   updateUI('reading');
   readNextParagraph();
}


function readNextParagraph() {
   if (currentParagraphIndex < paragraphs.length) {
       try {
           const voiceName = document.getElementById('voiceSelect').value;
           const rate = parseFloat(document.getElementById('rateSelect').value);
           const voiceConfig = TTS_CONFIG.VOICE_OPTIONS[voiceName];

           updateProgress(((currentParagraphIndex + 1) / paragraphs.length) * 100);
           highlightParagraph(currentParagraphIndex);

           responsiveVoice.speak(
               paragraphs[currentParagraphIndex].text,
               voiceName,
               {
                   pitch: voiceConfig.pitch,
                   rate: rate,
                   volume: voiceConfig.volume,
                   lang: voiceConfig.lang,
                   onstart: function() {
                       updateStatus(`Đang đọc đoạn ${currentParagraphIndex + 1}/${paragraphs.length}`);
                   },
                   onend: function() {
                       unhighlightParagraph(currentParagraphIndex);
                       currentParagraphIndex++;
                       if (isPlaying) {
                           setTimeout(readNextParagraph, TTS_CONFIG.PAUSE_BETWEEN);
                       }
                   }
               }
           );
       } catch (error) {
           console.error('Error:', error);
           showError(error.message);
           stopReading();
       }
   } else {
       finishReading();
   }
}

// Stop reading
function stopReading() {
   responsiveVoice.cancel();
   isPlaying = false;
   unhighlightAll();
   updateUI('paused');
}


function finishReading() {
   isPlaying = false;
   updateProgress(100);
   updateUI('finished');
   unhighlightAll();
}


function highlightParagraph(index) {
   if (paragraphs[index]) {
       paragraphs[index].element.classList.add('current');
       scrollToParagraph(paragraphs[index].element);
   }
}


function unhighlightParagraph(index) {
   if (paragraphs[index]) {
       paragraphs[index].element.classList.remove('current');
   }
}


function unhighlightAll() {
   paragraphs.forEach(p => p.element.classList.remove('current'));
}


function scrollToParagraph(element) {
   element.scrollIntoView({
       behavior: 'smooth',
       block: 'center'
   });
}


function updateUI(state) {
   const button = document.getElementById('playButton');
   if (button) {
       button.innerHTML = isPlaying ? 
           `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
               <rect x="6" y="4" width="4" height="16"></rect>
               <rect x="14" y="4" width="4" height="16"></rect>
           </svg>
           <span>Tạm dừng</span>` :
           `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
               <polygon points="5 3 19 12 5 21 5 3"></polygon>
           </svg>
           <span>Đọc bài viết</span>`;
   }
   updateStatus(state);
}

// Update status message
function updateStatus(state) {
   const status = document.getElementById('status');
   const statusText = document.getElementById('statusText');
   if (status && statusText) {
       status.className = 'status active ' + state;
       statusText.textContent = typeof state === 'string' ? state : 
           state === 'reading' ? 'Đang đọc...' :
           state === 'paused' ? 'Đã tạm dừng' :
           state === 'finished' ? 'Đã đọc xong' : '';
   }
}


function updateProgress(percent) {
   const progress = document.getElementById('progress');
   if (progress) {
       progress.style.width = percent + '%';
   }
}


function handleVoiceChange() {
   if (isPlaying) {
       restartReading();
   }
}


function handleRateChange() {
   if (isPlaying) {
       restartReading();
   }
}


function restartReading() {
   stopReading();
   startReading();
}


function showError(message) {
   console.error(message);
   updateStatus('error');
   const statusText = document.getElementById('statusText');
   if (statusText) {
       statusText.textContent = message;
   }
}













function toggleMP3() {
    console.log('toggleMP3 called');
    if (isPlaying) {
        stopReading(); 
    }

    const mp3Player = document.getElementById('mp3Player');
    const mp3Button = document.getElementById('mp3Button');

    
    console.log('mp3Player:', mp3Player);
    console.log('mp3Button:', mp3Button);

    if (!isMP3Playing) {
        mp3Player.style.display = 'block';
        mp3Player.play();
        isMP3Playing = true;
        mp3Button.innerHTML = `...`; 
    } else {
        mp3Player.pause();
        isMP3Playing = false;
        resetMP3Button();
    }
}


function setupMP3Player(mp3Path) {
    console.log('Setting up MP3 player with path:', mp3Path);
    
    const mp3Player = document.getElementById('mp3Player');
    const mp3Button = document.getElementById('mp3Button');
    
    if (!mp3Player || !mp3Button) {
        console.error('Missing MP3 elements');
        return;
    }

    
    document.getElementById('mp3Source').src = mp3Path;
    mp3Player.load();

    
    mp3Button.addEventListener('click', function(e) {
        e.preventDefault();
        toggleMP3();
    });

    
    mp3Button.disabled = false;

    console.log('MP3 player setup complete');
}


function setupEventListeners() {
    console.log('Setting up event listeners');
    
    const playButton = document.getElementById('playButton');
    const voiceSelect = document.getElementById('voiceSelect');
    const rateSelect = document.getElementById('rateSelect');

    if (playButton) {
        playButton.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('TTS button clicked');
            toggleSpeech();
        });
    }

    if (voiceSelect) {
        voiceSelect.addEventListener('change', handleVoiceChange);
    }

    if (rateSelect) {
        rateSelect.addEventListener('change', handleRateChange);
    }

    console.log('Event listeners setup complete');
}


function toggleSpeech() {
    console.log('toggleSpeech called, ttsInitialized:', ttsInitialized);
    console.log('isPlaying:', isPlaying);

    if (!ttsInitialized) {
        console.error('TTS not initialized');
        showError('TTS chưa sẵn sàng');
        return;
    }

    if (isMP3Playing) {
        const mp3Player = document.getElementById('mp3Player');
        mp3Player.pause();
        isMP3Playing = false;
        resetMP3Button();
    }

    if (!isPlaying) {
        startReading();
    } else {
        stopReading();
    }
}


function initTTS() {
    console.log('Initializing TTS');
    try {
        if (!responsiveVoice) {
            throw new Error('ResponsiveVoice not loaded');
        }

        if (!responsiveVoice.voiceSupport()) {
            throw new Error('Browser does not support TTS');
        }

        setupElements();
        loadContentToRead();
        setupEventListeners();
        
        const playButton = document.getElementById('playButton');
        if (playButton) {
            playButton.disabled = false;
        }
        
        ttsInitialized = true;
        console.log('TTS initialized successfully');
        updateStatus('Sẵn sàng đọc');

    } catch (error) {
        console.error('TTS initialization error:', error);
        showError(error.message);
    }
}





function initTTS() {
    console.log('Đang khởi tạo TTS');
    try {
        if (!responsiveVoice) {
            throw new Error('ResponsiveVoice chưa được load');
        }

        if (!responsiveVoice.voiceSupport()) {
            throw new Error('Trình duyệt không hỗ trợ TTS');
        }

        
        if (!responsiveVoice.isInitialized()) {
            throw new Error('ResponsiveVoice chưa khởi tạo xong');
        }

        setupElements();
        loadContentToRead();
        setupEventListeners();
        
        const playButton = document.getElementById('playButton');
        if (playButton) {
            playButton.disabled = false;
        }
        
        ttsInitialized = true;
        console.log('TTS đã khởi tạo thành công');
        updateStatus('Sẵn sàng đọc');

    } catch (error) {
        console.error('Lỗi khởi tạo TTS:', error);
        showError(error.message);
        return false;
    }
    return true;
}


function toggleSpeech() {
    console.log('toggleSpeech called, ttsInitialized:', ttsInitialized);
    console.log('isPlaying:', isPlaying);

    
    if (!ttsInitialized && !initTTS()) {
        showError('TTS chưa sẵn sàng, vui lòng thử lại');
        return;
    }

    
    if (isMP3Playing) {
        const mp3Player = document.getElementById('mp3Player');
        mp3Player.pause();
        isMP3Playing = false;
        resetMP3Button();
    }

    if (!isPlaying) {
        startReading();
    } else {
        stopReading();
    }
}


























window.onload = function() {
   window.scrollTo(0, 0);
   updateParentHeight();
}


function updateParentHeight() {
   const height = document.documentElement.scrollHeight;
   window.parent.postMessage({ height: height }, '*');
}


new ResizeObserver(updateParentHeight).observe(document.body);


function shareOnFacebook() {
   const url = window.location.href;
   window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(url));
}

function shareOnTwitter() {
   const url = window.location.href;
   const title = document.title;
   window.open('https://twitter.com/intent/tweet?url=' + encodeURIComponent(url) + '&text=' + encodeURIComponent(title));
}
</script>
</body>
</html>