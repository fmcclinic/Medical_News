<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ung thư vòm họng - Tin Tức Y Khoa</title>
    
<script src="https://code.responsivevoice.org/responsivevoice.js?key=30xj8le1"></script>
        
  <script>
function waitForResponsiveVoice() {
    return new Promise((resolve, reject) => {
        let attempts = 0;
        const checkResponsiveVoice = setInterval(() => {
            attempts++;
            if (window.responsiveVoice && window.responsiveVoice.voiceSupport()) {
                clearInterval(checkResponsiveVoice);
                resolve();
            } else if (attempts > 50) { 
                clearInterval(checkResponsiveVoice);
                reject(new Error('ResponsiveVoice không load được'));
            }
        }, 100);
    });
}
    </script>


        <style>
         
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }

         
        .article-category {
            display: inline-block;
            background: #0070c0;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .article-title {
            font-size: 2em;
            margin-bottom: 15px;
            line-height: 1.2;
            color: #333;
            padding: 10px;
        }

        .article-meta {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .reading-time {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 3px 8px;
            background: #f0f0f0;
            border-radius: 15px;
        }

         
        .article-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .featured-image {
            width: 100%;
            height: auto;
            max-height: 500px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .article-content p {
            margin-bottom: 15px;
            line-height: 1.8;
            padding: 10px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .article-content p.current,
        .article-title.current {
            background: #f0f9ff;
            border-left: 3px solid #0070c0;
            padding-left: 15px;
        }

         
        .speech-controls {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .speech-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .speech-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }

        .controls-container {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .control-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: #0070c0;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .control-button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .control-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            min-width: 120px;
        }

        .progress-container {
            margin-top: 15px;
            background: #e9ecef;
            height: 4px;
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: #0070c0;
            width: 0;
            transition: width 0.3s;
        }

        .status {
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 4px;
            display: none;
        }

        .status.active {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status.reading {
            background: #e3f2fd;
            color: #0070c0;
            border-left: 4px solid #0070c0;
        }

        .status.paused {
            background: #fff3e0;
            color: #ef6c00;
            border-left: 4px solid #ef6c00;
        }

        .status.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #c62828;
        }

         
        .related-section {
            margin-top: 40px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .related-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #333;
        }

        .related-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .related-article {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .related-article:hover {
            transform: translateY(-3px);
        }

        .related-article img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }

        .related-article h3 {
            padding: 15px;
            margin: 0;
            flex: 1;
        }

        .related-article a {
            color: #333;
            text-decoration: none;
        }

        .related-article a:hover {
            color: #0070c0;
        }

        .related-article .date {
            display: block;
            padding: 0 15px 15px;
            color: #666;
            font-size: 0.9em;
        }

         
        .share-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .share-buttons {
            display: flex;
            gap: 10px;
        }

        .share-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: opacity 0.3s;
        }

        .share-button:hover {
            opacity: 0.9;
        }

        .share-button.facebook {
            background: #1877f2;
        }

        .share-button.twitter {
            background: #1da1f2;
        }

         
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .article-title {
                font-size: 1.8em;
            }

            .article-meta {
                flex-direction: column;
                align-items: flex-start;
            }

            .controls-container {
                flex-direction: column;
                align-items: stretch;
            }

            .related-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <span class="article-category">Tai Mũi Họng</span>
        
        <h1 class="article-title">Ung thư vòm họng</h1>
        
        <div class="article-meta">
            <span>Đăng ngày 19/12/2024</span>
            <span class="reading-time">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                2 phút đọc
            </span>
        </div>

        <img src="https://nyulangone.org/files/nasopharyngeal-cancer-surgery.jpg" alt="Ung thư vòm họng" class="featured-image">

        <div class="article-content">
<div class="speech-controls">
    <div class="speech-header">
        <span class="speech-title">Nghe bài viết</span>
    </div>
    
    <div class="controls-container">
        
        <button type="button" id="mp3Button" class="control-button" onclick="toggleMP3()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                <line x1="12" y1="19" x2="12" y2="23"/>
                <line x1="8" y1="23" x2="16" y2="23"/>
            </svg>
            <span>Audio đã thu</span>
        </button>

        
        <button type="button" id="playButton" class="control-button" onclick="toggleSpeech()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
            <span>Đọc bài viết</span>
        </button>
        
        
        <div id="ttsControls" class="speed-control">
            <select id="voiceSelect" onchange="handleVoiceChange()">
                <option value="Vietnamese Female">Giọng Nữ</option>
                <option value="Vietnamese Male">Giọng Nam</option>
            </select>
            <select id="rateSelect" onchange="handleRateChange()">
                <option value="0.8">Chậm</option>
                <option value="1" selected>Bình thường</option>
                <option value="1.2">Nhanh</option>
            </select>
        </div>
    </div>

    
    <audio id="mp3Player" controls style="width: 100%; margin-top: 10px; display: none;">
        <source id="mp3Source" type="audio/mpeg">
        Trình duyệt không hỗ trợ phát audio.
    </audio>

    <div class="progress-container">
        <div id="progress" class="progress-bar"></div>
    </div>

    <div id="status" class="status">
        <span id="statusText"></span>
    </div>
</div>

            <p>Ung thư vòm họng là một loại ung thư vùng đầu và cổ, bắt đầu từ các mô của vòm họng - phần trên của họng nằm sau mũi. Họng là một ống rỗng dài khoảng 5 inch</p><p>YẾU TỐ NGUY CƠ</p><p>Các yếu tố làm tăng nguy cơ mắc ung thư vòm họng bao gồm:</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nhiễm virus Epstein-Barr (EBV)</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sống hoặc có tổ tiên ở một số vùng Châu Á, Bắc Phi và Bắc Cực</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tiền sử gia đình có người mắc bệnh</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hút thuốc lá hoặc hít phải khói thuốc thụ động</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Uống rượu thường xuyên</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Chế độ ăn nhiều cá và thịt ướp muối</p><p>DẤU HIỆU VÀ TRIỆU CHỨNG</p><p>Giai đoạn sớm:</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cục u ở cổ</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Đau tai, ù tai</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Vấn đề về thính giác</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Đau họng</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nghẹt mũi</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Chảy máu mũi</p><p>Giai đoạn tiến triển:</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Lác mắt</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nhìn đôi</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Đau đầu</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tê mặt</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Yếu cơ mặt</p><p>CHẨN ĐOÁN VÀ XÉT NGHIỆM</p><p>Các xét nghiệm chính bao gồm:</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nội soi mũi họng kèm sinh thiết</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Chụp MRI</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Chụp PET-CT</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Xét nghiệm virus EBV và HPV</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Khám thần kinh</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Kiểm tra thính lực</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Xét nghiệm máu</p><p>PHÂN GIAI ĐOẠN</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Giai đoạn 0: Tế bào bất thường trong niêm mạc vòm họng</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Giai đoạn I: Ung thư chỉ ở vòm họng hoặc lan đến hầu họng/khoang mũi</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Giai đoạn II: Ung thư lan đến hạch bạch huyết cổ một bên</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Giai đoạn III: Ung thư lan đến hạch bạch huyết cả hai bên cổ</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Giai đoạn IV: Chia thành IVA (lan đến não, dây thần kinh sọ) và IVB (di căn xa)</p><p>ĐIỀU TRỊ</p><p>Các phương pháp điều trị chính:</p><p>1.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Xạ trị:</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Xạ trị ngoài (IMRT, xạ trị định vị)</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Xạ trị trong (áp sát)</p><p>2.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hóa trị với các thuốc:</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Carboplatin</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cisplatin</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Docetaxel</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Fluorouracil</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gemcitabin</p><p>3.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Phẫu thuật:</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cắt bỏ khối u kháng xạ</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cắt hạch bạch huyết di căn</p><p>Phác đồ điều trị theo giai đoạn:</p><p>Giai đoạn I:</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Xạ trị vào khối u và hạch bạch huyết cổ</p><p>Giai đoạn II, III, IVA:</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Xạ trị kết hợp hóa trị</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Có thể phẫu thuật nếu còn tế bào ung thư sau điều trị</p><p>Giai đoạn IVB và tái phát:</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Xạ trị</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Phẫu thuật</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hóa trị</p><p>TÁC DỤNG PHỤ</p><p>Tác dụng phụ muộn có thể gặp:</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Khô miệng mãn tính</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Biến chứng răng miệng</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mất thính lực</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mất thị lực</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Khó nuốt</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Khóa hàm</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rối loạn tuyến giáp và tuyến yên</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Tổn thương thần kinh não</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thay đổi tâm trạng, nhận thức</p><p>THEO DÕI SAU ĐIỀU TRỊ</p><p>Cần theo dõi định kỳ để:</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Đánh giá đáp ứng điều trị</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Phát hiện tái phát sớm</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Kiểm soát tác dụng phụ</p><p>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Khám đầu cổ định kỳ</p><p>Ngoài ra, bệnh nhân có thể tham gia các thử nghiệm lâm sàng về phương pháp điều trị mới hoặc cách thức mới để sử dụng các phương pháp điều trị hiện có.</p>
            <div class="share-section">
                <div class="share-buttons">
                    <button onclick="shareOnFacebook()" class="share-button facebook">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
                        </svg>
                        Chia sẻ Facebook
                    </button>
                    <button onclick="shareOnTwitter()" class="share-button twitter">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
                        </svg>
                        Chia sẻ Twitter
                    </button>
                </div>
            </div>
        </div>

        <div class="related-section">
            <h2 class="related-title">Bài viết liên quan</h2>
            <div class="related-grid">
                
      <div class="related-article">
        <img src="https://cdn2.momjunction.com/wp-content/uploads/2022/10/Place-an-ice-pack-on-the-nose-to-relieve-a-nosebleed.jpg.webp" alt="Chảy máu cam (Chảy máu mũi)">
        <h3>
          <a href="../../articles/NEWS_20241220004543/NEWS_20241220004543.html">Chảy máu cam (Chảy máu mũi)</a>
        </h3>
        <span class="date">20/12/2024</span>
      </div>
    
      <div class="related-article">
        <img src="https://github.com/fmcclinic/Medical_News/blob/main/news/image/Nosebleed-1.jpg?raw=true" alt="Chảy máu mũi (Máu cam): Nguyên nhân, Triệu chứng và Cách điều trị">
        <h3>
          <a href="../../articles/NEWS_20241219230409/NEWS_20241219230409.html">Chảy máu mũi (Máu cam): Nguyên nhân, Triệu chứng và Cách điều trị</a>
        </h3>
        <span class="date">19/12/2024</span>
      </div>
    
      <div class="related-article">
        <img src="https://www.aceaudiology.com.au/wp-content/uploads/2021/09/Hearing-Aids-Buying-Guide.jpg" alt="Cách lựa chọn máy trợ thính phù hợp">
        <h3>
          <a href="../../articles/NEWS_20241214135749/NEWS_20241214135749.html">Cách lựa chọn máy trợ thính phù hợp</a>
        </h3>
        <span class="date">14/12/2024</span>
      </div>
                </div>
        </div>
    </div>

<script>

const TTS_CONFIG = {
   VOICE_OPTIONS: {
       'Vietnamese Female': {
           name: 'Vietnamese Female',
           lang: 'vi-VN',
           rate: 1,
           pitch: 1.1,
           volume: 1
       },
       'Vietnamese Male': {
           name: 'Vietnamese Male',
           lang: 'vi-VN',
           rate: 1,
           pitch: 0.9,
           volume: 1
       }
   },
   PAUSE_BETWEEN: 500 
};





document.addEventListener('DOMContentLoaded', async function() {
    try {
        
        await waitForResponsiveVoice();
        console.log('ResponsiveVoice đã load và sẵn sàng');

        
        initTTS();
        checkForMP3();

    } catch (error) {
        console.error('Không thể khởi tạo ResponsiveVoice:', error);
    }
});


function initTTS() {
    console.log('Đang khởi tạo TTS');
    try {
        if (!window.responsiveVoice) {
            throw new Error('ResponsiveVoice chưa load');
        }

        if (!window.responsiveVoice.voiceSupport()) {
            throw new Error('Trình duyệt không hỗ trợ TTS');
        }

        setupElements();
        loadContentToRead();
        setupEventListeners();
        
        const playButton = document.getElementById('playButton');
        if (playButton) {
            playButton.disabled = false;
        }
        
        ttsInitialized = true;
        console.log('TTS đã khởi tạo thành công');
        updateStatus('Sẵn sàng đọc');

    } catch (error) {
        console.error('Lỗi khởi tạo TTS:', error);
        showError(error.message);
    }
}


function showError(message) {
    console.error(message);
    const statusText = document.getElementById('statusText');
    const status = document.getElementById('status');
    if (statusText && status) {
        statusText.textContent = message;
        status.className = 'status active error';
    }
}


function checkForMP3() {
   const pathParts = window.location.pathname.split('/');
   const newsId = pathParts[pathParts.length - 1].replace('.html', '');
   const mp3Path = `${newsId}.mp3`;
   
   const audio = document.createElement('audio');
   audio.addEventListener('canplaythrough', function() {
       setupMP3Player(mp3Path);
   });

   audio.addEventListener('error', function() {
       console.log('Không tìm thấy file MP3');
       document.getElementById('mp3Button').disabled = true;
   });

   audio.src = mp3Path;
   audio.load();
}


function setupMP3Player(mp3Path) {
   const mp3Player = document.getElementById('mp3Player');
   document.getElementById('mp3Source').src = mp3Path;
   mp3Player.load();

   
   const mp3Button = document.getElementById('mp3Button');
   mp3Button.disabled = false;
   mp3Button.onclick = toggleMP3;

   
   mp3Player.addEventListener('ended', function() {
       isMP3Playing = false;
       resetMP3Button();
   });
}


function toggleMP3() {
   if (isPlaying) {
       stopReading(); 
   }

   const mp3Player = document.getElementById('mp3Player');
   const mp3Button = document.getElementById('mp3Button');

   if (!isMP3Playing) {
       mp3Player.style.display = 'block';
       mp3Player.play();
       isMP3Playing = true;
       mp3Button.innerHTML = `
           <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
               <rect x="6" y="4" width="4" height="16"></rect>
               <rect x="14" y="4" width="4" height="16"></rect>
           </svg>
           <span>Tạm dừng</span>`;
   } else {
       mp3Player.pause();
       isMP3Playing = false;
       resetMP3Button();
   }
}


function resetMP3Button() {
   const mp3Button = document.getElementById('mp3Button');
   mp3Button.innerHTML = `
       <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
           <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
           <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
           <line x1="12" y1="19" x2="12" y2="23"/>
           <line x1="8" y1="23" x2="16" y2="23"/>
       </svg>
       <span>Audio đã thu</span>`;
}




function setupElements() {
   const elements = ['playButton', 'voiceSelect', 'rateSelect', 'status', 'progress'];
   elements.forEach(id => {
       if (!document.getElementById(id)) {
           throw new Error(`Thiếu element: ${id}`);
       }
   });
}


function loadContentToRead() {
    const title = document.querySelector('.article-title');
    const paragraphElements = document.querySelectorAll('.article-content p');

    console.log('Title element:', title);
    console.log('Paragraph elements:', paragraphElements);

    paragraphs = [];

    
    if (title) {
        paragraphs.push({
            element: title,
            text: title.textContent.trim()
        });
    }

    
    const content = document.querySelector('.article-content');
    if (content) {
        
        const textElements = content.querySelectorAll('p, div > p, ul > li, ol > li');
        textElements.forEach((element) => {
            const text = element.textContent.trim();
            if (text.length > 0) {
                paragraphs.push({
                    element: element,
                    text: text
                });
            }
        });
    }

    console.log('Total paragraphs loaded:', paragraphs.length);
    console.log('Paragraphs content:', paragraphs.map(p => p.text));
}





function startReading() {
   isPlaying = true;
   currentParagraphIndex = 0;
   updateUI('reading');
   readNextParagraph();
}




function highlightParagraph(index) {
   if (paragraphs[index]) {
       paragraphs[index].element.classList.add('current');
       scrollToParagraph(paragraphs[index].element);
   }
}


function unhighlightParagraph(index) {
   if (paragraphs[index]) {
       paragraphs[index].element.classList.remove('current');
   }
}


function unhighlightAll() {
   paragraphs.forEach(p => p.element.classList.remove('current'));
}


function scrollToParagraph(element) {
   element.scrollIntoView({
       behavior: 'smooth',
       block: 'center'
   });
}


function updateUI(state) {
   const button = document.getElementById('playButton');
   if (button) {
       button.innerHTML = isPlaying ? 
           `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
               <rect x="6" y="4" width="4" height="16"></rect>
               <rect x="14" y="4" width="4" height="16"></rect>
           </svg>
           <span>Tạm dừng</span>` :
           `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
               <polygon points="5 3 19 12 5 21 5 3"></polygon>
           </svg>
           <span>Đọc bài viết</span>`;
   }
   updateStatus(state);
}

// Update status message
function updateStatus(state) {
   const status = document.getElementById('status');
   const statusText = document.getElementById('statusText');
   if (status && statusText) {
       status.className = 'status active ' + state;
       statusText.textContent = typeof state === 'string' ? state : 
           state === 'reading' ? 'Đang đọc...' :
           state === 'paused' ? 'Đã tạm dừng' :
           state === 'finished' ? 'Đã đọc xong' : '';
   }
}


function updateProgress(percent) {
   const progress = document.getElementById('progress');
   if (progress) {
       progress.style.width = percent + '%';
   }
}


function handleVoiceChange() {
   if (isPlaying) {
       restartReading();
   }
}


function handleRateChange() {
   if (isPlaying) {
       restartReading();
   }
}


function restartReading() {
   stopReading();
   startReading();
}


function showError(message) {
   console.error(message);
   updateStatus('error');
   const statusText = document.getElementById('statusText');
   if (statusText) {
       statusText.textContent = message;
   }
}













function toggleMP3() {
    console.log('toggleMP3 called');
    if (isPlaying) {
        stopReading(); 
    }

    const mp3Player = document.getElementById('mp3Player');
    const mp3Button = document.getElementById('mp3Button');

    
    console.log('mp3Player:', mp3Player);
    console.log('mp3Button:', mp3Button);

    if (!isMP3Playing) {
        mp3Player.style.display = 'block';
        mp3Player.play();
        isMP3Playing = true;
        mp3Button.innerHTML = `...`; 
    } else {
        mp3Player.pause();
        isMP3Playing = false;
        resetMP3Button();
    }
}


function setupMP3Player(mp3Path) {
    console.log('Setting up MP3 player with path:', mp3Path);
    
    const mp3Player = document.getElementById('mp3Player');
    const mp3Button = document.getElementById('mp3Button');
    
    if (!mp3Player || !mp3Button) {
        console.error('Missing MP3 elements');
        return;
    }

    
    document.getElementById('mp3Source').src = mp3Path;
    mp3Player.load();

    
    mp3Button.addEventListener('click', function(e) {
        e.preventDefault();
        toggleMP3();
    });

    
    mp3Button.disabled = false;

    console.log('MP3 player setup complete');
}


function setupEventListeners() {
    console.log('Setting up event listeners');
    
    const playButton = document.getElementById('playButton');
    const voiceSelect = document.getElementById('voiceSelect');
    const rateSelect = document.getElementById('rateSelect');

    if (playButton) {
        playButton.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('TTS button clicked');
            toggleSpeech();
        });
    }

    if (voiceSelect) {
        voiceSelect.addEventListener('change', handleVoiceChange);
    }

    if (rateSelect) {
        rateSelect.addEventListener('change', handleRateChange);
    }

    console.log('Event listeners setup complete');
}


function toggleSpeech() {
    console.log('toggleSpeech called, ttsInitialized:', ttsInitialized);
    console.log('isPlaying:', isPlaying);

    if (!ttsInitialized) {
        console.error('TTS not initialized');
        showError('TTS chưa sẵn sàng');
        return;
    }

    if (isMP3Playing) {
        const mp3Player = document.getElementById('mp3Player');
        mp3Player.pause();
        isMP3Playing = false;
        resetMP3Button();
    }

    if (!isPlaying) {
        startReading();
    } else {
        stopReading();
    }
}









function toggleSpeech() {
    console.log('toggleSpeech called, ttsInitialized:', ttsInitialized);
    console.log('isPlaying:', isPlaying);

    
    if (!ttsInitialized && !initTTS()) {
        showError('TTS chưa sẵn sàng, vui lòng thử lại');
        return;
    }

    
    if (isMP3Playing) {
        const mp3Player = document.getElementById('mp3Player');
        mp3Player.pause();
        isMP3Playing = false;
        resetMP3Button();
    }

    if (!isPlaying) {
        startReading();
    } else {
        stopReading();
    }
}








function toggleSpeech() {
    console.log('toggleSpeech called, ttsInitialized:', ttsInitialized);
    console.log('isPlaying before toggle:', isPlaying);

    if (!ttsInitialized) {
        showError('TTS chưa sẵn sàng');
        return;
    }

    if (isMP3Playing) {
        const mp3Player = document.getElementById('mp3Player');
        mp3Player.pause();
        isMP3Playing = false;
        resetMP3Button();
    }

    isPlaying = !isPlaying; 
    console.log('isPlaying after toggle:', isPlaying);

    if (isPlaying) {
        startReading();
    } else {
        stopReading();
    }
}



function setupEventListeners() {
    console.log('Setting up event listeners');
    
    
    const playButton = document.getElementById('playButton');
    if (playButton) {
        playButton.removeEventListener('click', toggleSpeech); 
        playButton.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation(); 
            console.log('TTS button clicked');
            
            if (!isPlaying) {
                isPlaying = true;
                startReading();
            } else {
                isPlaying = false;
                stopReading();
            }
        });
    }

    
    const voiceSelect = document.getElementById('voiceSelect');
    const rateSelect = document.getElementById('rateSelect');

    if (voiceSelect) {
        voiceSelect.addEventListener('change', handleVoiceChange);
    }

    if (rateSelect) {
        rateSelect.addEventListener('change', handleRateChange);
    }

    console.log('Event listeners setup complete');
}

function readNextParagraph() {
    console.log('Reading paragraph:', currentParagraphIndex + 1, 'of', paragraphs.length);
    console.log('isPlaying status:', isPlaying);

    if (currentParagraphIndex < paragraphs.length) {
        try {
            const voiceName = document.getElementById('voiceSelect').value;
            const rate = parseFloat(document.getElementById('rateSelect').value);

            console.log('Current text:', paragraphs[currentParagraphIndex].text);
            console.log('Voice:', voiceName, 'Rate:', rate);

            responsiveVoice.speak(
                paragraphs[currentParagraphIndex].text,
                voiceName,
                {
                    rate: rate,
                    onstart: () => {
                        console.log(`Bắt đầu đọc đoạn ${currentParagraphIndex + 1}/${paragraphs.length}`);
                        updateStatus(`Đang đọc đoạn ${currentParagraphIndex + 1}/${paragraphs.length}`);
                        highlightParagraph(currentParagraphIndex);
                        updateProgress(((currentParagraphIndex + 1) / paragraphs.length) * 100);
                    },
                    onend: () => {
                        console.log(`Kết thúc đọc đoạn ${currentParagraphIndex + 1}`);
                        unhighlightParagraph(currentParagraphIndex);
                        
                        
                        currentParagraphIndex++;
                        if (isPlaying && currentParagraphIndex < paragraphs.length) {
                            console.log('Proceeding to next paragraph');
                            readNextParagraph(); 
                        } else if (currentParagraphIndex >= paragraphs.length) {
                            console.log('Reached end of content');
                            finishReading();
                        }
                    }
                }
            );
        } catch (error) {
            console.error('Error in readNextParagraph:', error);
            stopReading();
        }
    } else {
        finishReading();
    }
}


function setupPlayButton() {
    const playButton = document.getElementById('playButton');
    if (playButton) {
        playButton.onclick = function(e) {
            e.preventDefault();
            console.log('Play button clicked');
            if (!isPlaying) {
                isPlaying = true;
                currentParagraphIndex = 0; 
                startReading();
            } else {
                isPlaying = false;
                stopReading();
            }
            updateUI(isPlaying ? 'reading' : 'paused');
        };
    }
}






let isPlaying = false;
let isMP3Playing = false;
let currentParagraphIndex = 0;
let paragraphs = [];
let ttsInitialized = false;



function stopReading() {
    console.log('Stopping reading');
    isPlaying = false;
    if (responsiveVoice) {
        responsiveVoice.cancel(); 
    }
    unhighlightAll();
    updateUI('paused');
}


function startReading() {
    console.log('Starting reading');
    isPlaying = true;
    currentParagraphIndex = 0;
    updateUI('reading');
    readNextParagraph();
}


function handlePlayButtonClick() {
    console.log('Play button clicked, current state:', isPlaying);
    if (!isPlaying) {
        startReading();
    } else {
        stopReading();
    }
}


function setupPlayButton() {
    const playButton = document.getElementById('playButton');
    if (playButton) {
        playButton.onclick = handlePlayButtonClick;
    }
}


function readNextParagraph() {
    console.log('Reading paragraph:', currentParagraphIndex + 1, 'of', paragraphs.length);
    console.log('isPlaying status:', isPlaying);

    if (!isPlaying) {
        console.log('Reading stopped');
        return;
    }

    if (currentParagraphIndex < paragraphs.length) {
        try {
            const voiceName = document.getElementById('voiceSelect').value;
            const rate = parseFloat(document.getElementById('rateSelect').value);

            console.log('Current text:', paragraphs[currentParagraphIndex].text);
            console.log('Voice:', voiceName, 'Rate:', rate);

            responsiveVoice.speak(
                paragraphs[currentParagraphIndex].text,
                voiceName,
                {
                    rate: rate,
                    onstart: () => {
                        console.log(`Bắt đầu đọc đoạn ${currentParagraphIndex + 1}/${paragraphs.length}`);
                        updateStatus(`Đang đọc đoạn ${currentParagraphIndex + 1}/${paragraphs.length}`);
                        highlightParagraph(currentParagraphIndex);
                        updateProgress(((currentParagraphIndex + 1) / paragraphs.length) * 100);
                    },
                    onend: () => {
                        console.log(`Kết thúc đọc đoạn ${currentParagraphIndex + 1}`);
                        unhighlightParagraph(currentParagraphIndex);
                        
                        if (isPlaying) {
                            currentParagraphIndex++;
                            if (currentParagraphIndex < paragraphs.length) {
                                console.log('Moving to next paragraph');
                                readNextParagraph();
                            } else {
                                console.log('Reached end of content');
                                finishReading();
                            }
                        }
                    }
                }
            );
        } catch (error) {
            console.error('Error in readNextParagraph:', error);
            stopReading();
        }
    } else {
        finishReading();
    }
}


function setupEventListeners() {
    console.log('Setting up event listeners');
    setupPlayButton();
    
    
    const voiceSelect = document.getElementById('voiceSelect');
    const rateSelect = document.getElementById('rateSelect');

    if (voiceSelect) {
        voiceSelect.onchange = handleVoiceChange;
    }

    if (rateSelect) {
        rateSelect.onchange = handleRateChange;
    }

    console.log('Event listeners setup complete');
}



















window.onload = function() {
   window.scrollTo(0, 0);
   updateParentHeight();
}


function updateParentHeight() {
   const height = document.documentElement.scrollHeight;
   window.parent.postMessage({ height: height }, '*');
}


new ResizeObserver(updateParentHeight).observe(document.body);


function shareOnFacebook() {
   const url = window.location.href;
   window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(url));
}

function shareOnTwitter() {
   const url = window.location.href;
   const title = document.title;
   window.open('https://twitter.com/intent/tweet?url=' + encodeURIComponent(url) + '&text=' + encodeURIComponent(title));
}
</script>
</body>
</html>