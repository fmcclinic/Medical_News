<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tầm soát ung thư vòm họng: Bảo vệ sức khỏe bạn - Tin Tức Y Khoa</title>

    <meta name="description" content="Ung thư vòm họng là một loại ung thư nguy hiểm, nhưng nếu được phát hiện sớm, khả năng điều trị thành công sẽ cao hơn rất nhiều. Vì vậy, tầm soát u...">
    <meta name="keywords" content="Tai Mũi Họng, y học, sức khỏe, tin tức y khoa">
    <meta name="author" content="Medical Team">

    <meta property="og:type" content="article" />
    <meta property="og:title" content="Tầm soát ung thư vòm họng: Bảo vệ sức khỏe bạn" />
    <meta property="og:description" content="Ung thư vòm họng là một loại ung thư nguy hiểm, nhưng nếu được phát hiện sớm, khả năng điều trị thành công sẽ cao hơn rất nhiều. Vì vậy, tầm soát u..." />
    <meta property="og:image" content="https://suckhoedoisong.qltns.mediacdn.vn/Images/nguyenkhanh/2017/12/21/noi_soi_tai_mui_hong.jpg" />
    <meta property="og:site_name" content="Tin Tức Y Khoa" />
    <meta property="article:section" content="Tai Mũi Họng" />
    <meta property="article:published_time" content="12/12/2024" />

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Tầm soát ung thư vòm họng: Bảo vệ sức khỏe bạn">
    <meta name="twitter:description" content="Ung thư vòm họng là một loại ung thư nguy hiểm, nhưng nếu được phát hiện sớm, khả năng điều trị thành công sẽ cao hơn rất nhiều. Vì vậy, tầm soát u...">
    <meta name="twitter:image" content="https://suckhoedoisong.qltns.mediacdn.vn/Images/nguyenkhanh/2017/12/21/noi_soi_tai_mui_hong.jpg">
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=30xj8le1"></script>
    
    <script>
    function waitForResponsiveVoice() {
        return new Promise((resolve, reject) => {
            let attempts = 0;
            const checkResponsiveVoice = setInterval(() => {
                attempts++;
                if (window.responsiveVoice && window.responsiveVoice.voiceSupport()) {
                    clearInterval(checkResponsiveVoice);
                    resolve();
                } else if (attempts > 50) { 
                    clearInterval(checkResponsiveVoice);
                    reject(new Error('ResponsiveVoice không load được'));
                }
            }, 100);
        });
    }
    </script>

    <style>
         
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }

         
        .article-category {
            display: inline-block;
            background: #0070c0;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .article-title {
            font-size: 2em;
            margin-bottom: 15px;
            line-height: 1.2;
            color: #333;
            padding: 10px;
        }

        .article-meta {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .reading-time {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 3px 8px;
            background: #f0f0f0;
            border-radius: 15px;
        }

         
        .article-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

         
        .article-content img {
            max-width: 100% !important;  
            height: auto !important;     
            display: block;              
            margin: 10px auto;           
            border-radius: 4px;          
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);  
        }

         
        .featured-image {
            display: block;
            width: auto;
            max-width: 100%;
            height: 500px;
            margin: 0 auto 20px auto;
            object-fit: contain;
            background-color: #f0f2f5;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            .featured-image {
                width: 100%;
                height: auto;
                max-height: 500px;
                object-fit: cover;
            }
        }

        .article-content p {
            margin-bottom: 15px;
            line-height: 1.8;
            padding: 10px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .article-content p.current,
        .article-title.current {
            background: #f0f9ff;
            border-left: 3px solid #0070c0;
            padding-left: 15px;
        }

         
        .speech-controls {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .speech-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .speech-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }

        .controls-container {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .control-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: #0070c0;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .control-button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .control-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            min-width: 120px;
        }

        .progress-container {
            margin-top: 15px;
            background: #e9ecef;
            height: 4px;
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: #0070c0;
            width: 0;
            transition: width 0.3s;
        }

        .status {
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 4px;
            display: none;
        }

        .status.active {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status.reading {
            background: #e3f2fd;
            color: #0070c0;
            border-left: 4px solid #0070c0;
        }

        .status.paused {
            background: #fff3e0;
            color: #ef6c00;
            border-left: 4px solid #ef6c00;
        }

        .status.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #c62828;
        }

         
        .related-section {
            margin-top: 40px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .related-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #333;
        }

        .related-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .related-article {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .related-article:hover {
            transform: translateY(-3px);
        }

        .related-article img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }

        .related-article h3 {
            padding: 15px;
            margin: 0;
            flex: 1;
        }

        .related-article a {
            color: #333;
            text-decoration: none;
        }

        .related-article a:hover {
            color: #0070c0;
        }

        .related-article .date {
            display: block;
            padding: 0 15px 15px;
            color: #666;
            font-size: 0.9em;
        }

         
        .share-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .share-buttons {
            display: flex;
            gap: 10px;
        }

        .share-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: opacity 0.3s;
        }

        .share-button:hover {
            opacity: 0.9;
        }

        .share-button.facebook {
            background: #1877f2;
        }

        .share-button.twitter {
            background: #1da1f2;
        }

         
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .article-title {
                font-size: 1.8em;
            }

            .article-meta {
                flex-direction: column;
                align-items: flex-start;
            }

            .controls-container {
                flex-direction: column;
                align-items: stretch;
            }

            .related-grid {
                grid-template-columns: 1fr;
            }
        }

         
        .article-content ul, 
        .article-content ol {
            padding-left: 40px !important;
            margin-bottom: 15px;
            list-style-type: disc !important;
        }

        .article-content li {
            display: list-item !important;
            list-style-type: disc !important;
        }

        .article-content ul ul,
        .article-content ol ol,
        .article-content ul ol,
        .article-content ol ul {
            list-style-type: circle !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <span class="article-category">Tai Mũi Họng</span>
        
        <h1 class="article-title">Tầm soát ung thư vòm họng: Bảo vệ sức khỏe bạn</h1>
        
        <div class="article-meta">
            <span>Đăng ngày 12/12/2024</span>
            <span class="reading-time">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                3 phút đọc
            </span>
        </div>

        <img src="https://suckhoedoisong.qltns.mediacdn.vn/Images/nguyenkhanh/2017/12/21/noi_soi_tai_mui_hong.jpg" alt="Tầm soát ung thư vòm họng: Bảo vệ sức khỏe bạn" class="featured-image">

        <div class="article-content">
            <div class="speech-controls">
                <div class="speech-header">
                    <span class="speech-title">Nghe bài viết</span>
                </div>
                
                <div class="controls-container">
                    <button id="mp3Button" class="control-button" onclick="toggleMP3()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                        </svg>
                        <span>Audio đã thu</span>
                    </button>

                    <button id="playButton" class="control-button">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                        <span>Đọc bài viết</span>
                    </button>
                    
                    <div class="speed-control">
                        <select id="voiceSelect">
                            <option value="Vietnamese Female">Giọng Nữ</option>
                            <option value="Vietnamese Male">Giọng Nam</option>
                        </select>
                        <select id="rateSelect">
                            <option value="0.8">Chậm</option>
                            <option value="1" selected>Bình thường</option>
                            <option value="1.2">Nhanh</option>
                        </select>
                    </div>
                </div>

                <audio id="mp3Player" class="audio-player" controls style="width: 100%; margin-top: 10px; display: none;">
                    <source id="mp3Source" type="audio/mpeg">
                    Trình duyệt không hỗ trợ phát audio.
                </audio>

                <div class="progress-container">
                    <div id="progress" class="progress-bar"></div>
                </div>

                <div id="status" class="status">
                    <span id="statusText"></span>
                </div>
            </div>

            
        <style>
           .article-content ul, .article-content ol { list-style-type: disc !important; margin-left: 20px !important; }
           .article-content li { display: list-item !important; list-style-type: disc !important; }
        </style>
      <p>Ung thư vòm họng là một loại ung thư nguy hiểm, nhưng nếu được phát hiện sớm, khả năng điều trị thành công sẽ cao hơn rất nhiều. Vì vậy, tầm soát ung thư vòm họng định kỳ là vô cùng quan trọng.</p><h3><strong>Tại sao phải tầm soát ung thư vòm họng?</strong></h3><ul><li><strong>Phát hiện sớm:</strong> Các dấu hiệu ban đầu của ung thư vòm họng thường không rõ ràng hoặc dễ bị nhầm lẫn với các bệnh lý khác. Tầm soát giúp phát hiện bệnh ở giai đoạn sớm, khi khối u còn nhỏ và chưa xâm lấn các mô xung quanh.</li><li><strong>Điều trị hiệu quả:</strong> Khi phát hiện sớm, các phương pháp điều trị sẽ đơn giản hơn, ít xâm lấn hơn và hiệu quả cao hơn.</li><li><strong>Nâng cao chất lượng cuộc sống:</strong> Phát hiện và điều trị kịp thời giúp người bệnh giảm thiểu các biến chứng nguy hiểm và duy trì chất lượng cuộc sống.</li></ul><h3><strong>Những ai nên tầm soát ung thư vòm họng?</strong></h3><ul><li><strong>Người lớn tuổi:</strong> Nguy cơ mắc bệnh tăng theo tuổi.</li><li><strong>Người hút thuốc:</strong> Hút thuốc là yếu tố nguy cơ hàng đầu gây ung thư vòm họng.</li><li><strong>Người thường xuyên tiếp xúc với các chất gây ô nhiễm:</strong> Các chất này có thể làm tăng nguy cơ mắc bệnh.</li><li><strong>Người có tiền sử gia đình mắc ung thư vòm họng:</strong> Di truyền cũng là một yếu tố nguy cơ.</li></ul><h3><strong>Các phương pháp tầm soát ung thư vòm họng</strong></h3><ul><li><strong>Khám lâm sàng:</strong> Bác sĩ sẽ khám tai, mũi, họng để phát hiện các bất thường như sưng hạch cổ, khối u, loét...</li><li><strong>Nội soi tai mũi họng:</strong> Sử dụng ống nội soi để quan sát trực tiếp các tổn thương trong vòm họng.</li><li><a href="https://suckhoedoisong.vn/noi-soi-tai-mui-hong-nguoi-benh-can-luu-y-gi-169139761.htm" target="_blank"><img src="https://encrypted-tbn3.gstatic.com/images?q=tbn:ANd9GcRVUx2VGEAPclHMZhAOcT8iK0B3-FwqLB6GXJwxxiK_gmJ_Zmc_b-3uMzjflcUd" alt="Image of Nội soi tai mũi họng"> Opens in a new window <img src="https://encrypted-tbn0.gstatic.com/favicon-tbn?q=tbn:ANd9GcTT6Qc6XqDmssw7MFfl-eErfyVAKxmoxXgXeCWKlJhQ5E4P4FYjIQLz5eqZnsZ5a0m61D9u2uhiMVhebL8PJUbokdTXMDsddv_K-lI">suckhoedoisong.vn</a></li><li>Nội soi tai mũi họng</li><li><strong>Sinh thiết:</strong> Lấy một mẫu mô nhỏ từ vùng nghi ngờ để xét nghiệm dưới kính hiển vi. Đây là cách chẩn đoán chính xác nhất.</li><li><strong>Xét nghiệm máu:</strong> Kiểm tra các chỉ số liên quan đến ung thư, như xét nghiệm tìm kháng thể virus Epstein-Barr (EBV).</li></ul><h3><strong>Các dấu hiệu cảnh báo ung thư vòm họng</strong></h3><ul><li>Đau họng kéo dài</li><li>Khó nuốt</li><li>Giảm cân không rõ nguyên nhân</li><li>Vùng cổ sưng hạch</li><li>Điếc một bên</li><li>Chảy máu mũi</li><li>Giọng nói thay đổi</li></ul><h3><strong>Cách phòng ngừa ung thư vòm họng</strong></h3><ul><li><strong>Không hút thuốc:</strong> Hút thuốc là nguyên nhân chính gây ung thư vòm họng.</li><li><strong>Hạn chế tiếp xúc với các chất gây ô nhiễm:</strong> Đeo khẩu trang khi làm việc trong môi trường ô nhiễm.</li><li><strong>Ăn uống lành mạnh:</strong> Tăng cường ăn rau quả, hạn chế đồ ăn chế biến sẵn.</li><li><strong>Khám sức khỏe định kỳ:</strong> Tầm soát ung thư vòm họng định kỳ để phát hiện sớm bệnh.</li></ul><p><strong>Lưu ý:</strong> Nếu bạn có bất kỳ dấu hiệu bất thường nào, hãy đến gặp bác sĩ chuyên khoa tai mũi họng để được khám và tư vấn kịp thời.</p><p><a href="https://medlatec.vn/tin-tuc/dau-hieu-ung-thu-vom-hong-nhu-the-nao-va-cach-xu-tri" target="_blank"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT-vu50KkbPjE5uUzaYtn5qPHIdDxDdEu7GSBdufJruAAJtMfAkJbNneHfRXmUH" alt="Image of Các dấu hiệu cảnh báo ung thư vòm họng"> Opens in a new window <img src="https://encrypted-tbn2.gstatic.com/favicon-tbn?q=tbn:ANd9GcT3BFDHiV4q1h14AweSjrKdyfjEoRq34DUwyE3gDHgOhVXRoy4XuEfFcfoakWCwEZRkcstSOU2V5YkO_NgVSNI2Bgcc590">medlatec.vn</a></p><p>Các dấu hiệu cảnh báo ung thư vòm họng</p><p><strong>Tầm soát ung thư vòm họng là một hành động quan trọng để bảo vệ sức khỏe của bạn và gia đình. Hãy chủ động khám sức khỏe định kỳ để phát hiện và điều trị bệnh kịp thời.</strong></p>
            <div class="share-section">
                <div class="share-buttons">
                    <button onclick="shareOnFacebook()" class="share-button facebook">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
                        </svg>
                        Chia sẻ Facebook
                    </button>
                    <button onclick="shareOnTwitter()" class="share-button twitter">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
                        </svg>
                        Chia sẻ Twitter
                    </button>
                </div>
            </div>
        </div>

        <div class="related-section">
            <h2 class="related-title">Bài viết liên quan</h2>
            <div class="related-grid">
                
        <div class="related-article">
          <a href="../NEWS_20241220004543/NEWS_20241220004543.html"><img src="https://cdn2.momjunction.com/wp-content/uploads/2022/10/Place-an-ice-pack-on-the-nose-to-relieve-a-nosebleed.jpg.webp" alt="Chảy máu cam (Chảy máu mũi)"></a>
          <h3><a href="../NEWS_20241220004543/NEWS_20241220004543.html">Chảy máu cam (Chảy máu mũi)</a></h3>
          <span class="date">20/12/2024</span>
        </div>
        <div class="related-article">
          <a href="../NEWS_20241219230409/NEWS_20241219230409.html"><img src="https://github.com/fmcclinic/Medical_News/blob/main/news/image/Nosebleed-1.jpg?raw=true" alt="Chảy máu mũi (Máu cam): Nguyên nhân, Triệu chứng và Cách điều trị"></a>
          <h3><a href="../NEWS_20241219230409/NEWS_20241219230409.html">Chảy máu mũi (Máu cam): Nguyên nhân, Triệu chứng và Cách điều trị</a></h3>
          <span class="date">19/12/2024</span>
        </div>
        <div class="related-article">
          <a href="../NEWS_20241219190958/NEWS_20241219190958.html"><img src="https://nyulangone.org/files/nasopharyngeal-cancer-surgery.jpg" alt="Ung thư vòm họng"></a>
          <h3><a href="../NEWS_20241219190958/NEWS_20241219190958.html">Ung thư vòm họng</a></h3>
          <span class="date">19/12/2024</span>
        </div>            </div>
        </div>
    </div>

<script>

let currentMP3File = null;
let audioPreviewUrl = null;
let isPlaying = false;
let isTTSPlaying = false;
let isMP3Playing = false;
let ttsInitialized = false;
let currentParagraphIndex = 0;
let paragraphs = [];


const TTS_CONFIG = {
    VOICE_OPTIONS: {
        'Vietnamese Female': { name: 'Vietnamese Female', lang: 'vi-VN', rate: 1, pitch: 1.1, volume: 1 },
        'Vietnamese Male': { name: 'Vietnamese Male', lang: 'vi-VN', rate: 1, pitch: 0.9, volume: 1 }
    },
    PAUSE_BETWEEN: 500 
};


document.addEventListener('DOMContentLoaded', function() {
    if (typeof responsiveVoice !== 'undefined') {
        responsiveVoice.OnVoiceReady = function() {
            console.log('ResponsiveVoice sẵn sàng');
            initTTS();
            setupMP3EventListeners();
        };
    }
    window.scrollTo(0, 0);
    updateParentHeight();
});


new ResizeObserver(updateParentHeight).observe(document.body);


function initTTS() {
    console.log('Đang khởi tạo TTS');
    try {
        if (!responsiveVoice.voiceSupport()) {
            throw new Error('Trình duyệt không hỗ trợ TTS');
        }
        setupElements();
        loadContentToRead();
        setupEventListeners();
        
        const playButton = document.getElementById('playButton');
        if (playButton) playButton.disabled = false;
        
        ttsInitialized = true;
        updateStatus('Sẵn sàng đọc');
    } catch (error) {
        console.error('Lỗi khởi tạo TTS:', error);
        showError(error.message);
    }
}


function setupElements() {
    const elements = ['playButton', 'voiceSelect', 'rateSelect', 'status', 'progress'];
    elements.forEach(id => {
        if (!document.getElementById(id)) throw new Error(`Thiếu element: ${id}`);
    });
}


function loadContentToRead() {
    const title = document.querySelector('.article-title');
    const contentElements = document.querySelectorAll('.article-content p, .article-content div > p, .article-content ul > li, .article-content ol > li');
    
    paragraphs = [];
    if (title) paragraphs.push({ element: title, text: title.textContent.trim() });

    contentElements.forEach(element => {
        const text = element.textContent.trim();
        if (text.length > 0) paragraphs.push({ element: element, text: text });
    });
}


function setupEventListeners() {
    const playButton = document.getElementById('playButton');
    const voiceSelect = document.getElementById('voiceSelect');
    const rateSelect = document.getElementById('rateSelect');
    const mp3Button = document.getElementById('mp3Button');

    if (playButton) {
        playButton.addEventListener('click', function(e) {
            e.preventDefault();
            toggleSpeech();
        });
    }
    if (voiceSelect) voiceSelect.addEventListener('change', handleVoiceChange);
    if (rateSelect) rateSelect.addEventListener('change', handleRateChange);
    if (mp3Button) mp3Button.addEventListener('click', toggleMP3);
}


function toggleMP3() {
    const mp3Player = document.getElementById('mp3Player');
    const mp3Button = document.getElementById('mp3Button');

    if (!mp3Player || !mp3Button) return;

    
    const pathParts = window.location.pathname.split('/');
    const newsId = pathParts[pathParts.length - 1].replace('.html', '');
    const mp3Path = `${newsId}.mp3`;

    const mp3Source = mp3Player.querySelector('source');
    if (!mp3Source?.src) mp3Source.src = mp3Path;

    mp3Player.style.display = 'block';

    if (mp3Player.paused) {
        mp3Player.load();
        mp3Player.addEventListener('loadeddata', function onLoad() {
            mp3Player.removeEventListener('loadeddata', onLoad);
            mp3Player.play()
                .then(() => {
                    isMP3Playing = true;
                    mp3Button.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg><span>Tạm dừng</span>`;
                })
                .catch(error => { isMP3Playing = false; });
        });
    } else {
        mp3Player.pause();
        isMP3Playing = false;
        mp3Button.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/>	</svg><span>Audio đã thu</span>`;
    }
}


function setupMP3EventListeners() {
    const mp3Player = document.getElementById('mp3Player');
    const mp3Button = document.getElementById('mp3Button');
    if (mp3Player && mp3Button) {
        mp3Player.addEventListener('ended', function() {
            isMP3Playing = false;
            mp3Button.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/></svg><span>Audio đã thu</span>`;
        });
    }
}


function toggleSpeech() {
    if (isMP3Playing) {
        const mp3Player = document.getElementById('mp3Player');
        const mp3Button = document.getElementById('mp3Button');
        mp3Player.pause();
        isMP3Playing = false;
        if (mp3Button) mp3Button.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/></svg><span>Audio đã thu</span>`;
    }

    if (!ttsInitialized) {
        showError('TTS chưa sẵn sàng');
        return;
    }

    if (!isPlaying) {
        startReading();
        isTTSPlaying = true;
    } else {
        stopReading();
        isTTSPlaying = false;
    }
}


function startReading() {
    isPlaying = true;
    currentParagraphIndex = 0;
    updateUI('reading');
    readNextParagraph();
}


function readNextParagraph() {
    if (currentParagraphIndex < paragraphs.length) {
        try {
            const voiceName = document.getElementById('voiceSelect').value;
            const rate = parseFloat(document.getElementById('rateSelect').value);
            const voiceConfig = TTS_CONFIG.VOICE_OPTIONS[voiceName];

            updateProgress(((currentParagraphIndex + 1) / paragraphs.length) * 100);
            highlightParagraph(currentParagraphIndex);

            responsiveVoice.speak(
                paragraphs[currentParagraphIndex].text,
                voiceName,
                {
                    pitch: voiceConfig.pitch,
                    rate: rate,
                    volume: voiceConfig.volume,
                    lang: voiceConfig.lang,
                    onstart: function() { updateStatus(`Đang đọc đoạn ${currentParagraphIndex + 1}/${paragraphs.length}`); },
                    onend: function() {
                        unhighlightParagraph(currentParagraphIndex);
                        currentParagraphIndex++;
                        if (isPlaying && currentParagraphIndex < paragraphs.length) {
                            setTimeout(readNextParagraph, TTS_CONFIG.PAUSE_BETWEEN);
                        } else if (currentParagraphIndex >= paragraphs.length) {
                            finishReading();
                        }
                    }
                }
            );
        } catch (error) {
            stopReading();
        }
    } else {
        finishReading();
    }
}

function stopReading() {
    responsiveVoice.cancel();
    isPlaying = false;
    isTTSPlaying = false;
    unhighlightAll();
    updateUI('paused');
}

function finishReading() {
    isPlaying = false;
    isTTSPlaying = false;
    updateProgress(100);
    updateUI('finished');
    unhighlightAll();
}

function highlightParagraph(index) {
    if (paragraphs[index]) {
        paragraphs[index].element.classList.add('current');
        scrollToParagraph(paragraphs[index].element);
    }
}

function unhighlightParagraph(index) {
    if (paragraphs[index]) paragraphs[index].element.classList.remove('current');
}

function unhighlightAll() {
    paragraphs.forEach(p => p.element.classList.remove('current'));
}

function scrollToParagraph(element) {
    element.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

function updateUI(state) {
    const button = document.getElementById('playButton');
    if (button) {
        button.innerHTML = isPlaying ? 
            `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg><span>Tạm dừng</span>` :
            `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg><span>Đọc bài viết</span>`;
    }
    updateStatus(state);
}

function updateStatus(state) {
    const status = document.getElementById('status');
    const statusText = document.getElementById('statusText');
    if (status && statusText) {
        status.className = 'status active ' + state;
        statusText.textContent = typeof state === 'string' ? state : 
            state === 'reading' ? 'Đang đọc...' :
            state === 'paused' ? 'Đã tạm dừng' :
            state === 'finished' ? 'Đã đọc xong' : '';
    }
}

function updateProgress(percent) {
    const progress = document.getElementById('progress');
    if (progress) progress.style.width = percent + '%';
}

function handleVoiceChange() { if (isPlaying) restartReading(); }
function handleRateChange() { if (isPlaying) restartReading(); }
function restartReading() { stopReading(); startReading(); }

function showError(message) {
    const statusText = document.getElementById('statusText');
    const status = document.getElementById('status');
    if (statusText && status) {
        statusText.textContent = message;
        status.className = 'status active error';
    }
}

function updateParentHeight() {
    const height = document.documentElement.scrollHeight;
    window.parent.postMessage({ height: height }, '*');
}

function shareOnFacebook() {
    const url = window.location.href;
    window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(url));
}

function shareOnTwitter() {
    const url = window.location.href;
    const title = document.title;
    window.open('https://twitter.com/intent/tweet?url=' + encodeURIComponent(url) + '&text=' + encodeURIComponent(title));
}
</script>
</body>
</html>