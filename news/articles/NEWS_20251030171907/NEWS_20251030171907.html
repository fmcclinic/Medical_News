<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Điều Trị  Thoái hóa khớp gối - Tin Tức Y Khoa</title>
    
<script src="https://code.responsivevoice.org/responsivevoice.js?key=30xj8le1"></script>
        
  <script>
function waitForResponsiveVoice() {
    return new Promise((resolve, reject) => {
        let attempts = 0;
        const checkResponsiveVoice = setInterval(() => {
            attempts++;
            if (window.responsiveVoice && window.responsiveVoice.voiceSupport()) {
                clearInterval(checkResponsiveVoice);
                resolve();
            } else if (attempts > 50) { 
                clearInterval(checkResponsiveVoice);
                reject(new Error('ResponsiveVoice không load được'));
            }
        }, 100);
    });
}
    </script>


        <style>
         
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }

         
        .article-category {
            display: inline-block;
            background: #0070c0;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .article-title {
            font-size: 2em;
            margin-bottom: 15px;
            line-height: 1.2;
            color: #333;
            padding: 10px;
        }

        .article-meta {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .reading-time {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 3px 8px;
            background: #f0f0f0;
            border-radius: 15px;
        }

         
        .article-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .featured-image {
            width: 100%;
            height: auto;
            max-height: 500px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .article-content p {
            margin-bottom: 15px;
            line-height: 1.8;
            padding: 10px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .article-content p.current,
        .article-title.current {
            background: #f0f9ff;
            border-left: 3px solid #0070c0;
            padding-left: 15px;
        }

         
        .speech-controls {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .speech-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .speech-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }

        .controls-container {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .control-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: #0070c0;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .control-button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        .control-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            min-width: 120px;
        }

        .progress-container {
            margin-top: 15px;
            background: #e9ecef;
            height: 4px;
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: #0070c0;
            width: 0;
            transition: width 0.3s;
        }

        .status {
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 4px;
            display: none;
        }

        .status.active {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status.reading {
            background: #e3f2fd;
            color: #0070c0;
            border-left: 4px solid #0070c0;
        }

        .status.paused {
            background: #fff3e0;
            color: #ef6c00;
            border-left: 4px solid #ef6c00;
        }

        .status.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #c62828;
        }

         
        .related-section {
            margin-top: 40px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .related-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #333;
        }

        .related-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .related-article {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .related-article:hover {
            transform: translateY(-3px);
        }

        .related-article img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }

        .related-article h3 {
            padding: 15px;
            margin: 0;
            flex: 1;
        }

        .related-article a {
            color: #333;
            text-decoration: none;
        }

        .related-article a:hover {
            color: #0070c0;
        }

        .related-article .date {
            display: block;
            padding: 0 15px 15px;
            color: #666;
            font-size: 0.9em;
        }

         
        .share-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .share-buttons {
            display: flex;
            gap: 10px;
        }

        .share-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: opacity 0.3s;
        }

        .share-button:hover {
            opacity: 0.9;
        }

        .share-button.facebook {
            background: #1877f2;
        }

        .share-button.twitter {
            background: #1da1f2;
        }

         
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .article-title {
                font-size: 1.8em;
            }

            .article-meta {
                flex-direction: column;
                align-items: flex-start;
            }

            .controls-container {
                flex-direction: column;
                align-items: stretch;
            }

            .related-grid {
                grid-template-columns: 1fr;
            }
        }

        
 
        .article-content ul, 
        .article-content ol {
            padding-left: 40px !important;  
            margin-bottom: 15px;
            list-style-type: disc !important;  
        }

         
        .article-content li {
            display: list-item !important;
            list-style-type: disc !important;  
        }

         
        .article-content ul ul,
        .article-content ol ol,
        .article-content ul ol,
        .article-content ol ul {
            list-style-type: circle !important;
        }
</style>
</head>
<body>
    <div class="container">
        <span class="article-category">Khoa Cơ Xương Khớp</span>
        
        <h1 class="article-title"> Điều Trị  Thoái hóa khớp gối</h1>
        
        <div class="article-meta">
            <span>Đăng ngày 30/10/2025</span>
            <span class="reading-time">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                7 phút đọc
            </span>
        </div>

        <img src="https://github.com/fmcclinic/Medical_News/blob/main/news/image/Tho%C3%A1i-h%C3%B3a-kh%E1%BB%9Bp-g%E1%BB%91i.gif?raw=true" alt=" Điều Trị  Thoái hóa khớp gối" class="featured-image">

        <div class="article-content">



<div class="speech-controls">
    <div class="speech-header">
        <span class="speech-title">Nghe bài viết</span>
    </div>
    
    <div class="controls-container">
        
        <button id="mp3Button" class="control-button" onclick="toggleMP3()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
            </svg>
            <span>Audio đã thu</span>
        </button>

        
        <button id="playButton" class="control-button">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
            <span>Đọc bài viết</span>
        </button>
        
        
        <div class="speed-control">
            <select id="voiceSelect">
                <option value="Vietnamese Female">Giọng Nữ</option>
                <option value="Vietnamese Male">Giọng Nam</option>
            </select>
            <select id="rateSelect">
                <option value="0.8">Chậm</option>
                <option value="1" selected>Bình thường</option>
                <option value="1.2">Nhanh</option>
            </select>
        </div>
    </div>

    
    <audio id="mp3Player" class="audio-player" controls style="width: 100%; margin-top: 10px; display: none;">
        <source id="mp3Source" type="audio/mpeg">
        Trình duyệt không hỗ trợ phát audio.
    </audio>

    <div class="progress-container">
        <div id="progress" class="progress-bar"></div>
    </div>

    <div id="status" class="status">
        <span id="statusText"></span>
    </div>
</div>


            
        <style>
            
           .article-content ul, 
           .article-content ol { 
               list-style-type: disc !important; 
               list-style-image: none !important;
               margin-left: 20px !important; 
               padding-left: 1.5rem !important;
           }
           
            
           .article-content li { 
               list-style-type: disc !important; 
               display: list-item !important;
               margin-bottom: 5px; 
           }

            
           .article-content ul ul, .article-content ol ul,
           .article-content ul ol, .article-content ol ol {
               list-style-type: circle !important;
           }
        </style>
      <p>Thoái hóa khớp gối là một bệnh lý khớp mãn tính và tiến triển. Bệnh được đặc trưng bởi <strong>suy giảm cấu trúc và chức năng của khớp hoạt dịch</strong>, không còn chỉ là bệnh của sụn khớp mà còn ảnh hưởng đến toàn bộ khớp. Đau là lý do chính khiến bệnh nhân tìm đến sự tư vấn y tế.</p><p>Nguyên tắc điều trị thoái hóa khớp gối là bắt đầu bằng các phương pháp <strong>bảo tồn (không phẫu thuật)</strong> và chỉ tiến hành phẫu thuật khi các biện pháp bảo tồn không còn hiệu quả hoặc khi bệnh đã ở giai đoạn cuối.</p><p>Dưới đây là các phương pháp điều trị bảo tồn và can thiệp hiệu quả nhất cho thoái hóa khớp gối:</p><p>I. Điều Trị Bảo Tồn (Conservative Treatment)</p><p>Các biện pháp bảo tồn đóng vai trò <strong>cốt lõi (first-line)</strong> trong quản lý thoái hóa khớp gối.</p><p>1. Phương pháp Không Dùng Thuốc (Non-pharmacological)</p><p>Đây là những chiến lược nền tảng được khuyến nghị áp dụng cho <strong>tất cả bệnh nhân</strong> thoái hóa khớp.</p><p>• <strong>Tập luyện và Vật lý trị liệu:</strong></p><p>&nbsp;&nbsp;&nbsp;&nbsp;◦ <strong>Tập thể dục trị liệu</strong> là một trong những liệu pháp hàng đầu. Các nghiên cứu cho thấy tập luyện kết hợp với giáo dục bệnh nhân mang lại <strong>sự giảm đau đáng kể</strong> và <strong>cải thiện chức năng</strong>.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;◦ Các chương trình tập thể dục trên cạn hoặc dưới nước, bao gồm các bài tập tăng cường sức mạnh cơ bắp và sức bền, được coi là cốt lõi.</p><p>• <strong>Giảm cân:</strong> Đối với bệnh nhân thừa cân hoặc béo phì, việc giảm trọng lượng từ 5% đến 10% có liên quan đến <strong>giảm đau đáng kể</strong> và <strong>cải thiện chức năng</strong>.</p><p>• <strong>Giáo dục bệnh nhân và Tự quản lý:</strong> Việc cung cấp kiến thức về bệnh và các lựa chọn điều trị là bước quan trọng. Bệnh nhân cần được sàng lọc các yếu tố ảnh hưởng đến chất lượng cuộc sống như trầm cảm, căng thẳng và chất lượng giấc ngủ.</p><p>• <strong>Sử dụng dụng cụ hỗ trợ:</strong> Bao gồm các thiết bị hỗ trợ đi lại hoặc nẹp gối, giúp bệnh nhân giảm tải trọng lên khớp gối bị ảnh hưởng và cải thiện chức năng.</p><p>2. Phương pháp Dược lý và Tiêm (Pharmacological and Injections)</p><p>a. Thuốc uống và Thuốc bôi ngoài da</p><p><br></p><p>• <strong>Thuốc kháng viêm không steroid (NSAIDs):</strong></p><p>&nbsp;&nbsp;&nbsp;&nbsp;◦ <strong>NSAIDs tại chỗ (Topical NSAIDs):</strong> Được khuyến nghị vì chúng giúp cải thiện chức năng. NSAIDs tại chỗ được ưu tiên do có nguy cơ tác dụng phụ toàn thân thấp hơn so với dạng uống, đặc biệt ở người cao tuổi có nhiều bệnh lý nền.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;◦ <strong>NSAIDs uống:</strong> Có thể được sử dụng để giảm triệu chứng đau. Tuy nhiên, cần lưu ý về nguy cơ ngộ độc lớn liên quan đến tim mạch và đường tiêu hóa khi sử dụng lâu dài.</p><p>• <strong>Paracetamol (Acetaminophen):</strong> Một số nghiên cứu cho rằng acetaminophen không mang lại lợi ích lâm sàng đáng kể so với giả dược.</p><p>• <strong>Thực phẩm bổ sung:</strong> Các chất bổ sung như <strong>Glucosamine</strong> và <strong>Chondroitin</strong> nói chung không được khuyến nghị do hiệu quả lâm sàng tối thiểu hoặc không đáng kể.</p><p>b. Liệu pháp Tiêm Nội khớp</p><p><br></p><p>• <strong>Tiêm Corticosteroid Nội khớp (IACSs):</strong> Được sử dụng để giảm đau khớp gối trong thời gian ngắn. Tuy nhiên, các nghiên cứu đã cảnh báo rằng việc tiêm corticosteroid thường xuyên có thể dẫn đến <strong>mất sụn khớp nhanh hơn</strong>.</p><p>• <strong>Tiêm Axit Hyaluronic (HA) (Viscosupplementation):</strong> HA đã được Cục Quản lý Thực phẩm và Dược phẩm Hoa Kỳ (FDA) chấp thuận cho thoái hóa khớp gối. HA là một lựa chọn điều trị không phẫu thuật. Tuy nhiên, khuyến nghị từ các hiệp hội chuyên môn khác nhau có sự không đồng nhất về việc sử dụng HA cho khớp gối.</p><p>• <strong>Tiêm Huyết tương giàu tiểu cầu (PRP):</strong> PRP là một lựa chọn tiêm nội khớp được sử dụng để điều trị thoái hóa khớp gối.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;◦ Một đánh giá hệ thống và phân tích tổng hợp, bao gồm 7 nghiên cứu với 722 đối tượng (364 bệnh nhân dùng PRP và 358 dùng HA), đã kết luận rằng <strong>PRP hiệu quả hơn</strong> HA trong điều trị thoái hóa khớp gối. Sự khác biệt về hiệu quả được ghi nhận là có ý nghĩa thống kê.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;◦ Hiệu quả của PRP so với HA được đánh giá dựa trên chỉ số WOMAC (Western Ontario and McMaster Universities Osteoarthritis Index).</p><p>&nbsp;&nbsp;&nbsp;&nbsp;◦ Mặc dù các kết quả phân tích tổng hợp cho thấy PRP hiệu quả hơn HA, một số hướng dẫn (ACR 2019) vẫn đưa ra khuyến nghị mạnh mẽ chống chỉ định PRP cho khớp gối do lo ngại về việc thiếu tiêu chuẩn hóa trong các chế phẩm sẵn có.</p><p>II. Điều Trị Can Thiệp (Phẫu thuật)</p><p>Phẫu thuật được xem là lựa chọn cho bệnh thoái hóa khớp gối ở <strong>giai đoạn cuối</strong>, khi bệnh nhân bị đau dai dẳng và mất chức năng nghiêm trọng, không đáp ứng với các phương pháp điều trị bảo tồn.</p><p>1. Phẫu thuật Thay khớp (Arthroplasty)</p><p>• <strong>Thay khớp gối toàn phần (TKA):</strong> Đây là can thiệp ngoại khoa chính và có giá trị cho bệnh thoái hóa khớp gối giai đoạn cuối. TKA giúp <strong>giảm đau và cải thiện khả năng vận động</strong> đáng kể. Sau TKA, hầu hết bệnh nhân có thể quay lại các hoạt động hàng ngày như đi bộ, đạp xe và leo cầu thang, nhưng các hoạt động cường độ cao như chạy hoặc thể thao đối kháng thường được khuyến cáo không nên thực hiện.</p><p>• <strong>Thay khớp gối bán phần (UKA):</strong> Còn được gọi là thay khớp gối một khoang. Đây là một lựa chọn cho những bệnh nhân thoái hóa khớp gối chỉ ảnh hưởng chủ yếu đến <strong>một khoang</strong> (thường là khoang giữa). Ưu điểm của UKA so với TKA bao gồm vết mổ nhỏ hơn, phục hồi dễ dàng và nhanh hơn, phạm vi chuyển động tốt hơn, mất máu ít hơn, và giảm thiểu các biến chứng ngắn hạn.</p><p>• <strong>Cắt xương chày cao (High Tibial Osteotomy - HTO):</strong> Được chỉ định cho bệnh nhân trẻ, năng động bị thoái hóa khớp một khoang, giúp trì hoãn nhu cầu thay khớp gối.</p><p>2. Liệu pháp Tái tạo và Tiềm năng (Regenerative and Emerging Therapies)</p><p>• <strong>Liệu pháp Tế bào gốc (Stem cell injection):</strong> Các tế bào gốc trung mô (Mesenchymal Stem Cells - MSCs) đang được nghiên cứu để điều trị thoái hóa khớp gối.</p><p>• <strong>Liệu pháp Gen (Gene Therapy):</strong> Đây là một phương pháp mới nổi nhằm thiết lập <strong>hiệu quả điều trị bền vững</strong> sau một lần tiêm nội khớp tại chỗ, thay vì phải dùng thuốc định kỳ. Liệu pháp gen sử dụng các vật liệu di truyền để thúc đẩy quá trình đồng hóa (anabolism) sụn khớp.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;◦ Một trong những mục tiêu đầy hứa hẹn là yếu tố tăng trưởng nguyên bào sợi 18 (FGF18). FGF18 (dưới dạng protein tái tổ hợp sprifermin) đã cho thấy khả năng tăng độ dày sụn và giảm đau trong các thử nghiệm.</p><p>&nbsp;&nbsp;&nbsp;&nbsp;◦ Các vector virus, đặc biệt là vector virus liên quan đến Adeno (AAV), là phương pháp được sử dụng rộng rãi và hiệu quả để vận chuyển gen trị liệu vào các tế bào khớp</p>
            <div class="share-section">
                <div class="share-buttons">
                    <button onclick="shareOnFacebook()" class="share-button facebook">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path>
                        </svg>
                        Chia sẻ Facebook
                    </button>
                    <button onclick="shareOnTwitter()" class="share-button twitter">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
                        </svg>
                        Chia sẻ Twitter
                    </button>
                </div>
            </div>
        </div>

        <div class="related-section">
            <h2 class="related-title">Bài viết liên quan</h2>
            <div class="related-grid">
                
        <div class="related-article">
          <a href="../NEWS_20251125195606/NEWS_20251125195606.html"><img src="https://sa1s3optim.patientpop.com/1536x/filters:format(webp)/assets/images/provider/photos/2756337.jpeg" alt="Cơn Gout Cấp – Hiểu Rõ “Kẻ Thù” Giấu Mặt Trong Khớp Xương"></a>
          <h3><a href="../NEWS_20251125195606/NEWS_20251125195606.html">Cơn Gout Cấp – Hiểu Rõ “Kẻ Thù” Giấu Mặt Trong Khớp Xương</a></h3>
          <span class="date">26/11/2025</span>
        </div>
        <div class="related-article">
          <a href="../NEWS_20251031110706/NEWS_20251031110706.html"><img src="https://raw.githubusercontent.com/fmcclinic/Medical_News/refs/heads/main/news/image/%C4%91au-kh%E1%BB%9Bp-g%E1%BB%91i.gif" alt="THOÁI HÓA KHỚP GỐI: 3 YẾU TỐ GÂY BỆNH CƠ BẢN BẠN CÓ THỂ KIỂM SOÁT ĐƯỢC"></a>
          <h3><a href="../NEWS_20251031110706/NEWS_20251031110706.html">THOÁI HÓA KHỚP GỐI: 3 YẾU TỐ GÂY BỆNH CƠ BẢN BẠN CÓ THỂ KIỂM SOÁT ĐƯỢC</a></h3>
          <span class="date">31/10/2025</span>
        </div>
        <div class="related-article">
          <a href="../NEWS_20251031081906/NEWS_20251031081906.html"><img src="https://github.com/fmcclinic/Medical_News/blob/main/news/image/What%20will%20the%20doctor%20do%20to%20diagnose%20knee%20osteoarthritis.gif?raw=true" alt="Bác sĩ sẽ làm gì để Chẩn đoán Thoái hóa khớp gối "></a>
          <h3><a href="../NEWS_20251031081906/NEWS_20251031081906.html">Bác sĩ sẽ làm gì để Chẩn đoán Thoái hóa khớp gối </a></h3>
          <span class="date">31/10/2025</span>
        </div>            </div>
        </div>
    </div>

<script>

let currentMP3File = null;
let audioPreviewUrl = null;
let isPlaying = false;
let isTTSPlaying = false;
let isMP3Playing = false;
let ttsInitialized = false;
let currentParagraphIndex = 0;
let paragraphs = [];


const TTS_CONFIG = {
    VOICE_OPTIONS: {
        'Vietnamese Female': {
            name: 'Vietnamese Female',
            lang: 'vi-VN',
            rate: 1,
            pitch: 1.1,
            volume: 1
        },
        'Vietnamese Male': {
            name: 'Vietnamese Male',
            lang: 'vi-VN',
            rate: 1,
            pitch: 0.9,
            volume: 1
        }
    },
    PAUSE_BETWEEN: 500 
};


document.addEventListener('DOMContentLoaded', function() {
    
    if (typeof responsiveVoice !== 'undefined') {
        responsiveVoice.OnVoiceReady = function() {
            console.log('ResponsiveVoice sẵn sàng');
            initTTS();
            setupMP3EventListeners();
        };
    }

    
    window.scrollTo(0, 0);
    updateParentHeight();
});


new ResizeObserver(updateParentHeight).observe(document.body);


function initTTS() {
    console.log('Đang khởi tạo TTS');
    try {
        if (!responsiveVoice.voiceSupport()) {
            throw new Error('Trình duyệt không hỗ trợ TTS');
        }

        setupElements();
        loadContentToRead();
        setupEventListeners();
        
        const playButton = document.getElementById('playButton');
        if (playButton) {
            playButton.disabled = false;
        }
        
        ttsInitialized = true;
        console.log('TTS đã khởi tạo thành công');
        updateStatus('Sẵn sàng đọc');

    } catch (error) {
        console.error('Lỗi khởi tạo TTS:', error);
        showError(error.message);
    }
}


function setupElements() {
    const elements = ['playButton', 'voiceSelect', 'rateSelect', 'status', 'progress'];
    elements.forEach(id => {
        if (!document.getElementById(id)) {
            throw new Error(`Thiếu element: ${id}`);
        }
    });
}


function loadContentToRead() {
    const title = document.querySelector('.article-title');
    const contentElements = document.querySelectorAll('.article-content p, .article-content div > p, .article-content ul > li, .article-content ol > li');
    
    console.log('Title element:', title);
    console.log('Content elements:', contentElements);

    paragraphs = [];

    
    if (title) {
        paragraphs.push({
            element: title,
            text: title.textContent.trim()
        });
    }

    
    contentElements.forEach(element => {
        const text = element.textContent.trim();
        if (text.length > 0) {
            paragraphs.push({
                element: element,
                text: text
            });
        }
    });

    console.log('Total paragraphs loaded:', paragraphs.length);
    console.log('Paragraphs content:', paragraphs.map(p => p.text));
}


function setupEventListeners() {
    console.log('Setting up event listeners');

    
    const playButton = document.getElementById('playButton');
    const voiceSelect = document.getElementById('voiceSelect');
    const rateSelect = document.getElementById('rateSelect');
    const mp3Button = document.getElementById('mp3Button');

    if (playButton) {
        playButton.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('TTS button clicked');
            toggleSpeech();
        });
    }

    if (voiceSelect) {
        voiceSelect.addEventListener('change', handleVoiceChange);
    }

    if (rateSelect) {
        rateSelect.addEventListener('change', handleRateChange);
    }

    if (mp3Button) {
        mp3Button.addEventListener('click', toggleMP3);
    }

    console.log('Event listeners setup complete');
}


function toggleMP3() {
    console.log('toggleMP3 called');

    const mp3Player = document.getElementById('mp3Player');
    const mp3Button = document.getElementById('mp3Button');

    console.log('MP3 Player:', mp3Player);
    console.log('MP3 Button:', mp3Button);
    console.log('Current MP3 state - paused:', mp3Player?.paused);

    if (!mp3Player || !mp3Button) {
        console.error('MP3 elements not found');
        return;
    }

    
    const pathParts = window.location.pathname.split('/');
    const newsId = pathParts[pathParts.length - 1].replace('.html', '');
    
    
    const mp3Path = `${newsId}.mp3`;

    console.log('MP3 Path:', mp3Path);

    
    const mp3Source = mp3Player.querySelector('source');
    if (!mp3Source?.src) {
        console.log('Setting MP3 source to:', mp3Path);
        mp3Source.src = mp3Path;
    }

    
    console.log('Current source:', mp3Source.src);

    
    mp3Player.style.display = 'block';

    if (mp3Player.paused) {
        console.log('Attempting to play MP3...');
        
        
        mp3Player.load();
        
        mp3Player.addEventListener('loadeddata', function onLoad() {
            console.log('MP3 loaded, attempting to play');
            mp3Player.removeEventListener('loadeddata', onLoad);
            
            
            mp3Player.play()
                .then(() => {
                    console.log('MP3 playing successfully');
                    isMP3Playing = true;
                    mp3Button.innerHTML = `
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <rect x="6" y="4" width="4" height="16"></rect>
                            <rect x="14" y="4" width="4" height="16"></rect>
                        </svg>
                        <span>Tạm dừng</span>`;
                })
                .catch(error => {
                    console.error('Error playing MP3:', error);
                    isMP3Playing = false;
                });
        });
    } else {
        console.log('Pausing MP3...');
        mp3Player.pause();
        isMP3Playing = false;
        mp3Button.innerHTML = `
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
            </svg>
            <span>Audio đã thu</span>`;
    }
}




function checkMP3Source() {
   const mp3Player = document.getElementById('mp3Player');
   const source = document.getElementById('mp3Source');
   const mp3Button = document.getElementById('mp3Button');
   
   console.log('Checking MP3 source elements:');
   console.log('Audio element:', mp3Player);
   console.log('Source element:', source);
   console.log('Button element:', mp3Button);
   
   if (mp3Player && source) {
       console.log('Current source:', source.src);
       console.log('Audio ready state:', mp3Player.readyState);
       console.log('Audio paused state:', mp3Player.paused);
       console.log('Audio current time:', mp3Player.currentTime);
       console.log('Audio duration:', mp3Player.duration);

       
       const isValidSource = source.src && source.src.length > 0;
       console.log('Is valid source:', isValidSource);

       
       if (isValidSource) {
           const testAudio = new Audio();
           testAudio.src = source.src;
           
           testAudio.addEventListener('loadedmetadata', () => {
               console.log('MP3 file is accessible');
               mp3Button.disabled = false;
           });

           testAudio.addEventListener('error', () => {
               console.error('Error loading MP3 file');
               mp3Button.disabled = true;
               showError('Không thể tải file MP3');
           });
       } else {
           console.log('No MP3 source set');
           mp3Button.disabled = true;
       }

       
       const events = mp3Player.eventNames?.() || [];
       console.log('Bound events:', events);

       return {
           hasSource: isValidSource,
           readyState: mp3Player.readyState,
           isPaused: mp3Player.paused,
           currentTime: mp3Player.currentTime,
           duration: mp3Player.duration
       };
   } else {
       console.error('Required MP3 elements not found');
       return null;
   }
}


function setupMP3EventListeners() {
    const mp3Player = document.getElementById('mp3Player');
    const mp3Button = document.getElementById('mp3Button');

    if (mp3Player && mp3Button) {
        mp3Player.addEventListener('ended', function() {
            isMP3Playing = false;
            mp3Button.innerHTML = `
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                </svg>
                <span>Audio đã thu</span>`;
        });
    }
}


function toggleSpeech() {
    console.log('toggleSpeech called, ttsInitialized:', ttsInitialized);
    console.log('isPlaying:', isPlaying);

    
    if (isMP3Playing) {
        const mp3Player = document.getElementById('mp3Player');
        const mp3Button = document.getElementById('mp3Button');
        
        mp3Player.pause();
        isMP3Playing = false;
        if (mp3Button) {
            mp3Button.innerHTML = `
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                </svg>
                <span>Audio đã thu</span>`;
        }
    }

    if (!ttsInitialized) {
        showError('TTS chưa sẵn sàng');
        return;
    }

    if (!isPlaying) {
        startReading();
        isTTSPlaying = true;
    } else {
        stopReading();
        isTTSPlaying = false;
    }
}

function startReading() {
    console.log('Starting reading');
    isPlaying = true;
    currentParagraphIndex = 0;
    updateUI('reading');
    readNextParagraph();
}


function readNextParagraph() {
    console.log('Reading paragraph:', currentParagraphIndex + 1, 'of', paragraphs.length);
    console.log('isPlaying status:', isPlaying);

    if (currentParagraphIndex < paragraphs.length) {
        try {
            const voiceName = document.getElementById('voiceSelect').value;
            const rate = parseFloat(document.getElementById('rateSelect').value);
            const voiceConfig = TTS_CONFIG.VOICE_OPTIONS[voiceName];

            updateProgress(((currentParagraphIndex + 1) / paragraphs.length) * 100);
            highlightParagraph(currentParagraphIndex);

            console.log('Current text:', paragraphs[currentParagraphIndex].text);

            responsiveVoice.speak(
                paragraphs[currentParagraphIndex].text,
                voiceName,
                {
                    pitch: voiceConfig.pitch,
                    rate: rate,
                    volume: voiceConfig.volume,
                    lang: voiceConfig.lang,
                    onstart: function() {
                        console.log(`Bắt đầu đọc đoạn ${currentParagraphIndex + 1}/${paragraphs.length}`);
                        updateStatus(`Đang đọc đoạn ${currentParagraphIndex + 1}/${paragraphs.length}`);
                    },
                    onend: function() {
                        console.log(`Kết thúc đọc đoạn ${currentParagraphIndex + 1}`);
                        unhighlightParagraph(currentParagraphIndex);
                        currentParagraphIndex++;

                        
                        if (isPlaying && currentParagraphIndex < paragraphs.length) {
                            console.log('Moving to next paragraph after delay');
                            setTimeout(readNextParagraph, TTS_CONFIG.PAUSE_BETWEEN);
                        } else if (currentParagraphIndex >= paragraphs.length) {
                            console.log('Reached end of content');
                            finishReading();
                        }
                    }
                }
            );
        } catch (error) {
            console.error('Error reading paragraph:', error);
            showError(error.message);
            stopReading();
        }
    } else {
        console.log('No more paragraphs to read');
        finishReading();
    }
}


function stopReading() {
    console.log('Stopping reading');
    responsiveVoice.cancel();
    isPlaying = false;
    isTTSPlaying = false;
    unhighlightAll();
    updateUI('paused');
}


function finishReading() {
    console.log('Finishing reading');
    isPlaying = false;
    isTTSPlaying = false;
    updateProgress(100);
    updateUI('finished');
    unhighlightAll();
}


function highlightParagraph(index) {
    if (paragraphs[index]) {
        paragraphs[index].element.classList.add('current');
        scrollToParagraph(paragraphs[index].element);
    }
}


function unhighlightParagraph(index) {
    if (paragraphs[index]) {
        paragraphs[index].element.classList.remove('current');
    }
}


function unhighlightAll() {
    paragraphs.forEach(p => p.element.classList.remove('current'));
}

function scrollToParagraph(element) {
    element.scrollIntoView({
        behavior: 'smooth',
        block: 'center'
    });
}


function updateUI(state) {
    const button = document.getElementById('playButton');
    if (button) {
        button.innerHTML = isPlaying ? 
            `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <rect x="6" y="4" width="4" height="16"></rect>
                <rect x="14" y="4" width="4" height="16"></rect>
            </svg>
            <span>Tạm dừng</span>` :
            `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
            <span>Đọc bài viết</span>`;
    }
    updateStatus(state);
}

// Update status
function updateStatus(state) {
    const status = document.getElementById('status');
    const statusText = document.getElementById('statusText');
    if (status && statusText) {
        status.className = 'status active ' + state;
        statusText.textContent = typeof state === 'string' ? state : 
            state === 'reading' ? 'Đang đọc...' :
            state === 'paused' ? 'Đã tạm dừng' :
            state === 'finished' ? 'Đã đọc xong' : '';
    }
}


function updateProgress(percent) {
    const progress = document.getElementById('progress');
    if (progress) {
        progress.style.width = percent + '%';
    }
}


function handleVoiceChange() {
    if (isPlaying) {
        restartReading();
    }
}


function handleRateChange() {
    if (isPlaying) {
        restartReading();
    }
}


function restartReading() {
    stopReading();
    startReading();
}


function showError(message) {
    console.error(message);
    const statusText = document.getElementById('statusText');
    const status = document.getElementById('status');
    if (statusText && status) {
        statusText.textContent = message;
        status.className = 'status active error';
    }
}


function updateParentHeight() {
    const height = document.documentElement.scrollHeight;
    window.parent.postMessage({ height: height }, '*');
}


function shareOnFacebook() {
    const url = window.location.href;
    window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(url));
}

function shareOnTwitter() {
    const url = window.location.href;
    const title = document.title;
    window.open('https://twitter.com/intent/tweet?url=' + encodeURIComponent(url) + '&text=' + encodeURIComponent(title));
}
</script>
</body>
</html>