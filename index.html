<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phòng Khám FMC - Friend Medical Clinic</title>
    <meta name="description" content="Phòng khám đa khoa FMC - Dịch vụ y tế chất lượng cao.">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">

    <style>
        /* --- 1. CẤU HÌNH CƠ BẢN --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Arial, sans-serif; scroll-behavior: smooth; }
        
        body { 
            /* Banner mới dùng position: fixed nên vẫn cần đẩy nội dung xuống */
            padding-top: 70px; 
            background-color: #f9f9f9; 
        }

        .section-slot { min-height: 100px; }

        /* --- 2. XỬ LÝ XUNG ĐỘT HEADER (QUAN TRỌNG) --- */
        /* Ẩn hoàn toàn header con nằm trong news.html */
        #news-slot .fmc-header-wrapper,
        #news-slot .fmc-header,
        #news-slot header {
            display: none !important;
        }
        /* Reset khoảng trống nếu news.html có padding thừa */
        #news-slot { margin-top: 0 !important; padding-top: 0 !important; }

        /* --- 3. CHAT WIDGET STYLES --- */
        #chat-widget-fixed {
            position: fixed; bottom: 90px; right: 20px;
            width: 350px; height: 450px; border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.2); z-index: 9990;
            background: white; display: none; border: 1px solid #ddd; overflow: hidden;
        }
        #chat-widget-fixed.active { display: block; }
        #chat-widget-fixed iframe { width: 100%; height: 100%; border: none; }

        .chat-toggle-btn {
            position: fixed; bottom: 20px; right: 20px;
            width: 60px; height: 60px; border-radius: 50%;
            background: #0084ff; color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; z-index: 9998; transition: transform 0.3s;
        }
        
        @media (max-width: 480px) {
            #chat-widget-fixed { width: 90vw; height: 80vh; bottom: 10px; right: 5vw; }
        }
    </style>
</head>
<body>

    <div id="header-slot"></div>

    <div id="hero-slot" class="section-slot"></div>
    <div id="specialist-slot" class="section-slot"></div>
    <div id="news-slot" class="section-slot"></div>
    <div id="contact-slot" class="section-slot"></div>
    
    <div id="chat-widget-fixed">
        <iframe src="https://fmcchatbot.vercel.app/" title="FMC Chatbot" loading="lazy"></iframe>
    </div>
    <div class="chat-toggle-btn" onclick="toggleChatWidget()">
        <i class="fab fa-facebook-messenger"></i>
    </div>
    <div class="zalo-chat-widget" data-oaid="1720397530862692001" data-welcome-message="Chào bạn! Chúng tôi có thể giúp gì cho bạn?" data-autopopup="0" data-width="" data-height="" style="z-index: 999999;"></div>
    <script src="https://sp.zalo.me/plugins/sdk.js"></script>

<script>
    // --- HÀM LOAD COMPONENT ---
    async function loadComponent(slotId, filePath) {
        try {
            const response = await fetch(filePath);
            if (!response.ok) throw new Error(`Lỗi tải ${filePath}`);
            const html = await response.text();
            
            const slot = document.getElementById(slotId);
            if (slot) {
                slot.innerHTML = html;

                // Kích hoạt thẻ <script> bên trong component (để banner.html chạy được logic của nó)
                const scripts = slot.querySelectorAll("script");
                scripts.forEach(oldScript => {
                    const newScript = document.createElement("script");
                    Array.from(oldScript.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value));
                    newScript.appendChild(document.createTextNode(oldScript.innerHTML));
                    oldScript.parentNode.replaceChild(newScript, oldScript);
                });
            }
        } catch (error) {
            console.error(error);
        }
    }

    // --- XỬ LÝ CUỘN TRANG MƯỢT ---
    function smoothScroll(id) {
        const element = document.getElementById(id);
        if(element) {
            const headerOffset = 80; 
            const elementPosition = element.getBoundingClientRect().top;
            const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
            window.scrollTo({ top: offsetPosition, behavior: "smooth" });
        }
    }

    function checkAndScrollToHash() {
        const hash = window.location.hash; 
        if (hash) {
            const id = hash.replace('#', '');
            // Đợi một chút để nội dung load xong rồi mới cuộn
            setTimeout(() => {
                smoothScroll(id);
            }, 600); 
        }
    }

    // --- KHỞI CHẠY ---
    document.addEventListener("DOMContentLoaded", async () => {
        // Load Banner đầu tiên và quan trọng nhất
        await loadComponent('header-slot', 'banner.html');

        // Load các phần còn lại song song
        await Promise.all([
            loadComponent('hero-slot', 'hero/hero.html'),
            loadComponent('specialist-slot', 'specialist/specialist.html'),
            loadComponent('news-slot', 'news/news.html'),
            loadComponent('contact-slot', 'contact/contact.html')
        ]);

        // Kiểm tra cuộn trang
        checkAndScrollToHash();
    });

    // Toggle Chat
    window.toggleChatWidget = function() {
        const widget = document.getElementById('chat-widget-fixed');
        if (widget) {
            widget.classList.toggle('active');
        }
    };
</script>

</body>
</html>