<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phòng Khám FMC - Friend Medical Clinic</title>
    <meta name="description" content="Phòng khám đa khoa FMC - Dịch vụ y tế chất lượng cao, đội ngũ bác sĩ từ Từ Dũ, FV. Chuyên khoa Sản, Tai Mũi Họng, Nội khoa.">
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">

    <style>
        /* Reset CSS cơ bản và Style chung */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Arial, sans-serif; scroll-behavior: smooth; }
        body { padding-top: 70px; background-color: #f9f9f9; }

        /* --- HEADER STYLES --- */
        .header {
            height: 70px; background-color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: fixed; top: 0; left: 0; right: 0; z-index: 1000;
            transition: transform 0.3s ease-in-out;
        }
        .header.hidden-header { transform: translateY(-100%); }
        .header-container { max-width: 1400px; margin: 0 auto; height: 100%; display: flex; align-items: center; padding: 0 20px; position: relative; }

        /* Logo */
        .logo-link { height: 50px; flex-shrink: 0; margin-right: 20px; cursor: pointer; display: block; transition: transform 0.3s ease; }
        .logo-link:hover { transform: scale(1.05); }
        .logo-link img { height: 100%; width: auto; }

        /* Navigation */
        .main-nav { display: flex; list-style: none; gap: 20px; margin-right: 30px; }
        .main-nav a { text-decoration: none; color: #333; font-size: 15px; font-weight: 600; display: flex; align-items: center; gap: 8px; padding: 8px 12px; border-radius: 6px; transition: all 0.3s; }
        .main-nav a:hover, .main-nav a.active { color: #007bff; background: rgba(0, 123, 255, 0.1); }
        .main-nav svg { width: 18px; height: 18px; }

        /* Status & Contact */
        .status-container { display: flex; align-items: center; gap: 20px; margin-left: auto; margin-right: 20px; }
        #openStatus { font-size: 14px; font-weight: 500; display: flex; align-items: center; gap: 6px; }
        .contact-group { text-decoration: none; color: #007bff; font-weight: 600; display: flex; align-items: center; gap: 6px; }

        /* Button */
        .appointment-btn { background: #007bff; color: white; padding: 10px 20px; border-radius: 30px; font-weight: 600; font-size: 14px; display: flex; align-items: center; gap: 8px; border: none; cursor: pointer; transition: transform 0.2s; box-shadow: 0 4px 6px rgba(0, 123, 255, 0.2); }
        .appointment-btn:hover { background: #0056b3; transform: translateY(-2px); box-shadow: 0 6px 8px rgba(0, 123, 255, 0.3); }

        /* Progress Bar */
        .progress-container { position: absolute; bottom: 0; left: 0; width: 100%; height: 3px; background: transparent; }
        .progress-bar { height: 3px; background: #007bff; width: 0%; transition: width 0.1s; box-shadow: 0 0 10px #007bff; }

        /* Component Slots */
        .section-slot { min-height: 100px; }
        
        /* --- CHAT WIDGET FIX (Floating Iframe) --- */
        #chat-widget-fixed {
            position: fixed;
            bottom: 90px; /* Vị trí nổi, cao hơn Zalo */
            right: 20px;
            width: 350px;
            height: 450px;
            border: 1px solid #ddd;
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.2);
            z-index: 9990; /* Dưới Zalo (999999) nhưng trên nội dung chính */
            overflow: hidden;
            background: white;
            display: none; /* Mặc định ẩn */
        }
        #chat-widget-fixed.active {
            display: block;
        }
        #chat-widget-fixed iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Nút mở Chat */
        .chat-toggle-btn {
            position: fixed;
            bottom: 20px; /* Đặt dưới cùng, tránh Zalo */
            right: 20px;
            width: 60px; height: 60px; border-radius: 50%;
            background: #0084ff; color: white; box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; z-index: 9998; transition: transform 0.3s;
        }

        /* Responsive Chat Widget */
        @media (max-width: 480px) {
            #chat-widget-fixed {
                width: 90vw; height: 80vh;
                bottom: 10px; right: 5vw;
            }
        }
    </style>
</head>
<body>



    <div id="hero-slot" class="section-slot"></div>
    <div id="specialist-slot" class="section-slot"></div>
    <div id="news-slot" class="section-slot"></div>
    <div id="contact-slot" class="section-slot"></div>
    
    <div id="chat-widget-fixed">
        <iframe src="https://fmcchatbot.vercel.app/" title="FMC Chatbot" loading="lazy"></iframe>
    </div>
    
    <div class="chat-toggle-btn" onclick="toggleChatWidget()">
        <i class="fab fa-facebook-messenger"></i>
    </div>


<script>
    // 1. CƠ CHẾ LOAD COMPONENT (Giữ nguyên)
    async function loadComponent(slotId, filePath) {
        try {
            const response = await fetch(filePath);
            if (!response.ok) throw new Error(`Lỗi tải ${filePath}`);
            const html = await response.text();
            
            const slot = document.getElementById(slotId);
            if (slot) {
                slot.innerHTML = html;

                // Kích hoạt lại thẻ <script> bên trong component (nếu có)
                const scripts = slot.querySelectorAll("script");
                scripts.forEach(oldScript => {
                    const newScript = document.createElement("script");
                    Array.from(oldScript.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value));
                    newScript.appendChild(document.createTextNode(oldScript.innerHTML));
                    oldScript.parentNode.replaceChild(newScript, oldScript);
                });
            }
        } catch (error) {
            console.error(error);
        }
    }

    // 2. CHƯƠNG TRÌNH CHÍNH (Đợi load xong mới chạy tiếp)
    document.addEventListener("DOMContentLoaded", async () => {
        // A. Tải song song tất cả các thành phần và ĐỢI cho đến khi xong hết
        await Promise.all([
            loadComponent('hero-slot', 'hero/hero.html'),
            loadComponent('specialist-slot', 'specialist/specialist.html'),
            loadComponent('news-slot', 'news/news.html'),
            loadComponent('contact-slot', 'contact/contact.html')
        ]);
        
        // B. Sau khi giao diện đã đầy đủ, mới kích hoạt các tính năng phụ
        updateOpenStatus();
        setInterval(updateOpenStatus, 60000);

        // C. QUAN TRỌNG: Kiểm tra và cuộn đến mục tương ứng (nếu có hash trên URL)
        checkAndScrollToHash();
    });

    // 3. HÀM XỬ LÝ CUỘN THÔNG MINH
    function checkAndScrollToHash() {
        // Lấy phần sau dấu # (ví dụ: #news-slot)
        const hash = window.location.hash; 
        
        if (hash) {
            const id = hash.replace('#', '');
            // Thêm delay nhỏ 100ms để trình duyệt kịp vẽ lại layout sau khi chèn HTML
            setTimeout(() => {
                smoothScroll(id);
            }, 100);
        }
    }

    // 4. HÀM CUỘN MƯỢT (Có trừ hao chiều cao Banner)
    function smoothScroll(id) {
        const element = document.getElementById(id);
        if(element) {
            // Chiều cao banner khoảng 70px, ta trừ hao 80px cho thoáng
            const headerOffset = 80; 
            const elementPosition = element.getBoundingClientRect().top;
            const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
            
            window.scrollTo({ 
                top: offsetPosition, 
                behavior: "smooth" 
            });
        }
    }

    // 5. CẬP NHẬT TRẠNG THÁI MỞ CỬA (Logic cũ)
    function updateOpenStatus() {
        // Lưu ý: Banner mới (banner.html) có logic update riêng của nó.
        // Hàm này chỉ giữ lại nếu bạn còn dùng phần hiển thị cũ ở đâu đó trong body,
        // nếu không, banner.html sẽ tự lo phần hiển thị trên thanh menu.
        const now = new Date();
        const day = now.getDay();
        const hour = now.getHours();
        
        // Cập nhật cho các phần tử cũ (nếu còn sót lại trong các slot)
        const statusDiv = document.getElementById('openStatus');
        if(statusDiv) {
            const icon = statusDiv.querySelector('i');
            const text = statusDiv.querySelector('span');
            let isOpen = (day === 0) ? (hour >= 8 && hour < 12) : (hour >= 8 && hour < 20);
            
            text.textContent = isOpen ? 'Đang mở cửa' : 'Đang đóng cửa';
            const color = isOpen ? '#28a745' : '#dc3545';
            text.style.color = color;
            if(icon) icon.style.color = color;
        }
    }
    
    // 6. LOGIC CHAT WIDGET (Giữ nguyên)
    window.toggleChatWidget = function() {
        const widget = document.getElementById('chat-widget-fixed');
        if (widget) {
            widget.classList.toggle('active');
        }
    };
</script>

<div class="zalo-chat-widget" data-oaid="1720397530862692001" data-welcome-message="Chào bạn! Chúng tôi có thể giúp gì cho bạn?" data-autopopup="0" data-width="" data-height="" style="z-index: 999999;"></div>
<script src="https://sp.zalo.me/plugins/sdk.js"></script>

</body>
</html>