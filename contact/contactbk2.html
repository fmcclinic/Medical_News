<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Section</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        .info-card {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }
        
        .info-card.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .form-loading {
            opacity: 0.7;
            pointer-events: none;
        }
        
        .success-message {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .loading-spinner {
            display: none;
        }

        .form-loading .loading-spinner {
            display: inline-block;
        }

        .spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
<section id="contact" class="contact-section py-16 bg-gray-50">
    <div class="container mx-auto px-4">
        <h2 class="text-3xl font-bold text-center mb-12">Liên Hệ</h2>
        <div class="grid md:grid-cols-2 gap-8">
            <!-- Contact Info -->
            <div class="space-y-8">
                <!-- Map -->
                <div class="bg-white rounded-lg shadow-lg overflow-hidden info-card">
                    <div class="h-[400px] relative">
                        <iframe 
                            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3918.7052888840663!2d106.78950631744384!3d10.844726792271046!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31752738a7dc0465%3A0xa6cf8ac82a3141e0!2zUGjDsm5nIEtow6FtIEZNQyAvIEZNQyBDbGluaWM!5e0!3m2!1svi!2s!4v1650000000000!5m2!1svi!2s"
                            width="100%" 
                            height="100%" 
                            style="border:0;" 
                            allowfullscreen="" 
                            loading="lazy"
                            aria-label="Bản đồ địa chỉ phòng khám">
                        </iframe>
                    </div>
                </div>

                <!-- Contact Details -->
                <div class="bg-white rounded-lg shadow-lg p-6 space-y-6 info-card">
                    <h3 class="text-xl font-semibold mb-4">Thông Tin Liên Hệ</h3>
                    
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-map-marker-alt text-blue-600 text-xl" aria-hidden="true"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold">Địa chỉ</h4>
                            <p class="text-gray-600">A12 Saigon Villas Hill, 99 Lê Văn Việt, Thành phố Thủ Đức, TP.HCM 700000</p>
                        </div>
                    </div>

                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-phone-alt text-blue-600 text-xl" aria-hidden="true"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold">Điện thoại</h4>
                            <p class="text-gray-600">028 3535 5353</p>
                        </div>
                    </div>

                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                            <i class="far fa-clock text-blue-600 text-xl" aria-hidden="true"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold">Giờ làm việc</h4>
                            <p class="text-gray-600">Thứ 2 - Thứ 7: 8:00 - 20:00</p>
                            <p class="text-gray-600">Chủ nhật: 8:00 - 12:00</p>
                        </div>
                    </div>

                    <!-- Social Links -->
                    <div class="pt-4 border-t">
                        <div class="flex space-x-4">
                            <a href="#" class="w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center hover:bg-blue-700 transition-colors" aria-label="Facebook">
                                <i class="fab fa-facebook-f" aria-hidden="true"></i>
                            </a>
                            <a href="#" class="w-10 h-10 bg-red-600 text-white rounded-full flex items-center justify-center hover:bg-red-700 transition-colors" aria-label="Youtube">
                                <i class="fab fa-youtube" aria-hidden="true"></i>
                            </a>
                            <a href="#" class="w-10 h-10 bg-pink-600 text-white rounded-full flex items-center justify-center hover:bg-pink-700 transition-colors" aria-label="Instagram">
                                <i class="fab fa-instagram" aria-hidden="true"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contact Form -->
            <div class="bg-white rounded-lg shadow-lg p-8 info-card">
                <h3 class="text-xl font-semibold mb-6">Đặt Lịch Khám</h3>
                
                <!-- The form -->
                <form name="submit-to-google-sheet" class="space-y-6">
                    <input type="hidden" name="timestamp" id="timestamp">
                    <input type="hidden" name="status" value="Chờ xác nhận">

                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700 mb-2">Họ và tên</label>
                            <input type="text" id="name" name="name" required
                                   class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
                        </div>
                        <div>
                            <label for="phone" class="block text-sm font-medium text-gray-700 mb-2">Số điện thoại</label>
                            <input type="tel" id="phone" name="phone" required
                                   class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
                        </div>
                    </div>

                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="email" name="email"
                               class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
                    </div>

                    <div>
                        <label for="department" class="block text-sm font-medium text-gray-700 mb-2">Chọn chuyên khoa</label>
                        <select id="department" name="department" required
                                class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">-- Chọn chuyên khoa --</option>
                            <option value="Sản phụ khoa">Sản phụ khoa</option>
                            <option value="Tai Mũi Họng">Tai Mũi Họng</option>
                            <option value="Nội khoa">Nội khoa</option>
                        </select>
                        <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
                    </div>

                    <div>
                        <label for="date" class="block text-sm font-medium text-gray-700 mb-2">Ngày khám</label>
                        <input type="date" id="date" name="date" required
                               class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
                    </div>

                    <div>
                        <label for="note" class="block text-sm font-medium text-gray-700 mb-2">Ghi chú</label>
                        <textarea id="note" name="note" rows="4"
                                  class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                    </div>

                    <button type="submit" 
                            class="w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center space-x-2">
                        <i class="fas fa-calendar-check"></i>
                        <span class="loading-spinner">
                            <i class="fas fa-spinner spinner"></i>
                        </span>
                        <span>Đặt lịch ngay</span>
                    </button>
                </form>
            </div>
        </div>
    </div>
</section>

<script>
const scriptURL = 'https://script.google.com/macros/s/AKfycbyl1EKKb-fgifin1MsoxTmgolq150ljzODiOLnRyF0JMd0Px33eiH2WKguwVZHjHngk/exec';
const form = document.forms['submit-to-google-sheet'];

// Validate individual field
function validateField(input) {
    const value = input.value.trim();
    // Tìm error div dựa trên data attribute thay vì nextElementSibling
    const errorDiv = input.parentElement.querySelector('.error-message');
    if (!errorDiv) return true; // Nếu không có error div thì coi như valid

    let isValid = true;
    let errorMessage = '';

    switch(input.name) {
        case 'name':
            if (value.length < 2) {
                isValid = false;
                errorMessage = 'Vui lòng nhập họ tên đầy đủ';
            }
            break;
            
        case 'phone':
            const phoneRegex = /(84|0[3|5|7|8|9])+([0-9]{8})\b/;
            if (!phoneRegex.test(value)) {
                isValid = false;
                errorMessage = 'Số điện thoại không hợp lệ';
            }
            break;
            
        case 'email':
            if (value) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(value)) {
                    isValid = false;
                    errorMessage = 'Email không hợp lệ';
                }
            }
            break;
            
        case 'department':
            if (!value) {
                isValid = false;
                errorMessage = 'Vui lòng chọn chuyên khoa';
            }
            break;
            
        case 'date':
            if (!value) {
                isValid = false;
                errorMessage = 'Vui lòng chọn ngày khám';
            }
            break;
    }

    if (!isValid) {
        errorDiv.textContent = errorMessage;
        errorDiv.classList.remove('hidden');
        input.classList.add('border-red-500');
    } else {
        errorDiv.classList.add('hidden');
        input.classList.remove('border-red-500');
    }

    return isValid;
}

// Set up date restrictions
function setupDateRestrictions() {
    const dateInput = document.getElementById('date');
    if (dateInput) {
        const today = new Date();
        const maxDate = new Date();
        maxDate.setMonth(maxDate.getMonth() + 1);

        dateInput.min = today.toISOString().split('T')[0];
        dateInput.max = maxDate.toISOString().split('T')[0];
    }
}

// Show success message
function showSuccessMessage() {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'success-message fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
    messageDiv.innerHTML = `
        <div class="flex items-center">
            <i class="fas fa-check-circle mr-2"></i>
            <span>Đặt lịch thành công! Chúng tôi sẽ liên hệ sớm.</span>
        </div>
    `;
    document.body.appendChild(messageDiv);

    setTimeout(() => {
        messageDiv.remove();
    }, 5000);
}

// Show error message
function showErrorMessage(message) {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
    messageDiv.innerHTML = `
        <div class="flex items-center">
            <i class="fas fa-exclamation-circle mr-2"></i>
            <span>${message}</span>
        </div>
    `;
    document.body.appendChild(messageDiv);

    setTimeout(() => {
        messageDiv.remove();
    }, 5000);
}

// Initialize form
document.addEventListener('DOMContentLoaded', function() {
    // Set up form validation
    const inputs = form.querySelectorAll('input, select, textarea');
    inputs.forEach(input => {
        if (input.type !== 'hidden') {
            input.addEventListener('blur', (e) => validateField(e.target));
            input.addEventListener('input', (e) => validateField(e.target));
        }
    });

    // Set up date restrictions
    setupDateRestrictions();

    // Handle form submission
    form.addEventListener('submit', e => {
        e.preventDefault();

        // Validate all fields
        let isValid = true;
        inputs.forEach(input => {
            if (input.type !== 'hidden' && !validateField(input)) {
                isValid = false;
            }
        });

        if (!isValid) return;

        // Show loading state
        form.classList.add('form-loading');
        const submitButton = form.querySelector('button[type="submit"]');
        submitButton.disabled = true;

        // Prepare form data
        const formData = new FormData(form);
        formData.append('timestamp', new Date().toISOString());
        formData.append('status', 'Chờ xác nhận');

        // Submit form using fetch with no-cors mode
        fetch(scriptURL, { method: 'POST', body: formData, mode: 'no-cors' })
            .then(() => {
                showSuccessMessage();
                form.reset();
                setupDateRestrictions(); // Reset date restrictions after form reset
            })
            .catch(error => {
                console.error('Error!', error.message);
                showErrorMessage('Có lỗi xảy ra. Vui lòng thử lại sau.');
            })
            .finally(() => {
                form.classList.remove('form-loading');
                submitButton.disabled = false;
            });
    });

    // Set up animations
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('show');
                observer.unobserve(entry.target);
            }
        });
    }, { threshold: 0.2 });

    document.querySelectorAll('.info-card').forEach(card => {
        observer.observe(card);
    });
});

//============================================

// Thêm đoạn code này vào cuối file contact.html, trong thẻ script
document.addEventListener('DOMContentLoaded', function() {
    // Hàm gửi chiều cao lên parent
    function sendHeight() {
        const height = document.body.scrollHeight;
        window.parent.postMessage({ height }, '*');
    }

    // Gửi chiều cao ban đầu
    sendHeight();

    // Theo dõi thay đổi kích thước của nội dung
    const resizeObserver = new ResizeObserver(sendHeight);
    resizeObserver.observe(document.body);

    // Thêm listener cho các sự kiện có thể thay đổi chiều cao
    window.addEventListener('resize', sendHeight);
    document.querySelectorAll('.info-card').forEach(card => {
        card.addEventListener('transitionend', sendHeight);
    });
});





</script>

</body>
</html>