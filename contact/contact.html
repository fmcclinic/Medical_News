<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Section</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        .info-card {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }
        
        .info-card.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .form-loading {
            opacity: 0.7;
            pointer-events: none;
        }
        
        .success-message {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .loading-spinner {
            display: none;
        }

        .form-loading .loading-spinner {
            display: inline-block;
        }

        .spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Modal styles */
        /* CSS cho modal */
.modal {
    position: fixed;
    bottom: 0; /* Thay đổi từ top: 0 thành bottom: 0 */
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    display: none;
}

.modal.show {
    display: flex;
    align-items: flex-end; /* Căn xuống dưới */
    animation: fadeIn 0.3s ease-out;
}

.modal-content {
    background: white;
    border-radius: 1rem 1rem 0 0; /* Bo góc trên */
    padding: 2rem;
    width: 100%; /* Chiếm full width */
    max-height: 90vh;
    overflow-y: auto;
    margin: 0 auto; /* Căn giữa */
    animation: slideUp 0.3s ease-out;
}

/* Animation mới cho modal */
@keyframes slideUp {
    from {
        transform: translateY(100%);
    }
    to {
        transform: translateY(0);
    }
}

        /* Time slot styles */
        .time-slot {
            transition: all 0.2s ease;
            padding: 0.5rem;
            border-radius: 0.375rem;
            border: 1px solid #e5e7eb;
            text-align: center;
            cursor: pointer;
        }

        .time-slot:hover:not(.disabled) {
            background-color: #EBF5FF;
            border-color: #3B82F6;
        }

        .time-slot.selected {
            background-color: #3B82F6;
            color: white;
            border-color: #2563EB;
        }

        .time-slot.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background-color: #F3F4F6;
        }

        .time-slots-container {
            transition: all 0.3s ease;
        }

        .time-slots-section {
            margin-bottom: 1.5rem;
            padding: 1rem;
            border-radius: 0.5rem;
            background-color: #F9FAFB;
        }



/* Responsive adjustments */
@media (max-width: 640px) {
    .modal-content {
        padding: 1.5rem;
    }
}

@media (min-width: 641px) {
    .modal-content {
        max-width: 600px; /* Giới hạn độ rộng trên desktop */
        border-radius: 1rem 1rem 0 0;
    }
}


    </style>
</head>
<body>
<section id="contact" class="contact-section py-16 bg-gray-50">
    <div class="container mx-auto px-4">
        <h2 class="text-3xl font-bold text-center mb-12">Liên Hệ</h2>
        <div class="grid md:grid-cols-2 gap-8">
            <div class="space-y-8">
                <div class="bg-white rounded-lg shadow-lg overflow-hidden info-card">
                    <div class="h-[400px] relative">
                        <iframe 
                            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3918.7052888840663!2d106.78950631744384!3d10.844726792271046!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31752738a7dc0465%3A0xa6cf8ac82a3141e0!2zUGjDsm5nIEtow6FtIEZNQyAvIEZNQyBDbGluaWM!5e0!3m2!1svi!2s!4v1650000000000!5m2!1svi!2s"
                            width="100%" 
                            height="100%" 
                            style="border:0;" 
                            allowfullscreen="" 
                            loading="lazy"
                            aria-label="Bản đồ địa chỉ phòng khám">
                        </iframe>
                    </div>
                </div>

                <div class="bg-white rounded-lg shadow-lg p-6 space-y-6 info-card">
                    <h3 class="text-xl font-semibold mb-4">Thông Tin Liên Hệ</h3>
                    
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-map-marker-alt text-blue-600 text-xl"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold">Địa chỉ</h4>
                            <p class="text-gray-600">A12 Saigon Villas Hill, 99 Lê Văn Việt, Thành phố Thủ Đức, TP.HCM 700000</p>
                        </div>
                    </div>

                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-phone-alt text-blue-600 text-xl"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold">Điện thoại</h4>
                            <p class="text-gray-600">028 3535 5353</p>
                        </div>
                    </div>

                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                            <i class="far fa-clock text-blue-600 text-xl"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold">Giờ làm việc</h4>
                            <p class="text-gray-600">Thứ 2 - Thứ 7: 8:00 - 20:00</p>
                            <p class="text-gray-600">Chủ nhật: 8:00 - 12:00</p>
                        </div>
                    </div>

                    <div class="pt-4 border-t">
                        <div class="flex space-x-4">
                            <a href="tel:0939148630" class="w-10 h-10 bg-green-500 text-white rounded-full flex items-center justify-center hover:bg-green-600 transition-colors">
                                <i class="fas fa-comment-dots"></i>
                            </a>
                            <a href="#" class="w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center hover:bg-blue-700 transition-colors">
                                <i class="fab fa-facebook-f"></i>
                            </a>
                            <a href="#" class="w-10 h-10 bg-red-600 text-white rounded-full flex items-center justify-center hover:bg-red-700 transition-colors">
                                <i class="fab fa-youtube"></i>
                            </a>
                            <a href="#" class="w-10 h-10 bg-pink-600 text-white rounded-full flex items-center justify-center hover:bg-pink-700 transition-colors">
                                <i class="fab fa-instagram"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-8 info-card">
                <h3 class="text-xl font-semibold mb-6">Đặt Lịch Khám</h3>
                
                <form name="submit-to-google-sheet" class="space-y-6">
                    <input type="hidden" name="timestamp" id="timestamp">
                    <input type="hidden" name="status" value="Chờ xác nhận">
                    <input type="hidden" name="selected_time" id="selected_time">

                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700 mb-2">Họ và tên</label>
                            <input type="text" id="name" name="name" required
                                   class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
                        </div>
                        <div>
                            <label for="phone" class="block text-sm font-medium text-gray-700 mb-2">Số điện thoại</label>
                            <input type="tel" id="phone" name="phone" required
                                   class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
                        </div>
                    </div>

                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="email" name="email"
                               class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
                    </div>

                    <div>
                        <label for="department" class="block text-sm font-medium text-gray-700 mb-2">Chọn chuyên khoa</label>
                        <select id="department" name="department" required
                                class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">-- Chọn chuyên khoa --</option>
                            <option value="Sản phụ khoa">Sản phụ khoa</option>
                            <option value="Tai Mũi Họng">Tai Mũi Họng</option>
                            <option value="Nội khoa">Nội khoa</option>
                        </select>
                        <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
                    </div>

                    <div>
                        <label for="date" class="block text-sm font-medium text-gray-700 mb-2">Ngày khám</label>
                        <input type="date" id="date" name="date" required
                               class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <div class="error-message text-red-500 text-sm mt-1 hidden"></div>
                    </div>

                    <div class="time-slots-container hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Chọn giờ khám</label>
                        
                        <div class="time-slots-section">
                            <h4 class="text-sm font-medium text-gray-600 mb-2">Buổi sáng (8:00 - 12:00)</h4>
                            <div class="grid grid-cols-4 gap-2" id="morning-slots"></div>
                        </div>

                        <div class="time-slots-section">
                            <h4 class="text-sm font-medium text-gray-600 mb-2">Buổi chiều (13:00 - 17:00)</h4>
                            <div class="grid grid-cols-4 gap-2" id="afternoon-slots"></div>
                        </div>

                        <div class="time-slots-section" id="evening-section">
                            <h4 class="text-sm font-medium text-gray-600 mb-2">Buổi tối (17:00 - 20:00)</h4>
                            <div class="grid grid-cols-4 gap-2" id="evening-slots"></div>
                        </div>
                    </div>

                    <div>
                        <label for="note" class="block text-sm font-medium text-gray-700 mb-2">Ghi chú</label>
                        <textarea id="note" name="note" rows="4"
                                  class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                    </div>

                    <button type="button" id="review-button"
                            class="w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center space-x-2">
                        <i class="fas fa-eye mr-2"></i>
                        <span>Xem lại thông tin</span>
                    </button>
                </form>
            </div>
        </div>
    </div>
</section>

<div id="review-modal" class="modal" role="dialog" aria-modal="true">
    <div class="modal-content">
        <h3 class="text-xl font-semibold mb-6">Xác nhận thông tin đặt lịch</h3>
        <div id="review-content" class="space-y-4">
            </div>
        
        <div class="mt-6">
            <label class="flex items-center space-x-2">
                <input type="checkbox" id="confirm-checkbox" class="form-checkbox">
                <span class="text-sm">Tôi xác nhận thông tin trên là chính xác</span>
            </label>
        </div>

        <div class="mt-6 flex space-x-4">
            <button type="button" id="submit-button" disabled
                    class="flex-1 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                <i class="fas fa-paper-plane mr-2"></i>
                <span>Xác nhận gửi</span>
                <span class="loading-spinner hidden">
                    <i class="fas fa-spinner spinner"></i>
                </span>
            </button>
            <button type="button" id="edit-button"
                    class="flex-1 py-3 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">
                <i class="fas fa-edit mr-2"></i>
                <span>Quay lại chỉnh sửa</span>
            </button>
        </div>
    </div>
</div>

<script>
const scriptURL = 'https://script.google.com/macros/s/AKfycbyJ01a3bzlALRdvYViabspGUfT0OrfmiHZY-9WCJxhX4y2CtsKFCoSUCgE5elF7pMX6/exec';
const form = document.forms['submit-to-google-sheet'];

// Time slots configuration
const TIME_SLOTS = {
    morning: generateTimeSlots("08:00", "12:00", 30),
    afternoon: generateTimeSlots("13:00", "17:00", 30),
    evening: generateTimeSlots("17:00", "20:00", 30)
};

// Generate time slots
function generateTimeSlots(start, end, intervalMinutes) {
    const slots = [];
    const startTime = new Date(`2000/01/01 ${start}`);
    const endTime = new Date(`2000/01/01 ${end}`);
    
    while (startTime < endTime) {
        slots.push(startTime.toLocaleTimeString('vi-VN', {
            hour: '2-digit',
            minute: '2-digit',
            hour12: false
        }));
        startTime.setMinutes(startTime.getMinutes() + intervalMinutes);
    }
    return slots;
}

// Render time slots
function renderTimeSlots() {
    const date = new Date(document.getElementById('date').value);
    const isSunday = date.getDay() === 0;
    const currentDate = new Date();
    
    // Clear previous slots
    document.getElementById('morning-slots').innerHTML = '';
    document.getElementById('afternoon-slots').innerHTML = '';
    document.getElementById('evening-slots').innerHTML = '';
    
    // Show/hide time slots container
    document.querySelector('.time-slots-container').classList.remove('hidden');
    
    // Get current time if it's today
    const isToday = date.toDateString() === currentDate.toDateString();
    const currentTime = isToday ? currentDate.getHours() * 60 + currentDate.getMinutes() : 0;

    // Handle Sunday schedule
    const slots = isSunday ? { morning: TIME_SLOTS.morning } : TIME_SLOTS;
    document.getElementById('evening-section').style.display = isSunday ? 'none' : 'block';
    
    Object.entries(slots).forEach(([period, timeSlots]) => {
        const container = document.getElementById(`${period}-slots`);
        timeSlots.forEach(time => {
            const [hours, minutes] = time.split(':').map(Number);
            const slotTime = hours * 60 + minutes;
            
            const button = document.createElement('button');
            button.type = 'button';
            button.className = 'time-slot';
            button.textContent = time;
            button.dataset.time = time;
            
            const isDisabled = isToday && slotTime <= currentTime;
            if (isDisabled) {
                button.classList.add('disabled');
                button.disabled = true;
            }
            
            button.addEventListener('click', () => selectTimeSlot(button));
            container.appendChild(button);
        });
    });
}

// Select time slot
function selectTimeSlot(button) {
    // Remove previous selection
    document.querySelectorAll('.time-slot.selected').forEach(slot => {
        slot.classList.remove('selected');
    });
    
    // Add selection to clicked button
    button.classList.add('selected');
    document.getElementById('selected_time').value = button.dataset.time;
}

// Validate individual field
function validateField(input) {
    const value = input.value.trim();
    const errorDiv = input.parentElement.querySelector('.error-message');
    if (!errorDiv) return true;

    let isValid = true;
    let errorMessage = '';

    switch(input.name) {
        case 'name':
            if (value.length < 2) {
                isValid = false;
                errorMessage = 'Vui lòng nhập họ tên đầy đủ';
            }
            break;
            
        case 'phone':
            const phoneRegex = /(84|0[3|5|7|8|9])+([0-9]{8})\b/;
            if (!phoneRegex.test(value)) {
                isValid = false;
                errorMessage = 'Số điện thoại không hợp lệ';
            }
            break;
            
        case 'email':
            if (value) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(value)) {
                    isValid = false;
                    errorMessage = 'Email không hợp lệ';
                }
            }
            break;
            
        case 'department':
            if (!value) {
                isValid = false;
                errorMessage = 'Vui lòng chọn chuyên khoa';
            }
            break;
            
        case 'date':
            if (!value) {
                isValid = false;
                errorMessage = 'Vui lòng chọn ngày khám';
            }
            break;
    }

    if (!isValid) {
        errorDiv.textContent = errorMessage;
        errorDiv.classList.remove('hidden');
        input.classList.add('border-red-500');
    } else {
        errorDiv.classList.add('hidden');
        input.classList.remove('border-red-500');
    }

    return isValid;
}

// Set up date restrictions
function setupDateRestrictions() {
    const dateInput = document.getElementById('date');
    if (dateInput) {
        const today = new Date();
        const maxDate = new Date();
        maxDate.setMonth(maxDate.getMonth() + 1);

        dateInput.min = today.toISOString().split('T')[0];
        dateInput.max = maxDate.toISOString().split('T')[0];
    }
}

// Show success message
function showSuccessMessage() {
    const messageDiv = document.createElement('div');
    messageDiv.className = `fixed bottom-4 left-1/2 transform -translate-x-1/2 
                          bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50
                          w-[90%] max-w-md mx-auto text-center success-message`;
    messageDiv.innerHTML = `
        <div class="flex items-center justify-center">
            <i class="fas fa-check-circle mr-2"></i>
            <span>Đặt lịch thành công! Chúng tôi sẽ liên hệ sớm.</span>
        </div>
    `;
    document.body.appendChild(messageDiv);

    // Animation cho thông báo
    messageDiv.style.animation = 'slideInBottom 0.3s ease-out';

    setTimeout(() => {
        messageDiv.style.animation = 'slideOutBottom 0.3s ease-out';
        setTimeout(() => messageDiv.remove(), 300);
    }, 5000);
}

// Thêm CSS animation cho thông báo
const style = document.createElement('style');
style.textContent = `
    @keyframes slideInBottom {
        from {
            transform: translate(-50%, 100%);
            opacity: 0;
        }
        to {
            transform: translate(-50%, 0);
            opacity: 1;
        }
    }

    @keyframes slideOutBottom {
        from {
            transform: translate(-50%, 0);
            opacity: 1;
        }
        to {
            transform: translate(-50%, 100%);
            opacity: 0;
        }
    }
`;
document.head.appendChild(style);

// Show error message
function showErrorMessage(message) {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
    messageDiv.innerHTML = `
        <div class="flex items-center">
            <i class="fas fa-exclamation-circle mr-2"></i>
            <span>${message}</span>
        </div>
    `;
    document.body.appendChild(messageDiv);

    setTimeout(() => {
        messageDiv.remove();
    }, 5000);
}

// Handle review modal
function showReviewModal() {
    const modal = document.getElementById('review-modal');
    const content = document.getElementById('review-content');
    const time = document.getElementById('selected_time').value;
    
    if (!time) {
        showErrorMessage('Vui lòng chọn giờ khám');
        return;
    }

    // Validate all fields before showing modal
    let isValid = true;
    form.querySelectorAll('input, select').forEach(input => {
        if (input.type !== 'hidden' && !validateField(input)) {
            isValid = false;
        }
    });

    if (!isValid) return;

    // Format the review content
    content.innerHTML = `
        <div class="grid grid-cols-2 gap-4">
            <div>
                <p class="font-medium">Họ và tên:</p>
                <p class="text-gray-600">${form.name.value}</p>
            </div>
            <div>
                <p class="font-medium">Số điện thoại:</p>
                <p class="text-gray-600">${form.phone.value}</p>
            </div>
            <div>
                <p class="font-medium">Email:</p>
                <p class="text-gray-600">${form.email.value || 'Không có'}</p>
            </div>
            <div>
                <p class="font-medium">Chuyên khoa:</p>
                <p class="text-gray-600">${form.department.value}</p>
            </div>
            <div>
                <p class="font-medium">Ngày khám:</p>
                <p class="text-gray-600">${new Date(form.date.value).toLocaleDateString('vi-VN')}</p>
            </div>
            <div>
                <p class="font-medium">Giờ khám:</p>
                <p class="text-gray-600">${time}</p>
            </div>
        </div>
        ${form.note.value ? `
            <div class="mt-4">
                <p class="font-medium">Ghi chú:</p>
                <p class="text-gray-600">${form.note.value}</p>
            </div>
        ` : ''}
    `;

    modal.classList.add('show');
}

// Initialize form
document.addEventListener('DOMContentLoaded', function() {
    // Set up form validation
    const inputs = form.querySelectorAll('input, select, textarea');
    inputs.forEach(input => {
        if (input.type !== 'hidden') {
            input.addEventListener('blur', (e) => validateField(e.target));
            input.addEventListener('input', (e) => validateField(e.target));
        }
    });

    // Set up date restrictions
    setupDateRestrictions();

    // Handle date change
    document.getElementById('date').addEventListener('change', renderTimeSlots);

    // Handle review button
    document.getElementById('review-button').addEventListener('click', showReviewModal);

    // Handle modal buttons
    document.getElementById('confirm-checkbox').addEventListener('change', function() {
        document.getElementById('submit-button').disabled = !this.checked;
    });

    document.getElementById('edit-button').addEventListener('click', function() {
        document.getElementById('review-modal').classList.remove('show');
    });

    document.getElementById('submit-button').addEventListener('click', function() {
        this.disabled = true;
        const submitButton = this;
        submitButton.querySelector('.loading-spinner').classList.remove('hidden');

        const formData = new FormData(form);
        formData.append('timestamp', new Date().toISOString());

        fetch(scriptURL, { method: 'POST', body: formData, mode: 'no-cors' })
            .then(() => {
                document.getElementById('review-modal').classList.remove('show');
                showSuccessMessage();
                form.reset();
                setupDateRestrictions();
            })
            .catch(error => {
                console.error('Error!', error.message);
                showErrorMessage('Có lỗi xảy ra. Vui lòng thử lại sau.');
            })
            .finally(() => {
                submitButton.disabled = false;
                submitButton.querySelector('.loading-spinner').classList.add('hidden');
            });
    });

    // Set up animations
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('show');
                observer.unobserve(entry.target);
            }
        });
    }, { threshold: 0.2 });

    document.querySelectorAll('.info-card').forEach(card => {
        observer.observe(card);
    });

    // Handle iframe height adjustment
    function sendHeight() {
        const height = document.body.scrollHeight;
        window.parent.postMessage({ height }, '*');
    }

    sendHeight();
    const resizeObserver = new ResizeObserver(sendHeight);
    resizeObserver.observe(document.body);
    window.addEventListener('resize', sendHeight);
});
</script>
</body>
</html>